(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{396:function(a,t,s){a.exports=s.p+"assets/img/Figure11.5ec23b6f.png"},440:function(a,t,s){"use strict";s.r(t);var e=s(42),o=Object(e.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"deploying-hpe-ezmeral-container-platform-using-ansible-playbook"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deploying-hpe-ezmeral-container-platform-using-ansible-playbook"}},[a._v("#")]),a._v(" Deploying HPE Ezmeral Container Platform using Ansible playbook")]),a._v(" "),e("h2",{attrs:{id:"overview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[a._v("#")]),a._v(" Overview")]),a._v(" "),e("p",[a._v("Usage of Ansible playbooks to deploy the HPE Ezmeral Container Platform is automated and eliminates manual intervention. Ansible playbooks provides the following functionalities for the installation user to deploy HPE Ezmeral Container Platform.")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Install the controller node")])]),a._v(" "),e("li",[e("p",[a._v("Add gateway nodes, delete gateway nodes or enable gateway HA")])]),a._v(" "),e("li",[e("p",[a._v("Add and delete EPIC worker nodes")])]),a._v(" "),e("li",[e("p",[a._v("Enable or disable controller high availability")])]),a._v(" "),e("li",[e("p",[a._v("Add or remove hosts on the Kubernetes")])]),a._v(" "),e("li",[e("p",[a._v("Create or delete Kubernetes cluster")])]),a._v(" "),e("li",[e("p",[a._v("Create or delete tenants")])])]),a._v(" "),e("p",[a._v("Figure 11 shows the high level flow of the automated deployment.")]),a._v(" "),e("p",[e("img",{attrs:{src:s(396),alt:""}})]),a._v(" "),e("p",[e("strong",[a._v("Figure 11.")]),a._v(" Workflow diagram for automated HPE Ezmeral Container Platform deployment")]),a._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[a._v("Prerequisites")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Linux machine with Ansible 2.9.x and python 3.x as mentioned in "),e("RouterLink",{attrs:{to:"/Solution-Deployment/Host-Configuration.html#installer-machine"}},[a._v("Installer machine")]),a._v(" section of deployment guide")],1)]),a._v(" "),e("li",[e("p",[a._v("Minimum five (5) nodes with SLES 15 SP1 (nodes can be VMs or bare metal).")])]),a._v(" "),e("li",[e("p",[a._v("Obtain the URL of the HPE Ezmeral Container Platform bundle (using S3 bucket) and download the bin file on installer and provide the executable permissions.")])])])]),a._v(" "),e("h2",{attrs:{id:"input-files"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#input-files"}},[a._v("#")]),a._v(" Input files")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Update the values in "),e("em",[a._v("vars.yml")]),a._v(" and "),e("em",[a._v("hosts inventory file")]),a._v(" according to your environment.")])]),a._v(" "),e("li",[e("p",[a._v("Use following command to edit "),e("em",[a._v("vars.yml")]),a._v(" file")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-vault edit group_vars/all/vars.yml \n")])])])])]),a._v(" "),e("h2",{attrs:{id:"sample-input-files"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sample-input-files"}},[a._v("#")]),a._v(" Sample input files")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Sample hosts inventory file looks like:")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("local"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    localhost            ansible_connection=local ansible_python_interpreter=/opt/hpe/solutions/hpecp/hpcp_venv/bin/python\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("allnodes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    controller"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node           ansible_host=20.x.x.x\n    worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("1             ansible_host=20.x.x.x\n    worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("2             ansible_host=20.x.x.x\n    worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("3             ansible_host=20.x.x.x\n    gateway"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("1            ansible_host=20.x.x.x\n    gateway"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("2            ansible_host=20.x.x.x\n    epic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("1             ansible_host=20.x.x.x\n    epic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("2             ansible_host=20.x.x.x\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("controller"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    controller"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node           ansible_host=20.x.x.x\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("k8sclusternodes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("1             ansible_host=20.x.x.x\n    worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("2             ansible_host=20.x.x.x\n    worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("3             ansible_host=20.x.x.x\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("gateway"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    gateway"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("1            ansible_host=20.x.x.x\n    gateway"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("2            ansible_host=20.x.x.x\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("epicworkers"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    epic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("1             ansible_host=20.x.x.x\n    epic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("2             ansible_host=20.x.x.x\n")])])])])]),a._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[a._v("NOTE")]),a._v(" "),e("ul",[e("li",[a._v("Get ansible_python_interpreter value by running"),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" python3\n")])])])])]),a._v(" "),e("p",[a._v("command and assign this value to ansible_connection variable.")]),a._v(" "),e("ul",[e("li",[a._v("Sample vars.yml can be found in the following path "),e("strong",[a._v("group_vars/all/vars.sample")]),a._v(" along with description of each input variable.")])])]),a._v(" "),e("h2",{attrs:{id:"details-of-playbook"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#details-of-playbook"}},[a._v("#")]),a._v(" Details of Playbook")]),a._v(" "),e("p",[a._v("HPE Ezmeral Container Platform can be deployed by running "),e("strong",[a._v("site.yml")]),a._v(" or by running individual playbooks. Each playbook description can be found further in this document")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("To build complete setup:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts site.yml  --ask-vault-pass\n")])])])]),a._v(" "),e("li",[e("p",[a._v("In case if user want to deploy through individual playbooks. Sequence of playbooks to be followed are:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/download-tools.yml --ask-vault-pass \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/controller.yml --ask-vault-pass\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/gateway-add.yml --ask-vault-pass \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/epic-workers-add.yml --ask-vault-pass \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/controller-ha.yml --ask-vault-pass \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/k8s-add-hosts.yml --ask-vault-pass\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/k8s-create-cluster.yml --ask-vault-pass\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/k8s-create-tenant.yml --ask-vault-pass \n")])])])])]),a._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[a._v("NOTE")]),a._v(" "),e("p",[a._v("In case if there is no requirement of controller ha, user can skip "),e("strong",[a._v("playbooks/controller-ha.yml")])])]),a._v(" "),e("h2",{attrs:{id:"playbook-description"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbook-description"}},[a._v("#")]),a._v(" Playbook description")]),a._v(" "),e("ul",[e("li",[e("p",[e("strong",[a._v("site.yml")])]),a._v(" "),e("ul",[e("li",[a._v("This playbook contains the script to deploy HPE Ezmeral Container Platform starting from the controller until tenant configuration.")])])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("download-tools.yml")])]),a._v(" "),e("ul",[e("li",[e("p",[a._v("This playbook downloads the below tools under "),e("strong",[a._v("/usr/local/bin")]),a._v(" in the installer machine and provides executable permissions.")]),a._v(" "),e("ul",[e("li",[a._v("epicctl")]),a._v(" "),e("li",[a._v("kubectl")]),a._v(" "),e("li",[a._v("kubectl-hpecp plugin")]),a._v(" "),e("li",[a._v("jq")])])])])])]),a._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[a._v("NOTE")]),a._v(" "),e("p",[a._v("In case of facing any issues while running download-tools.yml playbook, download tools manually from the following links, place it under\n"),e("strong",[a._v("/usr/local/bin")]),a._v(" and change executable permissions.")]),a._v(" "),e("ul",[e("li",[a._v("epicctl "),e("a",{attrs:{href:"https://my-epicctl.s3-us-west-2.amazonaws.com/epicctl",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://my-epicctl.s3-us-west-2.amazonaws.com/epicctl"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("kubectl "),e("a",{attrs:{href:"https://storage.googleapis.com/Kubernetes-release/release/%7Bkubectl_cli_version%7D/bin/linux/amd64/kubectl",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://storage.googleapis.com/Kubernetes-release/release/{kubectl_cli_version}/bin/linux/amd64/kubectl"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("kubectl-hpecp plugin "),e("a",{attrs:{href:"https://bluedata-releases.s3.amazonaws.com/kubectl-epic/3.2/162/linux/kubectl-hpecp",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://bluedata-releases.s3.amazonaws.com/kubectl-epic/3.2/162/linux/kubectl-hpecp"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("jq "),e("a",{attrs:{href:"https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64"),e("OutboundLink")],1)])]),a._v(" "),e("p",[a._v("Update "),e("strong",[a._v("{kubectl_cli_version}")]),a._v(" with the version which user wants to download. Please make sure the version is compatible with the version which HPECP supports. It is recommended to use "),e("strong",[a._v("1.17.5")]),a._v(" for the version.")])]),a._v(" "),e("h2",{attrs:{id:"playbooks-description"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbooks-description"}},[a._v("#")]),a._v(" Playbooks Description")]),a._v(" "),e("ul",[e("li",[e("p",[e("strong",[a._v("controller.yml")])]),a._v(" "),e("ul",[e("li",[a._v("This playbook contains the script to deploy controller and also configuring the controller based on the configuaration details provided in the vars.yml file and also provide ip details in hosts inventory file.")])])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("gateway-add.yml")])]),a._v(" "),e("ul",[e("li",[a._v("This playbook contains the script to add gateways. User can add multiple gateways by providing ip and host information in vars.yml file and also provide ip details in hosts inventory file.")])])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("epic-workers-add.yml")])]),a._v(" "),e("ul",[e("li",[a._v("This playbook contains the script to add epic worker nodes. Provide epic worker details in vars.yml and also in hosts inventory file.")])])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("controller-ha.yml")])]),a._v(" "),e("ul",[e("li",[e("p",[a._v("This playbook contains the script to enable controller ha. User need to provide virtual ip with FQDN in vars.yml file to configure controller ha. Please make sure virtual ip details present in DNS entries.")])]),a._v(" "),e("li",[e("p",[a._v("User need to run "),e("strong",[a._v("playbooks/epic-workers-add.yml")]),a._v(" playbook first to add required epic worker nodes. And then run "),e("strong",[a._v("playbooks/controller-ha.yml")]),a._v(" playbook.")])])])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("k8-add-hosts.yml")])]),a._v(" "),e("ul",[e("li",[a._v("This playbook contains the script to add k8 nodes. Provide k8 nodes information in vars.yml and hosts file.")])])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("k8s-create-cluster.yml")])]),a._v(" "),e("ul",[e("li",[a._v("This playbook contains the script to create cluster. Provide cluster details in vars.yml")])])]),a._v(" "),e("li",[e("p",[e("strong",[a._v("k8s-create-tenant.yml")])]),a._v(" "),e("ul",[e("li",[a._v("This playbook contains the script to create tenant. Provide tenant details in vars.yml.")])])])]),a._v(" "),e("h2",{attrs:{id:"uninstall-information"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uninstall-information"}},[a._v("#")]),a._v(" Uninstall information")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Run below playbook to erase build on controller node.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/uninstall-bds.yml --ask-vault-pass\n")])])])])]),a._v(" "),e("h2",{attrs:{id:"other-playbooks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#other-playbooks"}},[a._v("#")]),a._v(" Other Playbooks")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Run the following command to disable controller ha.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/disable-controller-ha.yml --ask-vault-pass\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Run the following command to delete epic workers.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/epic-workers-delete.yml --ask-vault-pass\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Run the following command to delete k8s hosts.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/k8s-delete-hosts.yml --ask-vault-pass\n")])])]),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[a._v("NOTE")]),a._v(" "),e("ol",[e("li",[a._v("If platform "),e("strong",[a._v("High Availability")]),a._v(" is enabled, then the user cannot delete the Controller, Shadow Controller or Arbiter host from the Container Platform.")]),a._v(" "),e("li",[a._v("You must have "),e("strong",[a._v("at least four (4) EPIC worker hosts")]),a._v(" (including the HA EPIC worker hosts) in order to decommission the datanodes.")]),a._v(" "),e("li",[a._v("If HA is not enabled, then the user can delete the epic workers as usual.")]),a._v(" "),e("li",[a._v("For more information see "),e("a",{attrs:{href:"http://docs.bluedata.com/51_decommissioning-deleting-an-epic-worker",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://docs.bluedata.com/51_decommissioning-deleting-an-epic-worker"),e("OutboundLink")],1)])])])]),a._v(" "),e("li",[e("p",[a._v("Run the following command to delete the tenant.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/k8s-delete-tenant.yml --ask-vault-pass\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Run the following command to delete the cluster")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/k8s-delete-cluster.yml --ask-vault-pass\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Run the following command to delete gateway.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ansible-playbook -i hosts playbooks/gateway-delete.yml --ask-vault-pass\n")])])])])])])}),[],!1,null,null,null);t.default=o.exports}}]);