(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{377:function(e,t,a){e.exports=a.p+"assets/img/Figure63.c8988266.png"},432:function(e,t,a){"use strict";a.r(t);var s=a(42),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"physical-worker-node-labeling-in-hpe-ezmeral-container-platform"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#physical-worker-node-labeling-in-hpe-ezmeral-container-platform"}},[e._v("#")]),e._v(" Physical worker node labeling in HPE Ezmeral Container Platform")]),e._v(" "),s("h2",{attrs:{id:"introduction"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),s("p",[e._v("Discovering the node properties and advertising them through node labels can be used to control workload placement in a Kubernetes cluster. With the HPE Ezmeral Container Platform running on HPE server platforms, organizations can automate the discovery of hardware properties and use that information to schedule workloads that benefit from the different capabilities that the underlying hardware provides. Using HPE iLO and its REST or Redfish API- based discovery capabilities (proliantutils), the following properties can be discovered about the nodes:")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Presence of GPUs")])]),e._v(" "),s("li",[s("p",[e._v("Underlying RAID configurations")])]),e._v(" "),s("li",[s("p",[e._v("Presence of disks by type")])]),e._v(" "),s("li",[s("p",[e._v("Persistent-memory availability")])]),e._v(" "),s("li",[s("p",[e._v("Status of CPU virtualization features")])]),e._v(" "),s("li",[s("p",[e._v("SR-IOV capabilities")])]),e._v(" "),s("li",[s("p",[e._v("CPU architecture")])]),e._v(" "),s("li",[s("p",[e._v("CPU core count")])]),e._v(" "),s("li",[s("p",[e._v("Platform information including model, iLO and BIOS versions")])]),e._v(" "),s("li",[s("p",[e._v("Memory capacity")])]),e._v(" "),s("li",[s("p",[e._v("UEFI Security settings")])]),e._v(" "),s("li",[s("p",[e._v("Health status of compute, storage, and network components")])])]),e._v(" "),s("p",[e._v("After these properties are discovered for the physical worker nodes, HPE Ezmeral Container Platform node labeling can be applied to group nodes based on the underlying features of the nodes. By default, every node will have its node name as a label.")]),e._v(" "),s("p",[e._v("The following properties can be used to label nodes:")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("Overall health status of the node.")]),e._v(" "),s("p",[e._v('If current status of "BIOS, Fans, Temperature Sensors, Battery, Processor, Memory, Network, and Storage" is ok, node health status is labeled as "Ok". Otherwise it will appear as "Degraded".')])]),e._v(" "),s("li",[s("p",[e._v("Overall security status of the node.")]),e._v(" "),s("p",[e._v('If the current status of the following BIOS configuration items (which are important for security) are as expected, then security status of the node is "Ok". Otherwise, they will be labeled as "Degraded".')])])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v("Based on the HPE Gen10 Security Reference Guide, the recommended values for the chosen parameters are as follows.")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Secure Boot: Enabled")])]),e._v(" "),s("li",[s("p",[e._v("Asset tag: Locked")])]),e._v(" "),s("li",[s("p",[e._v("UEFI Shell Script Verification: Enabled")])]),e._v(" "),s("li",[s("p",[e._v("UEFI Shell Startup: Disabled")])]),e._v(" "),s("li",[s("p",[e._v("Processor AES: Enabled")])])]),e._v(" "),s("p",[e._v("For more information, refer HPE Gen10 Security Reference Guide at "),s("a",{attrs:{href:"https://support.hpe.com/hpesc/public/docDisplay?docId=a00018320en_us",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://support.hpe.com/hpesc/public/docDisplay?docId=a00018320en_us"),s("OutboundLink")],1),e._v(".")])]),e._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[e._v("Custom Labeling.")]),e._v(" "),s("p",[e._v("User defined labels (key, value) are assigned to desired physical worker nodes. Users can use these Python scripts to retrieve the properties of the underlying hardware and then decide on required labels that should be assigned to each physical worker nodes.")])])]),e._v(" "),s("h2",{attrs:{id:"high-level-process-flow-diagram-for-node-labeling"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#high-level-process-flow-diagram-for-node-labeling"}},[e._v("#")]),e._v(" High level process flow diagram for Node Labeling")]),e._v(" "),s("p",[e._v("Node labeling can be broken down into 4 main phases:")]),e._v(" "),s("ul",[s("li",[e._v("Setting up of the installer VM environment")]),e._v(" "),s("li",[e._v("Updating the input files with the server information")]),e._v(" "),s("li",[e._v("Execution of the Python scripts")]),e._v(" "),s("li",[e._v("Verification of the pod scheduling")])]),e._v(" "),s("p",[e._v("Figure 63 shows the high level flow for Node Labeling.\n"),s("img",{attrs:{src:a(377),alt:""}})]),e._v(" "),s("p",[s("strong",[e._v("Figure")]),e._v(" "),s("strong",[e._v("63.")]),e._v(" Process flow for Node Labeling")]),e._v(" "),s("h2",{attrs:{id:"scripts-for-labeling-worker-nodes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scripts-for-labeling-worker-nodes"}},[e._v("#")]),e._v(" Scripts for labeling worker nodes")]),e._v(" "),s("p",[e._v("To label the physical worker node in HPE Ezmeral Container Platform, use the repository located at the HPE Ezmeral Container Platform Solutions GitHub at "),s("a",{attrs:{href:"https://github.com/hewlettpackard/hpe-solutions-hpecp",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/hewlettpackard/hpe-solutions-hpecp"),s("OutboundLink")],1),e._v(". The Scripts for HPE Ezmeral Container Platform 5.1 Physical Worker Node labeling are available in GitHub under "),s("strong",[e._v("/scripts/physical_worker_node_labeling/")]),e._v(". This folder contains Python scripts to automate the labeling of physical worker nodes by discovering the physical node properties in an HPE Ezmeral Container Platform 5.1 deployment and advertising them through node labels. Node labels can be targeted for deployment using node selectors.")]),e._v(" "),s("h3",{attrs:{id:"contents-of-the-repository"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#contents-of-the-repository"}},[e._v("#")]),e._v(" Contents of the repository")]),e._v(" "),s("ol",[s("li",[s("p",[s("strong",[e._v("config.json")]),e._v(": This file contains variables holding information about the HPE Ezmeral Container Platform specific environment variables.")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("kubeconfig_path")]),e._v(': Specifies the path of kubeconfig and this path is used by the "kubectl" command at runtime.')])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("hosts.json")]),e._v(": This is the encrypted inventory file which will be used by HPE Ezmeral Container Platform installer VM to reference physical worker nodes and user-defined labels.")]),e._v(" "),s("ul",[s("li",[s("p",[s("strong",[e._v("host_fqdn")]),e._v(": Specifies the physical worker node fully qualified domain name or IP.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("ilo_ip")]),e._v(": iLO IP of the physical worker node.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("username")]),e._v(": Username used to log in to the iLO of the physical worker node.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("password")]),e._v(": Password to log in to the iLO of the physical worker node.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("custom_label_required")]),e._v(': The value is "yes" if the user wishes to use custom labels. Otherwise, it should be set to "no".')])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("custom_labels")]),e._v(": Specify the custom labels key and value.")])])])])]),e._v(" "),s("ul",[s("li",[e._v("To edit this vault file use the following command and provide the default \"ansible vault\" password ('changeme')."),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ansible-vault edit hosts.json\n")])])])])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v('Information inside hosts.json is available in a nested JSON format, which means user can add any number of physical worker node by creating the sections as "server1, server2, server3, ...servern" and can also add any number of "custom labels" as "label1, label2, label3 and labeln".')])]),e._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[s("strong",[e._v("json_parser.py")]),e._v(": This file contains the logic to derive value of any standalone key or nested keys from the json file.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("physical_node_labelling.py")]),e._v(': This file contains the logic to derive the physical hardware properties and label of the HPE Ezmeral Container Platform physical worker nodes based on properties and user-defined label names. To extract hardware properties, Python module "proliantutils" is used in this script.')])])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("Prerequisites")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Ansible engine with Ansible 2.9.x, ansible-vault and Python  3.6.x")])]),e._v(" "),s("li",[s("p",[e._v("HPE Ezmeral Container Platform 5.1 is up and running.")])]),e._v(" "),s("li",[s("p",[e._v('The HPE Ezmeral Container Platform 5.1 must have physical worker node(s) to use the "Node labeling" functionality.')])]),e._v(" "),s("li",[s("p",[e._v("Ensure there is connectivity to the iLO IP's of the physical node servers (ping the iLO's and check if they are reachable, because the script needs to talk to the iLO to retrieve information of the servers)")])]),e._v(" "),s("li",[s("p",[e._v("The scripts under this repository need to be run from the installer machine with the Python Virtual Environment setup as mentioned in the "),s("RouterLink",{attrs:{to:"/Solution-Deployment/Host-Configuration.html#installer-machine"}},[e._v("Installer Machine")]),e._v(" section of the Deployment Guide.")],1)]),e._v(" "),s("li",[s("p",[e._v("Ensure that the "),s("strong",[e._v("kubectl")]),e._v(" tool is available in the path along with the "),s("strong",[e._v("kubeconfig")]),e._v(" file of the cluster in $HOME/.kube/ directory (eg /root/.kube/config)")])]),e._v(" "),s("li",[s("p",[e._v("The kubeconfig file can be obtained in two ways:")]),e._v(" "),s("ul",[s("li",[e._v("From the HPE Ezmeral Container Platform GUI - > Navigate to the Clusters section -> Download Admin Kubeconfig from the options available on the cluster.")]),e._v(" "),s("li",[e._v("Copying the config file from the master node from the $HOME/.kube/ location on to the installer machine.")])])]),e._v(" "),s("li",[s("p",[e._v("Ensure that the kubeconfig file is named as 'config' and placed in the $HOME/.kube/ location( eg. /root/.kube/config) of the installer machine.")])]),e._v(" "),s("li",[s("p",[e._v('Python module "proliantutils" is required')]),e._v(" "),s("ul",[s("li",[s("p",[e._v('"proliantutils" is a set of utility libraries for interfacing and managing various components (like iLO) for HPE Proliant Servers.')])]),e._v(" "),s("li",[s("p",[e._v("Use the following command to install proliantutils")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("> pip3 install proliantutils==2.9.2\n")])])]),s("ul",[s("li",[e._v("Verify the version of proliantutils")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("> pip3 freeze | grep proliantutils\n")])])]),s("ul",[s("li",[e._v("Output:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("proliantutils==2.9.2\n")])])])]),e._v(" "),s("li",[s("p",[e._v('Install the "sushy" python library. In case "sushy" module is already installed, please make sure its version is 3.0.0')]),e._v(" "),s("ul",[s("li",[e._v("Use the following command to install sushy module.")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("> pip3 install sushy==3.0.0\n")])])]),s("ul",[s("li",[e._v("Verify the version of proliantutils")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("> pip freeze | grep sushy\n")])])]),s("ul",[s("li",[e._v("Output:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sushy==3.0.0\n")])])])])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v("Master nodes have kubectl tool and kubeconfig file by default, hence the scripts can also be run from the master nodes after setting up the python environment, installing the required modules and setting up of the repositories.")])])]),e._v(" "),s("h3",{attrs:{id:"executing-the-playbooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#executing-the-playbooks"}},[e._v("#")]),e._v(" Executing the playbooks")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("Login to the installer VM.")])]),e._v(" "),s("li",[s("p",[e._v("Activate the Python 3 virtual environment as mentioned in the section "),s("RouterLink",{attrs:{to:"/Solution-Deployment/Host-Configuration.html#installer-machine"}},[e._v("Installer machine")]),e._v(" in this document.")],1)]),e._v(" "),s("li",[s("p",[e._v("Execute the following command and navigate to the directory physical-worker labeling.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" BASE_DIR/platform/physical_worker_node_labeling/\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v("BASE_DIR is defined and set in installer machine section in deployment guide")])])]),e._v(" "),s("li",[s("p",[e._v("Update the "),s("em",[e._v("config.json")]),e._v(" and "),s("em",[e._v("hosts.json")]),e._v(" files with appropriate values.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("vi")]),e._v(" config.json\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ansible-vault edit hosts.json\n")])])])]),e._v(" "),s("li",[s("p",[e._v("After the files mentioned in step 4 are updated, execute the script using the following command.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" python physical_node_labelling.py\n")])])])]),e._v(" "),s("li",[s("p",[e._v("The user will be prompted to enter the ansible vault password/key. This credential is the default \"ansible vault\" password that is 'changeme'.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Enter key for encrypted variables:")]),e._v("\n")])])])]),e._v(" "),s("li",[s("p",[e._v("The installation user will see the output similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("1: Get the physical worker node details that user wishes to configure.\n\n2: Get current health status of the physical worker node\n\n3: Get security parameters of the physical worker node\n\n4: Label the physical worker with health status\n\n5: Label the physical worker with security status\n\n6: Custom labels\n\n7: Display current labels on the node\n\n8: Quit\n\nEnter the choice number:\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Select option 1 to retrieve the physical worker node details. The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Enter the choice number: 1\n\n{'server1': {'host_fqdn': 'pworkerphysical2.pranav.twentynet.local', 'ilo_ip': '10.0.3.64',\n 'username': 'admin', 'password': 'admin123', 'custom_label_required': 'yes',\n  'custom_labels': {'label1': {'label_name': 'RESOURCES', 'label_val': 'MAX'},\n   'label2': {'label_name': 'NODEAFFINITY', 'label_val': 'TEST'}}}}\n\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Select option 2 to retrieve the current health status of the physical worker node. The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Enter the choice number: 2\n\n{'pworkerphysical2.pranav.twentynet.local': 'OK'}\n\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Select option 3 to retrieve the security parameters of the physical worker node. The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Enter the choice number: 3\n\n{'pworkerphysical2.pranav.twentynet.local': 'Degraded'}\n\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Select option 4 to label the physical worker with its current hardware health status. The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Enter the choice number: 4\n\nNAME                                      STATUS   ROLES    AGE    VERSION   LABELS\npworkerphysical2.pranav.twentynet.local   Ready    worker   3d1h   v1.17.4   beta.Kubernetes.io/arch=amd64,\n\nbeta.Kubernetes.io/os=linux,health=OK,hpe.com/compute=true,hpe.com/dataplatform=false,\n\nhpe.com/exclusivecluster=none,hpe.com/usenode=true,Kubernetes.io/arch=amd64,\n\nKubernetes.io/hostname=pworkerphysical2.pranav.twentynet.local,Kubernetes.io/os=linux,\n\nnode-role.Kubernetes.io/worker=\n\nVerified - Label  health=OK is added to the node pworkerphysical2.pranav.twentynet.local\n\nb''\n\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Select option 5 to label the physical worker with security status. The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v(" Enter the choice number: 5\n\nNAME                                      STATUS   ROLES    AGE    VERSION   LABELS\npworkerphysical2.pranav.twentynet.local   Ready    worker   3d1h   v1.17.4   beta.Kubernetes.io/arch=amd64,\n\nbeta.Kubernetes.io/os=linux,health=OK,hpe.com/compute=true,hpe.com/dataplatform=false,\n\nhpe.com/exclusivecluster=none,hpe.com/usenode=true,Kubernetes.io/arch=amd64,\n\nKubernetes.io/hostname=pworkerphysical2.pranav.twentynet.local,Kubernetes.io/os=linux,\n\nnode-role.Kubernetes.io/worker=,security=Degraded\n\nVerified - Label  security=Degraded is added to the node pworkerphysical2.pranav.twentynet.local\n\nb''\n\n\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Select option 6 to define custom labels. The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Enter the choice number: 6\n\nNAME                                      STATUS   ROLES    AGE    VERSION   LABELS\npworkerphysical2.pranav.twentynet.local   Ready    worker   3d2h   v1.17.4   RESOURCES=MAX,\n\nbeta.Kubernetes.io/arch=amd64,beta.Kubernetes.io/os=linux,health=OK,hpe.com/compute=true,\n\nhpe.com/dataplatform=false,hpe.com/exclusivecluster=none,hpe.com/usenode=true,Kubernetes.io/arch=amd64,\n\nKubernetes.io/hostname=pworkerphysical2.pranav.twentynet.local,Kubernetes.io/os=linux,\n\nnode-role.Kubernetes.io/worker=,security=Degraded\n\nVerified - Label RESOURCES=MAX is added the node pworkerphysical2.pranav.twentynet.local\n\n\nNAME                                      STATUS   ROLES    AGE    VERSION   LABELS\npworkerphysical2.pranav.twentynet.local   Ready    worker   3d2h   v1.17.4   NODEAFFINITY=TEST,RESOURCES=MAX,\nbeta.Kubernetes.io/arch=amd64,beta.Kubernetes.io/os=linux,health=OK,hpe.com/compute=true,\n\nhpe.com/dataplatform=false,hpe.com/exclusivecluster=none,hpe.com/usenode=true,Kubernetes.io/arch=amd64,\n\nKubernetes.io/hostname=pworkerphysical2.pranav.twentynet.local,Kubernetes.io/os=linux,\n\nnode-role.Kubernetes.io/worker=,security=Degraded\n\nVerified - Label NODEAFFINITY=TEST is added the node pworkerphysical2.pranav.twentynet.local\n\nb''\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Select option 7 to display current labels on the node. The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Enter the choice number: 7\n\nNAME                                      STATUS   ROLES    AGE    VERSION   LABELS\npworkerphysical2.pranav.twentynet.local   Ready    worker   3d2h   v1.17.4   NODEAFFINITY=TEST,RESOURCES=MAX,\n\nbeta.Kubernetes.io/arch=amd64,beta.Kubernetes.io/os=linux,health=OK,hpe.com/compute=true,\n\nhpe.com/dataplatform=false,hpe.com/exclusivecluster=none,hpe.com/usenode=true,Kubernetes.io/arch=amd64,\n\nKubernetes.io/hostname=pworkerphysical2.pranav.twentynet.local,Kubernetes.io/os=linux,\n\nnode-role.Kubernetes.io/worker=,security=Degraded\n\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Select option 8 to quit the script. The output is shown as follows.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Enter the choice number: 8\n\nExiting!!\n")])])])])]),e._v(" "),s("h3",{attrs:{id:"verify-scheduling-of-pods-using-nodeselector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#verify-scheduling-of-pods-using-nodeselector"}},[e._v("#")]),e._v(" Verify scheduling of pods using NodeSelector")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("Execute the following command to get all the nodes in the HPE Ezmeral Container Platform installation.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" kubectl get nodes\n")])])]),s("p",[e._v("The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("NAME                                      STATUS     ROLES    AGE     VERSION\npmaster.pranav.twentynet.local            Ready      master   17d     v1.17.4\n\npworker1.pranav.twentynet.local           Ready      worker   17d     v1.17.4\n\npworker2.pranav.twentynet.local           Ready      worker   17d     v1.17.4\n\npworker3.pranav.twentynet.local           Ready      worker   17d     v1.17.4\n\npworkerphysical2.pranav.twentynet.local   Ready      worker   3d2h    v1.17.4\n\nsumslesf1b1.twentynet.local               Ready      worker   3d20h   v1.17.4\n\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v('Node “pworkerphysical2.pranav.twentynet.local” and "sumslesf1b1.twentynet.local" are the physical worker nodes and other worker nodes are virtual machines.')])])]),e._v(" "),s("li",[s("p",[e._v("Execute the following command to see the labels of all the nodes.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" kubectl get nodes --show-labels\n")])])]),s("p",[e._v("The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("NAME                                      STATUS     ROLES    AGE     VERSION   LABELS\npmaster.pranav.twentynet.local            Ready      master   17d     v1.17.4   beta.Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,\nbeta.Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,\nKubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("pmaster.pranav.twentynet.local,Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,\nnode-role.Kubernetes.io/master"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n\npworker1.pranav.twentynet.local           Ready      worker   17d     v1.17.4   beta.Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,\nbeta.Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,hpe.com/compute"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,hpe.com/dataplatform"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("false,\nhpe.com/exclusivecluster"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("none,hpe.com/usenode"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,\nKubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("pworker1.pranav.twentynet.local,Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,\nnode-role.Kubernetes.io/worker"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n\npworker2.pranav.twentynet.local           Ready      worker   17d     v1.17.4   beta.Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,\nbeta.Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,hpe.com/compute"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,hpe.com/dataplatform"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("false,\nhpe.com/exclusivecluster"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("none,hpe.com/usenode"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,\nKubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("pworker2.pranav.twentynet.local,Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,\nnode-role.Kubernetes.io/worker"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n\npworker3.pranav.twentynet.local           Ready      worker   17d     v1.17.4   beta.Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,\nbeta.Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,hpe.com/compute"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,hpe.com/dataplatform"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("false,\nhpe.com/exclusivecluster"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("none,hpe.com/usenode"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,\nKubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("pworker3.pranav.twentynet.local,Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,\nnode-role.Kubernetes.io/worker"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n\npworkerphysical2.pranav.twentynet.local   Ready      worker   3d2h    v1.17.4   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("NODEAFFINITY")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("TEST,RESOURCES"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("MAX,\nbeta.Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,beta.Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,health"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("OK,hpe.com/compute"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,\nhpe.com/dataplatform"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("false,hpe.com/exclusivecluster"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("none,hpe.com/usenode"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,\nKubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,Kubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("pworkerphysical2.pranav.twentynet.local,\nKubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,node-role.Kubernetes.io/worker"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(",security"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("Degraded\n\nsumslesf1b1.twentynet.local               Ready      worker   3d20h   v1.17.4   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("HPECP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("EZMERAL,PRANAV"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("NODE_LABELLING,\nbeta.Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,beta.Kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,health"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("Degraded,\nhpe.com/compute"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,hpe.com/dataplatform"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("false,hpe.com/exclusivecluster"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("none,\nhpe.com/usenode"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true,Kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("amd64,Kubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("sumslesf1b1.twentynet.local,\nKubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("linux,node-role.Kubernetes.io/worker"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(",security"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("Degraded\n\n")])])])]),e._v(" "),s("li",[s("p",[e._v("Execute the following commands to create a new application pod in the default namespace.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("vi")]),e._v(" nginx.yaml\n")])])]),s("p",[e._v("Fill up the contents of the yaml file as follows:")]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" IfNotPresent\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("nodeSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("health")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" OK\n\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" kubectl create -f nginx.yaml\n")])])]),s("p",[e._v("The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("pod/nginx created\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v('Here the nodeSelector parameter selects the node that matches\nthe label "health=OK" and deploys the pod on that node.')]),e._v(" "),s("p",[e._v('In this case the node with label "health=OK" is\n"pworkerphysical2.pranav.twentynet.local"')])])]),e._v(" "),s("li",[s("p",[e._v("Execute the following command to get the pods for the newly created application.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" kubectl get pods -o wide\n")])])]),s("p",[e._v("The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("NAME    READY   STATUS    RESTARTS   AGE   IP             NODE                                      NOMINATED NODE   READINESS GATES\nnginx   1/1     Running   0          3d    10.192.2.131   pworkerphysical2.pranav.twentynet.local   <none>           <none>\n\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v('Here we see the pod is deployed on the node "pworkerphysical2.pranav.twentynet.local"\nas expected since the node has the label "health=OK"')])])]),e._v(" "),s("li",[s("p",[e._v("Execute the following command to describe the application pod.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" kubectl describe pod nginx\n")])])]),s("p",[e._v("The output is similar to the following.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Name:         nginx\nNamespace:    default\nPriority:     0\nNode:         pworkerphysical2.pranav.twentynet.local/20.0.15.12\nStart Time:   Fri, 31 Jul 2020 08:16:38 -0400\nLabels:       env=test\nAnnotations:  cni.projectcalico.org/podIP: 10.192.2.131/32\n            Kubernetes.io/psp: 00-privileged\nStatus:       Running\nIP:           10.192.2.131\nIPs:\nIP:  10.192.2.131\nContainers:\nnginx:\n    Container ID:   docker://f36bf7b0c237431cfdbde575f3f825a0c49f73dc821d34a31c1bcd1c9e13fa02\n    Image:          nginx\n    Image ID:       docker-pullable://nginx@sha256:0e188877aa60537d1a1c6484b8c3929cfe09988145327ee47e8e91ddf6f76f5c\n    Port:           <none>\n    Host Port:      <none>\n    State:          Running\n    Started:      Fri, 31 Jul 2020 08:16:39 -0400\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n    /var/run/secrets/Kubernetes.io/serviceaccount from default-token-qz4zk (ro)\nConditions:\nType              Status\nInitialized       True\nReady             True\nContainersReady   True\nPodScheduled      True\nVolumes:\ndefault-token-qz4zk:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-qz4zk\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  health=OK\nTolerations:     node.Kubernetes.io/not-ready:NoExecute for 300s\n                node.Kubernetes.io/unreachable:NoExecute for 300s\nEvents:          <none>\n\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v('Here we see the Node-Selectors key with "health=OK" label.')])])])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),s("p",[e._v("These scripts have been tested on HPE Ezmeral Container Platform 5.1 with the following configuration parameters:")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Worker nodes are running SLESOS as the operating system")])]),e._v(" "),s("li",[s("p",[e._v("Installer VM OS Version: CentOS 7.6")])]),e._v(" "),s("li",[s("p",[e._v("Python: 3.6.9")])]),e._v(" "),s("li",[s("p",[e._v("proliantutils: 2.9.2")])]),e._v(" "),s("li",[s("p",[e._v("sushy: 3.0.0")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);