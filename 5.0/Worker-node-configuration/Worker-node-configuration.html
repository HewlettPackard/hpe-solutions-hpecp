<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Worker node configuration | HPE Deployment Guide for HPE Ezmeral Container Platform on HPE Synergy </title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/hpe-solutions-hpecp/5.0/assets/css/0.styles.d5074086.css" as="style"><link rel="preload" href="/hpe-solutions-hpecp/5.0/assets/js/app.9e57fa5b.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.0/assets/js/2.ca577d1f.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.0/assets/js/19.d4c727d2.js" as="script"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/10.7653ac4a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/11.03b59ef5.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/12.4053d4ed.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/13.10e37ced.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/14.6593624f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/15.abd6c11c.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/16.4724e478.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/17.cc499619.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/18.55c184dc.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/3.11053c91.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/4.c1ef1af0.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/5.b9f3fa98.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/6.84dca2fa.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/7.044c1ac8.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/8.9c411008.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.0/assets/js/9.047e217f.js">
    <link rel="stylesheet" href="/hpe-solutions-hpecp/5.0/assets/css/0.styles.d5074086.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-hpecp/5.0/" class="home-link router-link-active"><!----> <span class="site-name">HPE Deployment Guide for HPE Ezmeral Container Platform on HPE Synergy </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.0/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.0/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/hpe-solutions-hpecp/5.0/Introduction/Introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/hpe-solutions-hpecp/5.0/Solution overview/Solution overview.html" class="sidebar-link">Solution overview</a></li><li><a href="/hpe-solutions-hpecp/5.0/Solution components/Solution components.html" class="sidebar-link">Solution components</a></li><li><a href="/hpe-solutions-hpecp/5.0/Physical environment configuration/Physical environment configuration.html" class="sidebar-link">Physical environment configuration</a></li><li><a href="/hpe-solutions-hpecp/5.0/Worker-node-configuration/Worker-node-configuration.html" aria-current="page" class="active sidebar-link">Worker node configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.0/Worker-node-configuration/Worker-node-configuration.html#preparing-the-execution-environment" class="sidebar-link">Preparing the execution environment</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.0/Worker-node-configuration/Worker-node-configuration.html#server-profiles" class="sidebar-link">Server profiles</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.0/Worker-node-configuration/Worker-node-configuration.html#deploying-operating-system-on-bare-metal-nodes" class="sidebar-link">Deploying operating system on bare metal nodes</a></li></ul></li><li><a href="/hpe-solutions-hpecp/5.0/Deploy HPE Ezmeral Container Platform/Deploy HPE Ezmeral Container Platform.html" class="sidebar-link">Deploy HPE Ezmeral Container Platform</a></li><li><a href="/hpe-solutions-hpecp/5.0/Deploying Kubernetes cluster/Deploying Kubernetes cluster.html" class="sidebar-link">Deploying Kubernetes cluster</a></li><li><a href="/hpe-solutions-hpecp/5.0/Securing HPE Ezmeral Container Platform using Sysdig Secure and Sysdig Monitor/Securing HPE Ezmeral Container Platform using Sysdig Secure and Sysdig Monitor.html" class="sidebar-link">Securing HPE Ezmeral Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-hpecp/5.0/Validate HPE Ezmeral Container Platform deployment/Validate HPE Ezmeral Container Platform deployment.html" class="sidebar-link">Validate HPE Ezmeral Container Platform deployment</a></li><li><a href="/hpe-solutions-hpecp/5.0/HPE CSI driver installation/HPE CSI driver installation.html" class="sidebar-link">HPE CSI driver installation</a></li><li><a href="/hpe-solutions-hpecp/5.0/Configuration/Configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/hpe-solutions-hpecp/5.0/Deploying WordPress application using Nimble persistent volume/Deploying WordPress application using Nimble persistent volume.html" class="sidebar-link">Deploying WordPress application using Nimble persistent volume</a></li><li><a href="/hpe-solutions-hpecp/5.0/Resources and additional links/Resources and additional links.html" class="sidebar-link">Resources and additional links</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="worker-node-configuration"><a href="#worker-node-configuration" class="header-anchor">#</a> Worker node configuration</h1> <p>This section outlines the steps to configure the automation environment and utilizes the automation environment to create the server profile for all Synergy nodes and install RHEL operating system on each of them.</p> <h2 id="preparing-the-execution-environment"><a href="#preparing-the-execution-environment" class="header-anchor">#</a> Preparing the execution environment</h2> <p>This section provides a detailed overview and steps to configure the components deployed for this solution.</p> <h3 id="installer-machine"><a href="#installer-machine" class="header-anchor">#</a> Installer machine</h3> <p>This document assumes that a server running Red Hat Enterprise Linux 7.6 with the following configuration exists within the deployment environment and is accessible to the installation user to be used in an installer machine.</p> <ol><li><p>At least 200 GB of free disk space (especially in the &quot;/&quot; partition), 4 CPU cores and 8 GB RAM.</p></li> <li><p>One (1) network interface with static IP address configured on same network as the management plane of the bare-metal servers and has access to internet.</p></li></ol> <p>In this solution, a virtual machine is used to act as an installer machine and the same host is utilized as an Ansible Engine host.</p> <h4 id="setup-the-prerequisites"><a href="#setup-the-prerequisites" class="header-anchor">#</a> Setup the prerequisites</h4> <p>Login to the installer VM and perform the following steps:</p> <ol><li>Execute the following command to register the host and attach the host pool with Red Hat.</li></ol> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> subscription-manager register --username<span class="token operator">=</span><span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> --password<span class="token operator">=</span><span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> --auto-attach
</code></pre></div></blockquote> <ol start="2"><li>Disable all repositories and enable only the repositories required for the installer VM.</li></ol> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> subscription-manager repos --disable *
<span class="token operator">&gt;</span> subscription-manager repos --disable<span class="token operator">=</span><span class="token string">&quot;*&quot;</span> <span class="token punctuation">\</span>
  --enable<span class="token operator">=</span><span class="token string">&quot;rhel-7-server-rpms&quot;</span> <span class="token punctuation">\</span>
  --enable<span class="token operator">=</span><span class="token string">&quot;rhel-7-server-extras-rpms&quot;</span> <span class="token punctuation">\</span>
  --enable<span class="token operator">=</span><span class="token string">&quot;rhel-7-server-optional-rpms&quot;</span> <span class="token punctuation">\</span>
  --enable<span class="token operator">=</span><span class="token string">&quot;rhel-server-rhscl-7-rpms&quot;</span>
</code></pre></div></blockquote> <p>Perform the following steps to setup Python, Ansible, and the required repositories.</p> <ol><li>Use the following commands to install and enable Python 3.6.x.</li></ol> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> yum -y <span class="token function">install</span> rh-python36
<span class="token operator">&gt;</span> scl <span class="token builtin class-name">enable</span> rh-python36 <span class="token function">bash</span>
</code></pre></div></blockquote> <ol start="2"><li>Use the following commands to create and activate a Python3 virtual environment for deploying this solution.</li></ol> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> python3 -m venv <span class="token operator">&lt;</span>virtual_environment_name<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> <span class="token operator">&lt;</span>virtual_environment_name<span class="token operator">&gt;</span>/bin/activate
</code></pre></div></blockquote> <ol start="3"><li>Use the following command to install Ansible 2.9.</li></ol> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> python3 -m pip <span class="token function">install</span> <span class="token assign-left variable">ansible</span><span class="token operator">==</span><span class="token number">2.9</span>.0
</code></pre></div></blockquote> <ol start="4"><li>Execute the following commands in the Ansible Engine to download the repositories.</li></ol> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">mkdir</span> --p /opt/hpe/solutions/hpecp/
<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /opt/hpe/solutions/hpecp/
<span class="token operator">&gt;</span> yum <span class="token function">install</span> --y <span class="token function">git</span>
<span class="token operator">&gt;</span> <span class="token function">git</span> clone <span class="token operator">&lt;</span>https://github.com/HewlettPackard/hpe-solutions-hpecp.git<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span> <span class="token function">git</span> clone <span class="token operator">&lt;</span>https://github.com/HewlettPackard/oneview-ansible.git<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> oneview-ansible
<span class="token operator">&gt;</span> pip <span class="token function">install</span> --r requirements.txt
<span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">ANSIBLE_LIBRARY</span><span class="token operator">=</span>/opt/hpe/solutions/hpecp/oneview-ansible/library
<span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">ANSIBLE_MODULE_UTILS</span><span class="token operator">=</span>/opt/hpe/solutions/hpecp/oneview-ansible /library/module_utils
</code></pre></div></blockquote> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The value for the constant &quot;BASE_DIR&quot; referred to in this deployment guide is /opt/hpe/solutions/hpecp/hpe-solutions-hpecp/scripts/</p></div> <h4 id="ansible-inventory-file"><a href="#ansible-inventory-file" class="header-anchor">#</a> Ansible inventory file</h4> <p>The files that are cloned from the GitHub site include a sample inventory file. The installation user should review this file (located on the installer VM at <em>BASE_DIR/infrastructure/hosts and BASE_DIR/prepare_hpecp_hosts/hosts</em>) and ensure that the information within the file accurately reflects the information in their environment.</p> <p>Use an editor such as vi or nano to edit the inventory file.</p> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">vi</span> BASE_DIR/infrastructure/hosts
<span class="token operator">&gt;</span> <span class="token function">vi</span> BASE_DIR/prepare_hpecp_hosts/hosts
</code></pre></div></blockquote> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The values provided in the variable files, inventory files, figures, and tables in this document are intended to be used for reference purpose. It is expected that the installation user updates them to suit the local environment.</p></div> <p>By default, the forks parameter in Ansible is limited to 5. Execute the following command to update the Ansible configuration to increase the value of number of hosts that are getting configured using this playbook.</p> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">ANSIBLE_FORKS</span><span class="token operator">=</span><span class="token operator">&lt;</span>number_of_hosts_present_in_the_ansible_inventory_file<span class="token operator">&gt;</span>
</code></pre></div></blockquote> <h4 id="ansible-vault"><a href="#ansible-vault" class="header-anchor">#</a> Ansible vault</h4> <p>A preconfigured Ansible vault file (<em>secret.yml</em>) is provided as a part of this solution, which consists of sensitive information to support the host and virtual machine deployment.</p> <p>Run the following commands on the installer VM to edit the vault to match the installation environment.</p> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-vault edit BASE_DIR/infrastructure/secret.yml
<span class="token operator">&gt;</span> ansible-vault edit BASE_DIR/prepare_hpecp_hosts/secret.yml
</code></pre></div></blockquote> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The default password for the Ansible vault file is <em>changeme.</em></p></div> <h2 id="server-profiles"><a href="#server-profiles" class="header-anchor">#</a> Server profiles</h2> <p>Server profiles are used to configure the personality of the compute resources. A server profile allows a set of configuration parameters, including firmware recipe, network and storage, BIOS tuning, boot order configuration, local storage configuration, and more to be templatized. These templates are the key to deliver the &quot;infrastructure as code&quot; capabilities of the HPE Synergy platform. For the purpose of this solution, a template is created which can be leveraged for HPE Ezmeral Container Platform controller, Kubernetes master and worker nodes.</p> <h3 id="automation-overview"><a href="#automation-overview" class="header-anchor">#</a> Automation overview</h3> <p>The folder <strong>infrastructure</strong> within the folder BASE_DIR contains Ansible scripts to automate the creation of server profiles in HPE OneView. The scripts are as follows:</p> <ol><li><p><strong>inputs.yml</strong>: This file contains input variables to create the server profile template and server profile.</p></li> <li><p><strong>hosts</strong>: This is the inventory file which the installer VM will use to reference nodes for which the server profile needs to be created.</p></li> <li><p><strong>secret.yml</strong>: This is an Ansible vault file that consists of sensitive information, such as HPE OneView IP address and credentials.</p></li> <li><p><strong>playbooks</strong>: This folder consists of playbooks to upload firmware bundle, create server profile templates and the server profiles for controller, gateway, master and worker nodes.</p></li> <li><p><strong>roles</strong>: This folder consists of Ansible roles to upload firmware bundle, create the server profile template and server profile. Each role is associated with a set of tasks to accomplish the expected output and they are present in the task directory within the role.</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The parameter names are case sensitive. Ensure that parameter names and functions are accurately recorded for the installation environment. Any variation in parameter names and functions will result in the failure of automated configuration steps.</p></div> <h3 id="automated-deployment-of-server-profile"><a href="#automated-deployment-of-server-profile" class="header-anchor">#</a> Automated deployment of server profile</h3> <p>Perform the following steps to create server profiles for all the bare-metal nodes participating in the HPE Container Platform cluster.</p> <ol><li>Update the inventory file found at <em>BASE_DIR/infrastructure</em> directory within the installer VM to include server hardware details. The installation user should update the values to suit their environment.</li></ol> <blockquote><div class="language-vi extra-class"><pre class="language-text"><code>[server_profile_template]
&quot;Frame1, bay 5&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;master&quot;
&quot;Frame1, bay 6&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;worker&quot;
&quot;Frame1, bay 7&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;gateway&quot;
&quot;Frame1, bay 8&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;controller&quot;
[server_profile]
# format &quot;enclosure serial number, server bay number&quot;, type=&lt;server hardware type&gt; role=&lt;role(master/worker/controller) of the server&gt; name=&lt;server profile name&gt;
&quot;Frame1, bay 9&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;controller&quot; name=&quot;cp_controller_01&quot;
&quot;Frame2, bay 9&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;controller&quot; name=&quot;cp_controller_02&quot;
&quot;Frame3, bay 9&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;controller&quot; name=&quot;cp_controller_03&quot;
&quot;Frame1, bay 5&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;gateway&quot; name=&quot;cp_gateway_02&quot;
&quot;Frame2, bay 5&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;gateway&quot; name=&quot;cp_gateway_02&quot;
&quot;Frame1, bay 4&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;master&quot; name=&quot;cp_master_01&quot;
&quot;Frame2, bay 4&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;master&quot; name=&quot;cp_master_02&quot;
&quot;Frame3, bay 4&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;master&quot; name=&quot;cp_master_03&quot;
&quot;Frame1, bay 6&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;worker&quot; name=&quot;cp_worker_01&quot;
&quot;Frame2, bay 6&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;worker&quot; name=&quot;cp_worker_02&quot;
&quot;Frame3, bay 6&quot; type=&quot;SY 480 Gen10 1&quot; role=&quot;worker&quot; name=&quot;cp_worker_03&quot;
</code></pre></div></blockquote> <ol start="2"><li>Update the <em>input.yml</em> file found at *BASE_DIR/infrastructure. *</li></ol> <blockquote><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Variables for creating the Server Profile and Server Profile Template as per the OneView configuration</span>
<span class="token comment"># Example: enclosure_group: EG1</span>
<span class="token key atrule">enclosure_group</span><span class="token punctuation">:</span> &lt;Enclosure group name as per OneView<span class="token punctuation">&gt;</span>

<span class="token comment"># Example: deployment_network_name: TwentyNet</span>
<span class="token key atrule">deployment_network_name</span><span class="token punctuation">:</span> &lt;Deployment network name as per OneView<span class="token punctuation">&gt;</span>

<span class="token comment">#&lt;iscsi_A network name as per OneView&gt;</span>
<span class="token key atrule">iSCSI_A_network_name</span><span class="token punctuation">:</span> &lt;iSCSI_SAN_A primary iSCSI network name as per one view<span class="token punctuation">&gt;</span>

<span class="token comment">#&lt;iscsi_B network name as per OneView&gt;</span>
<span class="token key atrule">iSCSI_B_network_name</span><span class="token punctuation">:</span> &lt;iSCSI_SAN_B Secondary iSCSI network name as per one view<span class="token punctuation">&gt;</span>

<span class="token comment"># Example: worker_template_name: hpecp_worker_template</span>
<span class="token comment">#&lt;Custom name for workerServerProfileTemplate&gt;</span>
<span class="token key atrule">worker_template_name</span><span class="token punctuation">:</span> &lt;Custom name for worker_SPT<span class="token punctuation">&gt;</span>

<span class="token comment">#&lt;Custom name for gatewayServerProfileTemplate&gt;</span>
<span class="token key atrule">gateway_template_name</span><span class="token punctuation">:</span> &lt;Custom name for gateway_SPT<span class="token punctuation">&gt;</span>

<span class="token comment">#&lt;Custom name for MasterServerProfileTemplate&gt;</span>
<span class="token key atrule">master_template_name</span><span class="token punctuation">:</span> &lt;Custom name for master_SPT<span class="token punctuation">&gt;</span>

<span class="token comment">#&lt;Custom name for ControllerServerProfileTemplate&gt;</span>
<span class="token key atrule">controller_template_name</span><span class="token punctuation">:</span> &lt;Custom name for controller_SPT<span class="token punctuation">&gt;</span>

<span class="token comment"># This variable is required when user wants to upload a firmware bundle or firmware baseline for Compute Module of HPE Synergy to HPE OneView</span>
<span class="token comment"># Path on installer machine where the firmware bundle or firmware baseline for Compute Module of HPE Synergy is present.</span>
<span class="token comment"># This path should end with &quot;/&quot; but it should not include firmware file name.</span>
<span class="token comment"># Example: fw_bundle_path: BASE_DIR/infrastructure/roles/upload_firmware_bundle/files/</span>
<span class="token key atrule">fw_bundle_path</span><span class="token punctuation">:</span> &lt;Firmware Bundle file path<span class="token punctuation">&gt;</span>

<span class="token comment"># Provide the firmware file name with extension</span>
<span class="token comment"># fw_bundle_file_name: HPE_Synergy_Custom_SPP2019.12_20200326_Z7550-96866.iso</span>
<span class="token key atrule">fw_bundle_file_name</span><span class="token punctuation">:</span> &lt;Firmware file name with extension<span class="token punctuation">&gt;</span>

<span class="token comment">###### Enable or Diable Firmware update, BIOS Setttings, and iLO settings by changing the flag to true or false #########</span>
<span class="token comment"># manage firmware</span>
<span class="token key atrule">managefw</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># manage BIOS security settings</span>
<span class="token key atrule">manageBios</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">bioscomplianceControl</span><span class="token punctuation">:</span> Checked

<span class="token comment"># manage iLO User Account settings</span>
<span class="token key atrule">manageilo</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">ilocomplianceControl</span><span class="token punctuation">:</span> Checked
</code></pre></div></blockquote> <ol start="3"><li>Update the <em>secret.yml</em> found at *BASE_DIR/infrastructure. *</li></ol> <blockquote><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># oneview ip address and credentials.</span>
<span class="token key atrule">oneview_ip</span><span class="token punctuation">:</span> x.x.x.x
<span class="token key atrule">oneview_username</span><span class="token punctuation">:</span> &lt;username<span class="token punctuation">&gt;</span>
<span class="token key atrule">oneview_password</span><span class="token punctuation">:</span> &lt;password<span class="token punctuation">&gt;</span>
</code></pre></div></blockquote> <ol start="4"><li>After the inventory and variable files are updated with the appropriate values, execute the following commands on the installer VM to upload the firmware bundle, create the server profile template and server profile.</li></ol> <blockquote><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> BASE_DIR/infrastructure
<span class="token operator">&gt;</span> ansible-playbook -i hosts playbooks/upload_firmware_bundle.yml --ask-vault-pass
<span class="token operator">&gt;</span> ansible-playbook -i hosts playbooks/server_profile_template_fw.yml --ask-vault-pass
<span class="token operator">&gt;</span> ansible-playbook -i hosts playbooks/server_profile_fw.yml --ask-vault-pass
</code></pre></div></blockquote> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>BASE_DIR is defined and set in the <a href="#installer-machine">Installer machine</a> section within this document.</p></div> <h2 id="deploying-operating-system-on-bare-metal-nodes"><a href="#deploying-operating-system-on-bare-metal-nodes" class="header-anchor">#</a> Deploying operating system on bare metal nodes</h2> <p>This section outlines the steps to programmatically deploy RHEL 7.7 operating system on all the bare-metal nodes participating in the HPE Ezmeral Container Platform cluster.</p> <h3 id="automation-overview-2"><a href="#automation-overview-2" class="header-anchor">#</a> Automation overview</h3> <p>The folder <strong>os_deployment</strong> within the folder BASE_DIR consists of scripts to deploy operating system over bare metal servers using virtual media. An overview of the scripts are as follows:</p> <ol><li><p><strong>deploy_os.py</strong>: This is the main file which validates the prerequisites and triggers the OS deployment based on the type of the operating system.</p></li> <li><p><strong>setup.sh:</strong> This script configures the prerequisite environment required for the successful execution of OS deployment script.</p></li> <li><p><strong>requirements.txt:</strong> This file includes the list of prerequisites required for the OS installation and it will be installed by the setup.sh script.</p></li> <li><p><strong>kickstart_files</strong>: This folder consists of the kickstart files for RHEL installation.</p></li> <li><p><strong>input_files</strong>: This folder consists of 2 input files, config.json and server_details.json.</p> <p>a.  <strong>config.json:</strong> This file takes the input details related to web server and operating system to be installed.</p> <p>b.  <strong>server_details.json:</strong> This file takes the input details of custom configuration for servers on which operating system is to be installed.</p></li> <li><p><strong>rhel_operations.py:</strong> This script includes the functions relevant for the creation of custom RHEL image based on the input configuration.</p></li> <li><p><strong>ilo_operations.py:</strong> This script includes the functions relevant to iLO operations.</p></li> <li><p><strong>image_operations.py:</strong> This script includes the functions relevant to OS image related operations.</p></li> <li><p><strong>redfish_object.py:</strong> This script includes the functions relevant to iLO object related operations.</p></li></ol> <div class="custom-block warning"><p class="custom-block-title">Prerequisites</p> <ol><li><p>RHEL 7.7 ISO image is present in the HTTP file path within the installer machine.</p></li> <li><p>iLO account with administrative privileges is required for each of the servers whose OS is configured via automation enlisted in this section</p></li></ol></div> <h3 id="automated-deployment-of-operating-system"><a href="#automated-deployment-of-operating-system" class="header-anchor">#</a> Automated deployment of operating system</h3> <p>Perform the following steps to install RHEL 7.7 operating system on all the bare-metal nodes participating in the HPE Ezmeral Container Platform cluster.</p> <ol><li><p>Execute the following command to setup the prerequisite environment.</p> <blockquote><div class="language- extra-class"><pre class="language-text"><code>&gt; sh setup.sh
</code></pre></div></blockquote></li> <li><p>Update the Ansible vault input file, <em>input_files/config.json</em> file with the details of OneView, web server, and operating system to be installed. Execute the following command to edit the <em>config.json</em> input file.</p> <blockquote><div class="language- extra-class"><pre class="language-text"><code>&gt; ansible-vault edit config.json
</code></pre></div></blockquote> <p>Default password for the Ansible vault files config.json is <em>changeme</em>. Example values for the input configuration is as follows. It is expected to update this file to suit the installation environment.</p> <blockquote><div class="language-json extra-class"><pre class="language-json"><code>   <span class="token punctuation">{</span>
   <span class="token property">&quot;HTTP_server_base_url&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://10.0.x.x/&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;HTTP_file_path&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;/usr/share/nginx/html/&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;OS_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;rhel7&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;OS_image_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&lt;rhel_os_iso_image_name_with_extension&gt;&quot;</span>
   <span class="token punctuation">}</span>
</code></pre></div></blockquote> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Acceptable value for &quot;OS_type&quot; variable is &quot;rhel7&quot; for RHEL 7.7.</p></div></li> <li><p>Update the Ansible vault input file, <em>input_files/server_details.json</em> file with the details of servers on which operating system is to be installed.</p> <p>Execute the following command to edit the server_details.json input file.</p> <blockquote><div class="language- extra-class"><pre class="language-text"><code>&gt; ansible-vault edit server_details.json
</code></pre></div></blockquote> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>It is essential to provide a hashed password for the &quot;Host_Password&quot; field in the <em>server_details.json</em> input file. Execute the following command with the choice of password to generate an MD5 hash and provide its output to the &quot;Host_Password&quot; field.</p></div> <blockquote><div class="language- extra-class"><pre class="language-text"><code>&gt; openssl passwd -1 &lt;Password&gt;
</code></pre></div></blockquote> <p>Default password for the Ansible vault files server_details.json is <em>changeme</em>. Example values for the input configuration for deploying RHEL 7.7 is as follows. It is expected to update this file to suit the installation environment.</p> <blockquote><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
<span class="token property">&quot;Server_serial_number&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;MXxxxxxDN&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;ILO_Address&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;10.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;ILO_Username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&lt;username_of_iLO_account_with_admin_privileges&gt;&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;ILO_Password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&lt;password_of_iLO_account_with_admin_privileges&gt;&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Hostname&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;master01.twentynet.local&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_IP&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;20.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_Username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_Password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&lt;hashed_valued_of_complex_password&gt;&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_Netmask&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;255.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_Gateway&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;20.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_DNS&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;20.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Server_Role&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;master&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;Server_serial_number&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;MXxxxxxDN&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;ILO_Address&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;10.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;ILO_Username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;ILO_Password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Hostname&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;worker01.twentynet.local&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_IP&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;20.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_Username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_Password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&lt;hashed_valued_of_complex_password&gt;&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_Netmask&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;255.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_Gateway&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;20.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Host_DNS&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;20.x.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Server_Role&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Additional_Networks&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
<span class="token property">&quot;IP&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;30.0.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Netmask&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;255.255.x.x&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;IP&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;40.0.x.x&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;Netmask&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;255.255.x.x&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div></blockquote> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Acceptable value for &quot;Server_Role&quot; variable is &quot;master&quot; for RHEL controller node, RHEL gateway load balancer node or RHEL master node and &quot;worker&quot; for RHEL worker node.</p></div></li> <li><p>Execute the script to deploy the operating system.</p> <blockquote><div class="language- extra-class"><pre class="language-text"><code>&gt; python3 deploy_os.py
</code></pre></div></blockquote> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Generic settings done as a part of kickstart file for RHEL are as follows. It is recommended that the user reviews and modifies the kickstart files. (kickstart_files/ks_rhel7.cfg and kickstart_files/ks_rhel7_worker.cfg) to suit their requirements.</p></div> <ul><li><p>Graphical installation</p></li> <li><p>Language - en_US</p></li> <li><p>Keyboard &amp; layout - US</p></li> <li><p>System service chronyd disabled</p></li> <li><p>timezone - Asia/Kolkata</p></li> <li><p>Bootloader config</p> <ul><li><p>bootloader location=mbr</p></li> <li><p>clearpart --all --initlabel</p></li> <li><p>ignoredisk --only-use=sda</p></li> <li><p>part swap --asprimary --fstype=&quot;swap&quot; --size=77263</p></li> <li><p>part /boot --fstype xfs --size=300</p></li> <li><p>part /boot/efi --fstype=&quot;vfat&quot; --size=1024</p></li> <li><p>part / --size=500 --grow</p></li></ul></li> <li><p>NIC teaming is perfomed with devices ens3f0 and ens3f1. It is assigned with the Host_IP defined in the input_files/server_details.json input file.</p></li> <li><p>For the worker nodes, devices ens3f4 and ens3f5 are assigned with iSCSI_A IP address and iSCSI_B IP address respectively which is defined in the <em>input_files/server_details.json</em> file.</p></li></ul></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-hpecp/5.0/Physical environment configuration/Physical environment configuration.html" class="prev">
        Physical environment configuration
      </a></span> <span class="next"><a href="/hpe-solutions-hpecp/5.0/Deploy HPE Ezmeral Container Platform/Deploy HPE Ezmeral Container Platform.html">
        Deploy HPE Ezmeral Container Platform
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-hpecp/5.0/assets/js/app.9e57fa5b.js" defer></script><script src="/hpe-solutions-hpecp/5.0/assets/js/2.ca577d1f.js" defer></script><script src="/hpe-solutions-hpecp/5.0/assets/js/19.d4c727d2.js" defer></script>
  </body>
</html>
