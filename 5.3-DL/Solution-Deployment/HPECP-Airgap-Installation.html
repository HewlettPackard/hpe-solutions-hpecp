<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HPECP Airgap Installation | HPE EZMERAL CONTAINER PLATFORM 5.3 AND HPE EZMERAL DATA FABRIC ON DL SERVERS</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-hpecp/5.3-DL/assets/css/0.styles.0080ec46.css" as="style"><link rel="preload" href="/hpe-solutions-hpecp/5.3-DL/assets/js/app.0bf5fbdc.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.3-DL/assets/js/2.e4aa28f4.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.3-DL/assets/js/4.939e74e1.js" as="script"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/10.3e35ae29.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/11.7a78ade3.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/12.29c9290c.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/13.3abab25a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/14.f3739c20.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/15.7b65d052.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/16.aa61a115.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/17.e177a705.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/18.bf4d6486.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/19.821c324b.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/20.34cb7e9e.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/21.6efa84b0.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/22.e25ab30f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/23.10836832.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/24.70fbad91.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/25.79eb1c09.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/26.d079eae0.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/27.1500b9ac.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/28.2ccc6020.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/29.7254040f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/3.63bbce65.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/30.3252e07b.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/31.30b07ba7.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/32.6771f8e8.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/33.963c2f5f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/5.2592712f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/6.0eecfd8c.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/7.6c3a0600.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/8.42d5a489.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/9.80d6a3b4.js">
    <link rel="stylesheet" href="/hpe-solutions-hpecp/5.3-DL/assets/css/0.styles.0080ec46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-hpecp/5.3-DL/" class="home-link router-link-active"><!----> <span class="site-name">HPE EZMERAL CONTAINER PLATFORM 5.3 AND HPE EZMERAL DATA FABRIC ON DL SERVERS</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.3-DL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.3-DL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HPE EZMERAL CONTAINER PLATFORM 5.3 on HPE DL Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/Solution-Deployment-Flow.html" class="sidebar-link">Solution Deployment Flow</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/Host-Configuration.html" class="sidebar-link">Host configuration</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/Deploying-OS-On-Bare-Metal-Nodes.html" class="sidebar-link">Deploying operating system on bare-metal nodes</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/Preparing-SLES-15-Hosts-For-HPECP-Installation.html" class="sidebar-link">Preparing SLES 15 hosts for HPECP installation</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/Automated-HPECP-Deployment.html" class="sidebar-link">Automated HPE Ezmeral Container Platform deployment</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/Manually-Install-And-Configure-HPECP.html" class="sidebar-link">Manually Install and configure HPE Ezmeral Container Platform 5.3</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html" aria-current="page" class="active sidebar-link">HPECP Airgap Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#solution-components-overview" class="sidebar-link">Solution components overview</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#solution-architecture" class="sidebar-link">Solution architecture</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#rmt-server" class="sidebar-link">RMT server</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#enabling-slp-announcements" class="sidebar-link">Enabling SLP Announcements</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#mirror-suse-products-and-packages" class="sidebar-link">Mirror SUSE products and packages</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#download-the-packages" class="sidebar-link">Download the packages</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#disconnect-from-internet" class="sidebar-link">Disconnect from internet</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#docker-registry-and-k8s-rpms-repository-server" class="sidebar-link">Docker registry and K8s RPMs repository server</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#hpecp-deployment" class="sidebar-link">HPECP Deployment</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#hpecp-host-preparation" class="sidebar-link">HPECP Host preparation</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#preparing-legacy-gpu-hosts" class="sidebar-link">Preparing legacy GPU hosts</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#hpecp-controller" class="sidebar-link">HPECP controller</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#hpecp-gateway-server" class="sidebar-link">HPECP gateway server</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#kubernetes-hosts" class="sidebar-link">Kubernetes hosts</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/HPECP-Airgap-Installation.html#appendix" class="sidebar-link">Appendix</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hpecp-airgap-installation"><a href="#hpecp-airgap-installation" class="header-anchor">#</a> HPECP Airgap Installation</h1> <h2 id="solution-components-overview"><a href="#solution-components-overview" class="header-anchor">#</a> Solution components overview</h2> <ol><li><p>RMT server</p></li> <li><p>Repository server</p> <p>a.  Docker registry</p> <p>b.  K8s RPMs registry</p></li> <li><p>Deploying HPE Ezmeral Container Platform</p></li></ol> <h2 id="solution-architecture"><a href="#solution-architecture" class="header-anchor">#</a> Solution architecture</h2> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-1-1.89e319eb.png" alt=""></p> <p><strong>Figure 37:</strong> HPECP Airgap Architecture</p> <h2 id="rmt-server"><a href="#rmt-server" class="header-anchor">#</a> RMT server</h2> <h3 id="server-hardware-configuration"><a href="#server-hardware-configuration" class="header-anchor">#</a> Server hardware configuration</h3> <ol><li><p>Network adapter - 1 interface on the production network.</p></li> <li><p>CPU - 12 vCPU</p></li> <li><p>Memory - 36 GB</p></li> <li><p>Hard disk - a minimum of 3.5 TB</p> <p>a.  / - 2 TB</p> <p>b.  /home - 1 TB</p> <p>c.  /swap - 70 GB</p></li> <li><p>OS - SUSE Enterprise Linux 15 SP2
<img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-2.9aed2294.png" alt=""> <strong>Figure 38:</strong> Server Hardware Configuration</p></li></ol> <h3 id="partition-details"><a href="#partition-details" class="header-anchor">#</a> Partition details</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> lsblk
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT

sda 8:0 0 10T 0 disk

├─sda1 8:1 0 8M 0 part

└─sda2 8:2 0 10T 0 part

├─system-root 254:0 0 2T 0 lvm /

├─system-swap 254:1 0 70.8G 0 lvm

└─system-home 254:2 0 953.2G 0 lvm /home

sr0 11:0 1 663M 0 rom

sr1 11:1 1 1.1G 0 rom
</code></pre></div><h3 id="configuring-rmt-server"><a href="#configuring-rmt-server" class="header-anchor">#</a> Configuring RMT server</h3> <ol><li><p>While installing OS or once the OS is installed on the server to be used as SLES RMT server, provide the following details:</p> <ul><li><p>While installing OS</p> <ul><li>Select the registration method as <strong>&quot;register system via scc.suse.com&quot;</strong>  and provide the <strong>registered email address</strong> and <strong>registration code for &quot;SUSE Linux Enterprise Server for x86,
AMD64, Intel64&quot;</strong></li></ul></li> <li><p>Once OS is installed, register the system and enable required modules by executing below commands.</p> <ul><li><p>SUSEConnect -r REGISTRATION_CODE -e EMAIL_ADDRESS</p></li> <li><p>SUSEConnect -p sle-ha/15.2/x86_64 -r ADDITIONAL REGCODE</p></li> <li><p>SUSEConnect -p sle-caas/15.2/x86_64 -r ADDITIONAL REGCODE</p></li> <li><p>SUSEConnect -p sle-module-containers/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-desktop-applications/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-development-tools/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-cap-tools/15.2/x86_64</p></li> <li><p>SUSEConnect -p PackageHub/15.2/x86_64</p></li> <li><p>SUSEConnect -d -p sle-module-server-applications/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-legacy/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-public-cloud/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-web-scripting/15.2/x86_64</p></li></ul></li></ul></li> <li><p>Once the server is registered to SUSE and the required modules are enabled, perform the following steps to install RMT service. Ensure the server is connected to the internet at this moment.</p> <ul><li>Install the prerequisite modules<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> <span class="token function">screen</span> <span class="token function">vim</span> iputils bind-utils
</code></pre></div></li> <li>Install RMT server module<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> rmt-server
</code></pre></div></li></ul></li> <li><p>Configure RMT</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> yast2 rmt
</code></pre></div><p>This will open a wizard for configuring RMT service</p></li></ol> <ul><li><p>Enter your organization credentials. To retrieve your credentials, login to scc.suse.com/proxies and look for the &quot;Mirroring Credentials&quot;</p> <div class="language- extra-class"><pre><code>  ![](../media/SD-HA-3.png)

  **Figure 39:** Retrieve Credentials

  ![](../media/SD-HA-4.png)

  **Figure 40:** RMT configuration step 1

  ![](../media/SD-HA-5.png)

  **Figure 41:** RMT configuration step 1 successful
</code></pre></div></li> <li><p>Enter credentials for a new MariaDB user and database name. This user will then be created. Then select Next.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-6.3ea262f8.png" alt=""></p> <p><strong>Figure 42:</strong> RMT configuration step 2</p></li> <li><p>If a password for the MariaDB root user is already set, you are required to enter it. If no password is set for root, you are asked to enter a new one.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-7.f363e266.png" alt=""></p> <p><strong>Figure 43:</strong> RMT configuration set database root password</p></li> <li><p>Enter a common name for the SSL certificates. The common name should usually be the fully qualified domain name (FQDN) of the server. Enter all domain names and IP addresses with which you want to reach the RMT server as alternative common names.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-8.4d2d8c95.png" alt=""></p> <p><strong>Figure 44:</strong> RMT configuration step 3</p></li> <li><p>When all common names are entered, select Next.</p></li> <li><p>Provide a password for the CA private certificate key and click OK.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-9.31364969.png" alt=""></p> <p><strong>Figure 45:</strong> RMT configuration setting CA private key</p></li> <li><p>If firewalld is enabled on this system, enable the checkbox to open the required ports.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-10.3f52e691.png" alt=""></p> <p><strong>Figure 46:</strong> RMT configuration step 4</p></li> <li><p>Continue with Next.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-11.43e58867.png" alt=""></p> <p><strong>Figure 47:</strong> RMT configuration step 5</p></li> <li><p>To view the summary, click Next. Close YaST by clicking Finish. YaST then enables and starts all systemd services and timers.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-12.400ae3b8.png" alt=""></p> <p><strong>Figure 48:</strong> RMT configuration Summary</p></li></ul> <h2 id="enabling-slp-announcements"><a href="#enabling-slp-announcements" class="header-anchor">#</a> Enabling SLP Announcements</h2> <p>The SLP is service discovery protocol that allows computers and other devices to find services in a LAN without prior configuration. RMT includes the SLP service description file /etc/slp.reg.d/rmt-server.reg.</p> <p>To enable SLP announcements of the RMT service, follow these steps:</p> <ol><li>If firewalld is running, open relevant ports and reload the firewalld configuration:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> firewall-cmd --permanent --add-port<span class="token operator">=</span><span class="token number">427</span>/tcp
<span class="token operator">&gt;</span> firewall-cmd --permanent --add-port<span class="token operator">=</span><span class="token number">427</span>/udp
<span class="token operator">&gt;</span> firewall-cmd --reload
</code></pre></div><ol start="2"><li>Verify that SLP server is installed and possibly install it:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token function">install</span> openslp-server
</code></pre></div><p>3.Enable and start the SLP service:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> systemctl <span class="token builtin class-name">enable</span> slpd.service
<span class="token operator">&gt;</span> systemctl restart slpd.service
</code></pre></div><h2 id="mirror-suse-products-and-packages"><a href="#mirror-suse-products-and-packages" class="header-anchor">#</a> Mirror SUSE products and packages</h2> <ol><li>Synchronise all repositories and ID that you have access to.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> rmt-cli <span class="token function">sync</span>
</code></pre></div><ol start="2"><li>List and enable all the products</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> rmt-cli product list --all
<span class="token operator">&gt;</span> rmt-cli product <span class="token builtin class-name">enable</span> <span class="token operator">&lt;</span>ID<span class="token operator">&gt;</span>
</code></pre></div><ol start="3"><li>Start mirror of enabled products</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">screen</span> rmt-cli mirror
</code></pre></div><ol start="4"><li><p>Register clients to the RMT server using the following URL</p> <ul><li>As a boot parameter</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token assign-left variable">regurl</span><span class="token operator">=</span><span class="token punctuation">[</span>/<span class="token punctuation">]</span><span class="token punctuation">{</span>.ul<span class="token punctuation">}</span>
</code></pre></div><ul><li>As a local subscription server</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> SUSEConnect --url <span class="token punctuation">[</span>/<span class="token punctuation">]</span><span class="token punctuation">{</span>.ul<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="download-the-packages"><a href="#download-the-packages" class="header-anchor">#</a> Download the packages</h2> <p>The following files, packages and RPMs are necessary for installing Kubernetes cluster in HPECP in an airgap environment. Download them when the system is connected to internet. Once they are downloaded, disconnect the server from the internet.</p> <ol><li>Container images</li></ol> <p>Refer to appendix <a href="#appendix">Images required for deploying Kubernetes deployment</a> for detailed list of images to
install HPECP &amp; kubernetes in an airgap environment.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>For Internal QA -- link to obtain container images <a href="https://bdk8s.s3.us-east-2.amazonaws.com/5.3/3031/k8s-images.tgz" target="_blank" rel="noopener noreferrer">https://bdk8s.s3.us-east-2.amazonaws.com/5.3/3031/k8s-images.tgz<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <ol start="2"><li>Kubernetes RPMs</li></ol> <p>Refer to appendix for the <a href="#appendix">RPMs required for deploying Kubernetes</a> for a detailed list of RPMs required to install kubernetes in an airgap environment.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>For Internal link QA -- link to obtain kubernetes RPMs -- <a href="https://bdk8s.s3.us-east-2.amazonaws.com/5.3/3031/k8s-rpms.tar" target="_blank" rel="noopener noreferrer">https://bdk8s.s3.us-east-2.amazonaws.com/5.3/3031/k8s-rpms.tar<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h2 id="disconnect-from-internet"><a href="#disconnect-from-internet" class="header-anchor">#</a> Disconnect from internet</h2> <p>Once the server is connected to SUSE customer center, up to date with the repositories, packages, RPMs and files, and they are mirrored into the local repository, it is time to disconnect the server from the  internet. Refer to appendix <a href="#appendix">Simulating an air gap environment</a> for the configuration steps utilized in this document.</p> <h3 id="registering-to-rmt-server"><a href="#registering-to-rmt-server" class="header-anchor">#</a> Registering to RMT server</h3> <p>Once OS is installed, please refer to the <a href="/hpe-solutions-hpecp/5.3-DL/solution-deployment/preparing-sles-15-hosts-for-hpecp-installation.html">Preparing hosts for HPECP</a> section for registering client systems to RMT server.</p> <p>Make sure following modules are enabled and up to date by running</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> refresh
</code></pre></div><ul><li><p>SUSEConnect -p sle-ha/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-caas/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-containers/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-desktop-applications/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-development-tools/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-cap-tools/15.2/x86_64</p></li> <li><p>SUSEConnect -p PackageHub/15.2/x86_64</p></li> <li><p>SUSEConnect -d -p sle-module-server-applications/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-legacy/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-public-cloud/15.2/x86_64</p></li> <li><p>SUSEConnect -p sle-module-web-scripting/15.2/x86_64</p></li></ul> <h2 id="docker-registry-and-k8s-rpms-repository-server"><a href="#docker-registry-and-k8s-rpms-repository-server" class="header-anchor">#</a> Docker registry and K8s RPMs repository server</h2> <h3 id="server-hardware-configuration-2"><a href="#server-hardware-configuration-2" class="header-anchor">#</a> Server hardware configuration</h3> <ol><li>Network adapter - 1 interface on the production network.</li> <li>CPU - 2 vCPU</li> <li>Memory - 16GB</li> <li>Hard disk - a minimum of 500GB</li> <li>OS - SUSE Enterprise Linux 15 SP2<img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-13.bf0eb1f6.png" alt=""> <strong>Figure 49:</strong> Server Hardware details</li></ol> <h3 id="partition-details-2"><a href="#partition-details-2" class="header-anchor">#</a> Partition details</h3> <div class="language- extra-class"><pre class="language-text"><code>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT

sda 8:0 0 500G 0 disk

├─sda1 8:1 0 500M 0 part /boot/efi

└─sda2 8:2 0 499.5G 0 part

├─system-swap 254:0 0 63G 0 lvm [SWAP]

├─system-root 254:1 0 150G 0 lvm /

├─system-var 254:2 0 100G 0 lvm /var

├─system-srv 254:3 0 100G 0 lvm /srv

└─system-home 254:4 0 25G 0 lvm /home

sr0 11:0 1 1024M 0 rom

sr1 11:1 1 1024M 0 rom 
</code></pre></div><h3 id="configuring-docker-registry"><a href="#configuring-docker-registry" class="header-anchor">#</a> Configuring docker registry</h3> <p>Login to the server which would be utilized as the docker register and perform the following steps:</p> <ol><li><p>Register to the RMT server. Refer to section <a href="#registering-to-rmt-server">Registering to RMT server</a> for more details.</p></li> <li><p>Install and start Docker on SLES</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">zypper</span> <span class="token function">install</span> docker
docker --version
systemctl <span class="token builtin class-name">enable</span> docker.service
systemctl start docker.service
</code></pre></div><ol start="3"><li>Create registry on SLES as a docker container with restart policy as always.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> docker run -d -p <span class="token number">5000</span>:5000 --restart<span class="token operator">=</span>always --name registry registry:2
</code></pre></div><ol start="4"><li><p>Disconnect the server from the internet. Refer to section <a href="#appendix">Simulating an air gap environment</a> for more
details.</p></li> <li><p>Pull, Tag &amp; Push an image to the local registry</p></li></ol> <ul><li><p>Copy the container images tar file from the repository server into this server.</p></li> <li><p>Navigate to the folder containing images required for deploying HPECP</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>path_to_the_images_tar_file<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>Load the tar file containing the images required to setup the
kubernetes cluster from HPECP in an airgap environment. See Appendix for detailed list of images needed.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> docker load -i <span class="token operator">&lt;</span>images_tar_file<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>Tag each of the image from the list using the following command</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> docker tag <span class="token operator">&lt;</span>individual image name extracted from images_tar_file<span class="token operator">&gt;</span> /
localhost:5000/<span class="token operator">&lt;</span>individual image name extracted from images_tar_file<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>Push each of the tagged image using the following command</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> docker push localhost:5000/<span class="token operator">&lt;</span>individual image name extracted from images_tar_file<span class="token operator">&gt;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>There is a script available in k8simages.tgz called populate_registry.sh. Using this script, we can load, tag &amp; push all k8s images. Instead of tagging with localhost, it's better to tag with internal registry IP address.</p> <p>Eg: ./populate_registry.sh load k8s_container_metadata.txt &lt;registry_server_IP&gt;:5000</p> <p>k8s_container_metadata.txt file should have all images and example image as shown below:</p> <p>The k8s_container_metadata.txt file content as shown in below Figure</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-27.37aab531.png" alt=""></p> <p><strong>Figure 50:</strong> Registry file content</p> <p>k8s_container_metada.txt file content template as shown below</p> <p><code>&lt;Reference_to_image&gt; &lt;Image_name:tag&gt; &lt;Image_tar_file&gt;</code></p> <p>populate_registry.sh script content as shown below:</p> <div class="language- extra-class"><pre><code>$ cat populate_registry.sh
#!/bin/bash
if [ &quot;$#&quot; -lt 3 ]; then
    echo &quot;$0  &lt;load | pull&gt; &lt;k8s_metadata_file&gt; &lt;registry_url&gt; [&lt;registry_url&gt; &lt;registry_url&gt; ...]&quot;
    exit 1
fi
case $1 in
  load|pull)
    ;;
  *)
    echo &quot;$0 &lt;load | pull&gt; &lt;k8s_metadata_file&gt; &lt;registry_url&gt; [&lt;registry_url&gt; &lt;registry_url&gt; ...]&quot;
    exit 1
    ;;
esac

LOAD_OR_PULL=$1; shift
META_FILE=$1; shift
registry_urls=$@
echo &quot;File=$META_FILE&quot;

   for REG_URL in $registry_urls
   do
      echo &quot;Updating registry: $REG_URL&quot;
      echo &quot;&quot;
  while read LINE
  do
        DL_IMAGE_FILE_NAME=$(echo ${LINE} | cut -d' ' -f3)
    DL_FULL_IMAGE_NAME=$(echo ${LINE} | cut -d' ' -f2)
    case ${LOAD_OR_PULL} in
      load)
        echo &quot;load cmd: docker load -i ${DL_IMAGE_FILE_NAME}&quot;
        docker load -i ${DL_IMAGE_FILE_NAME}
        ;;
      pull)
        echo &quot;pull cmd: docker pull ${DL_FULL_IMAGE_NAME}&quot;
        docker pull ${DL_FULL_IMAGE_NAME}
        ;;
    esac

    echo &quot;tag cmd: docker tag ${DL_FULL_IMAGE_NAME} ${REG_URL}/${DL_FULL_IMAGE_NAME}&quot;
    docker tag ${DL_FULL_IMAGE_NAME} ${REG_URL}/${DL_FULL_IMAGE_NAME}

    echo &quot;push cmd: docker push ${REG_URL}/${DL_FULL_IMAGE_NAME}&quot;
    docker push ${REG_URL}/${DL_FULL_IMAGE_NAME}

    echo &quot;&quot;
  done &lt; ${META_FILE}
done
</code></pre></div></div></li> <li><p>Other than the images in k8s-images.tgz, we need below docker images from registry.suse.com</p> <ul><li>registry.suse.com/caasp/v4.5/kube-apiserver:v1.18.6</li> <li>registry.suse.com/caasp/v4.5/kube-controller-manager:v1.18.6</li> <li>registry.suse.com/caasp/v4.5/kube-scheduler:v1.18.6</li> <li>registry.suse.com/caasp/v4.5/kube-proxy:v1.18.6</li> <li>registry.suse.com/caasp/v4.5/pause:3.2</li> <li>registry.suse.com/caasp/v4.5/etcd:3.4.3</li> <li>registry.suse.com/caasp/v4.5/coredns:1.6.7</li></ul> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Please use below script to download suse images. Use this script on a server which have internet access.</p></div> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-14.14eea213.png" alt=""> <strong>Figure 51:</strong> Script to download suse images</p></li></ul> <ol start="6"><li>Test the presence of images</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> docker images
<span class="token operator">&gt;</span> docker images <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;'internal registry ip address':5000&quot;</span>
</code></pre></div><h3 id="validate-registry-from-local-environment"><a href="#validate-registry-from-local-environment" class="header-anchor">#</a> Validate registry from local environment</h3> <ol><li>Within the same server</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> docker pull <span class="token operator">&lt;</span>image_not_present_in_registry<span class="token operator">&gt;</span> - fail since internet isn't available
<span class="token operator">&gt;</span> docker pull <span class="token operator">&lt;</span>image_within_registry<span class="token operator">&gt;</span> - success
</code></pre></div><ol start="2"><li><p>Outside of this registry server, on the hosts that need access to the local docker registry</p> <ul><li>Create or update the /etc/docker/daemon.json on the docker hosts which needs access to the above created docker registry. Assuming there are no other settings in the file, it should have the
following contents:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">{</span>
<span class="token string">&quot;insecure-registries&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;registry_server_ip_address&gt;:5000&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Substitute the &quot;&lt;registry_server_ip_address&gt;&quot; with the address of insecure registry.</p> <ul><li>Restart Docker for the changes to take effect.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> systemctl restart docker.service
</code></pre></div><ul><li>Pull the images</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> docker pull <span class="token operator">&lt;</span>image_not_present_in_registry<span class="token operator">&gt;</span> - fail since internet isn't available
<span class="token operator">&gt;</span> docker pull <span class="token operator">&lt;</span>image_within_registry<span class="token operator">&gt;</span> - success
</code></pre></div></li></ol> <h3 id="configuring-kubernetes-rpms-server"><a href="#configuring-kubernetes-rpms-server" class="header-anchor">#</a> Configuring Kubernetes RPMs server</h3> <ol><li>Install Nginx</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> nginx
</code></pre></div><ol start="2"><li>Check the nginx configuration file (/etc/nginx/nginx.conf) to know the nginx server root directory.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>nginx _server_root_directory<span class="token operator">&gt;</span>
</code></pre></div><ol start="3"><li>Copy and untar the kubernetes RPM tar file within the nginx server root directory.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>Copy kubernetes.tar <span class="token function">file</span> under NGINX configuration <span class="token function">file</span> location
        location /kubernetes/ <span class="token punctuation">{</span>
            root   /srv/www/htdocs/<span class="token punctuation">;</span>
            autoindex on<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /srv/www/htdocs
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> Copy kubernetes.tar <span class="token function">file</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">tar</span> xvf kubernetes.tar
</code></pre></div><ol start="4"><li>Start the Nginx web service</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> systemctl <span class="token builtin class-name">enable</span> nginx
<span class="token operator">&gt;</span> systemctl start nginx
</code></pre></div><h3 id="troubleshooting"><a href="#troubleshooting" class="header-anchor">#</a> Troubleshooting</h3> <p>In case there is an issue NGINX &quot;403 Forbidden&quot; Error, perform the following steps</p> <ol><li>Ensure right file permissions are set to the files to be served by web server</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">chmod</span> <span class="token number">755</span> <span class="token operator">&lt;</span>path_to_k8s_rpms_in_nginx_root_directory<span class="token operator">&gt;</span>
</code></pre></div><ol start="2"><li>Change the ownership of all the files</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">chown</span> -R nginx:nginx *
</code></pre></div><ol start="3"><li>Restart NGINX</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> nginx -s reload
</code></pre></div><h3 id="validate-the-availability-of-kubernetes-rpms"><a href="#validate-the-availability-of-kubernetes-rpms" class="header-anchor">#</a> Validate the availability of Kubernetes RPMs</h3> <p>To validate if the kubernetes RPMs is accessible, execute the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">curl</span> http://<span class="token operator">&lt;</span>webserver_ip_address<span class="token operator">&gt;</span>/kubernetes/
</code></pre></div><h2 id="hpecp-deployment"><a href="#hpecp-deployment" class="header-anchor">#</a> HPECP Deployment</h2> <h3 id="operating-system-deployment-for-hpecp-hosts"><a href="#operating-system-deployment-for-hpecp-hosts" class="header-anchor">#</a> Operating System Deployment for HPECP hosts</h3> <p>The supported version of SLES for deploying HPE Container Platform is SUSE Enterprise Linux 15 SP2. This section outlines the manual steps involved in deploying OS for the servers used as HPECP controller, HPECP gateway, kubernetes master and kubernetes worker nodes.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>OS can be deployed by using the script located in <a href="https://github.com/HewlettPackard/hpe-solutions-hpecp/tree/master/DL/scripts/os_deployment" target="_blank" rel="noopener noreferrer">https://github.com/HewlettPackard/hpe-solutions-hpecp/tree/master/DL/scripts/os_deployment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Please refer to the &quot;<a href="/hpe-solutions-hpecp/5.3-DL/solution-deployment/deploying-os-on-bare-metal-nodes.html">Deploying operating system on bare-metal nodes</a>&quot; section in this document for more details.</p></div> <ol><li><p>Boot using the installation Media select language &amp; and the product &quot;Sles 15 SP2&quot;.</p></li> <li><p>Select you registration method as the RMT server set up previously in section RMT server and choose &quot;yes&quot; to receive updated repos.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-15.2d004bca.png" alt=""> <strong>Figure 52:</strong> Registration Method</p></li> <li><p>Select the following Extension and Modules:</p> <ul><li><p>sle-ha/15.2/x86_64</p></li> <li><p>caasp/4.5/x86_64</p></li> <li><p>PackageHub/15.2/x86_64</p></li> <li><p>sle-module-legacy/15.2/x86_64</p></li> <li><p>sle-module-python2/15.2/x86_64</p></li> <li><p>sle-module-containers/15.2/x86_64</p></li> <li><p>sle-module-basesystem/15.2/x86_64</p></li> <li><p>sle-module-public-cloud/15.2/x86_64</p></li> <li><p>sle-module-desktop-applications/15.2/x86_64</p></li> <li><p>sle-module-server-applications/15.2/x86_64</p></li> <li><p>sle-module-development-tools/15.2/x86_64</p></li></ul></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Alternatively, refer to the section <a href="#registering-to-rmt-server">Registering to RMT server</a> for registering to RMT server once OS is
installed.</p></div> <ol start="4"><li><p>Using guided Partitioning setup the OS partition as shown below</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-16.1dc5b4b5.png" alt=""></p> <p><strong>Figure 53:</strong> OS Partitioning</p></li> <li><p>Choose &quot;minimal&quot; installation mode:</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-17.18536b80.png" alt=""></p> <p><strong>Figure 54:</strong> System Role</p></li> <li><p>In the install summary ensure SSH access is enabled and then click Install.
<img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-18.74c3e479.png" alt=""></p> <p><strong>Figure 55:</strong> Enable SSH Access</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>DNS/Bind A record, PTR record is required for the HPE CP installation.</p></div> <h2 id="hpecp-host-preparation"><a href="#hpecp-host-preparation" class="header-anchor">#</a> HPECP Host preparation</h2> <p>This section covers manual steps for preparing Hosts for ECP Ezmeral Container Platform. Automated script is available for HPECP Host preparation at
<a href="https://github.com/HewlettPackard/hpe-solutions-hpecp/tree/master/DL/scripts/prepare_hpecp_hosts" target="_blank" rel="noopener noreferrer">https://github.com/HewlettPackard/hpe-solutions-hpecp/tree/master/DL/scripts/prepare_hpecp_hosts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
Please refer to the following section &quot;<a href="/hpe-solutions-hpecp/5.3-DL/solution-deployment/preparing-sles-15-hosts-for-hpecp-installation.html">Host Preparation</a>&quot; section in this document for more details.</p> <ol><li>If using proxy or ignore, setup proxy as shown below in the configuration file - /etc/sysconfig/proxy</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&gt; NO_PROXY=&quot;localhost, 127.0.0.1l&quot;
&gt; HTTP_PROXY=&quot;http://&lt;proxy server&gt;:port/&quot;
&gt; HTTPS_PROXY=&quot; http://&lt;proxy server&gt;:port/&quot;
</code></pre></div><ol start="2"><li>Fix autofs configuration.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> autofs
<span class="token operator">&gt;</span> <span class="token function">sed</span> -i<span class="token string">''</span> -e <span class="token string">&quot;s|#/net.*$|/net -hosts|g&quot;</span> /etc/auto.master
</code></pre></div><ol start="3"><li>Install libcgroup V1</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> libcgroup1
</code></pre></div><ol start="4"><li>Reboot the server</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&gt; reboot
</code></pre></div><ol start="5"><li>Perform a system update if necessary</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&gt; zypper up --non-interactive
</code></pre></div><h2 id="preparing-legacy-gpu-hosts"><a href="#preparing-legacy-gpu-hosts" class="header-anchor">#</a> Preparing legacy GPU hosts</h2> <p>All the above repos for worker hosts are required. In addition, perform the following steps from
<a href="http://docs.bluedata.com/50_gpu-driver-installation" target="_blank" rel="noopener noreferrer">http://docs.bluedata.com/50_gpu-driver-installation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Except of course, you will be using zypper instead of yum.</p> <p>For the new kernel to load.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token function">install</span> kernel-default-devel gcc-c++ perl pciutils
</code></pre></div><p>In addition, you need to install the following package before running the NVIDIA installer on the host.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> libglvnd-devel
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If the server is not rebooted platform install will fail. You may choose to not reboot now for GPU hosts.</p></div> <h2 id="hpecp-controller"><a href="#hpecp-controller" class="header-anchor">#</a> HPECP controller</h2> <p>Once the OS is installed as per the section <a href="#operating-system-deployment-for-hpecp-hosts">Operating System Deployment for HPECP hosts</a>, login to the server to be configured as the HPECP controller and perform the steps as per <a href="#hpecp-host-preparation">Host preparation</a> section.</p> <h3 id="installing-hpecp-controller-for-sles"><a href="#installing-hpecp-controller-for-sles" class="header-anchor">#</a> Installing HPECP Controller for SLES</h3> <p>On the same server, perform the following steps to install HPECP controller</p> <ol><li><p>Copy the hpe-cp-sles-release-5.3-xxxx.bin to /root folder from the repository server.</p> <p>You can download .bin file from
https://bdk8s.s3.us-east-2.amazonaws.com/5.3/3031/hpe-cp-sles-release-5.3-3031.bin</p></li> <li><p>Copy the feed.json file from the repository server to the /srv/bluedata/catalog folder.</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">mkdir</span> -p /srv/bluedata/catalog
<span class="token operator">&gt;</span> <span class="token function">cp</span> <span class="token operator">&lt;</span>location_of_feed.json_in_controller<span class="token operator">&gt;</span> /srv/bluedata/catalog/
</code></pre></div><ol start="3"><li>Give execute permission using the following command</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">chmod</span> +x /root/hpe-cp-sles-release-5.3-xxxx.bin
<span class="token operator">&gt;</span> <span class="token function">chmod</span> +x /srv/bluedata/catalog/
<span class="token operator">&gt;</span> <span class="token function">chmod</span> +x /srv/bluedata/catalog/*
</code></pre></div><ol start="4"><li>Execute the HPECP bin file using the following command</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ./hpe-cp-sles-release-5.3-3031.bin --default-password <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>
</code></pre></div><ol start="5"><li><p>Once completed, Login to the controller via browser to land to the admin UI</p></li> <li><p>Once logged in to the HPECP Controller UI, configure the controller by providing the details as shown in the following figure and click submit.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-19.1d57b350.png" alt=""></p> <p><strong>Figure 56:</strong> HPECP controller configuration</p></li> <li><p>Controller installation is then instantiated, wait until it is complete.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-20.c259b2b0.png" alt=""></p> <p><strong>Figure 57:</strong> HPECP controller setup</p></li> <li><p>Once the installation is complete, the HPECP login page would be accessible.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-21.ca5497d6.png" alt=""></p> <p><strong>Figure 58:</strong> HPECP Login Page</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-28.b7da22d1.png" alt=""></p> <p><strong>Figure 59:</strong> HPECP Dashboard</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Default credentials to HPECP login access is admin/admin123</p></div> <h2 id="hpecp-gateway-server"><a href="#hpecp-gateway-server" class="header-anchor">#</a> HPECP gateway server</h2> <p>Once the OS is installed as per the section <a href="#operating-system-deployment-for-hpecp-hosts">Operating System Deployment for HPECP hosts</a>, login to the server to be configured as the HPECP controller and perform the steps as per <a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/Manually-Install-And-Configure-HPECP.html#hpe-ezmeral-container-platform-gateway">gateway</a> section.</p> <h3 id="airgap-settings-in-hpecp-controller"><a href="#airgap-settings-in-hpecp-controller" class="header-anchor">#</a> Airgap settings in HPECP Controller</h3> <p>The Air Gap tab of the System Settings screen allows the Platform Administrator to specify &quot;air gap&quot; settings to be used when the Kubernetes hosts, clusters, and tenants within HPE Container Platform do not have connectivity to the Internet.</p> <p>Enter the following settings:</p> <ul><li><p>Yum repository section of this tab:</p> <ul><li><p>Base URL: This is the URL to the YUM repository.</p></li> <li><p>Repo GPG URL: This is the URL to the YUM repository GNU Privacy Guard (optional).</p></li> <li><p>RPM GPG URL: This is the URL to the RPM repository GNU Privacy Guard (optional).</p></li></ul></li> <li><p>The Container Registry section of this tab:</p> <ul><li><p>Container URL: URL to the Docker registry that contains the images needed for air-gap Kubernetes installations within HPE Container Platform.</p></li> <li><p>Username: Username to access the Docker registry, if needed.</p></li> <li><p>Password: Password to access the Docker registry, if needed.</p></li> <li><p>Secured: Checking the Secured checkbox indicates that the Kubernetes air-gap Docker registry is secure.</p></li> <li><p>Docker Client Certificate: Location of the Docker registry certificate, if you are using a secured connection. Clicking the Browse button opens a browser-standard Open dialog box that allows you to navigate to and locate the certificate to add.</p></li> <li><p>Clicking Submit saves your changes.</p></li></ul> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-23.cccb3197.png" alt=""></p> <p><strong>Figure 60:</strong> Airgap Settings</p></li></ul> <h2 id="kubernetes-hosts"><a href="#kubernetes-hosts" class="header-anchor">#</a> Kubernetes hosts</h2> <h3 id="preparing-kubernetes-hosts"><a href="#preparing-kubernetes-hosts" class="header-anchor">#</a> Preparing Kubernetes hosts</h3> <p>Once the OS is installed as per the section <a href="#operating-system-deployment-for-hpecp-hosts">Operating System Deployment for HPECP hosts</a>, login to the server to be configured as the HPECP controller and perform the steps as per <a href="#hpecp-host-preparation">Host preparation</a> section.</p> <p>After the hosts are prepared, login to the servers and perform the following:</p> <ul><li><p>Edit the /etc/sysctl.conf file and turn off reverse path filter (add the following line if necessary):</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">vi</span> /etc/sysctl.conf
<span class="token operator">&gt;</span> net.ipv4.conf.all.rp_filter <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div></li> <li><p>Reboot the server for changes to reflect</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">reboot</span>
</code></pre></div></li> <li><p>Turn off swap</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> swapoff -a
</code></pre></div><p>Once above-mentioned configurations are completed on the host, we can perform the kubernetes host installation and create the kubernetes cluster</p></li></ul> <h3 id="kubernetes-host-installation"><a href="#kubernetes-host-installation" class="header-anchor">#</a> Kubernetes host installation</h3> <p>Please refer to the &quot;<a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/manually-install-and-configure-hpecp.html#add-kubernetes-hosts">Adding Kubernetes Hosts</a>&quot; section in this document for installing Hosts.&quot; section in this document for installing Hosts.</p> <h3 id="creating-a-kubernetes-cluster"><a href="#creating-a-kubernetes-cluster" class="header-anchor">#</a> Creating a Kubernetes Cluster</h3> <p>Please refer to the &quot;<a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/manually-install-and-configure-hpecp.html#create-a-kubernetes-cluster">Creating Kubernetes Cluster</a>&quot; section in this document for creating cluster.</p> <h3 id="launching-kubernetes-dashboard"><a href="#launching-kubernetes-dashboard" class="header-anchor">#</a> Launching Kubernetes Dashboard</h3> <p>Please refer to the &quot;<a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/manually-install-and-configure-hpecp.html#launch-the-kubernetes-dashboard">Launching Kubernetes Dashboard</a>&quot; section to launch kubernetes dashboard</p> <h3 id="validating-the-deployment"><a href="#validating-the-deployment" class="header-anchor">#</a> Validating the deployment</h3> <p>The following example is based on the WordPress and MySQL with Persistent Volume described <a href="https://kubernetes.io/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>MySQL and WordPress each require a Persistent Volume to store data. Their Persistent Volume Claims will be created at the deployment step. HPE Container Platform uses MapR as the default persistent volume.</p> <ul><li>Begin by adding a Secret generator in kustomization.yaml by executing the following command, being sure to replace YOUR_PASSWORD with the password you want to use.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">mkdir</span> wordpress
<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> wordpress
<span class="token operator">&gt;</span> <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">&gt;</span>./kustomization.yaml
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">secretGenerator</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>pass
<span class="token key atrule">literals</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> password=YOUR_PASSWORD
EOF
</code></pre></div><ul><li><p>Next, use either of the following methods, create manifests based on the following two yaml manifest files for the MySQL and WordPress services, respectively:</p> <ul><li><p><a href="https://kubernetes.io/examples/application/wordpress/mysql-deployment.yaml" target="_blank" rel="noopener noreferrer">https://kubernetes.io/examples/application/wordpress/mysql-deployment.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://kubernetes.io/examples/application/wordpress/wordpress-deployment.yaml" target="_blank" rel="noopener noreferrer">https://kubernetes.io/examples/application/wordpress/wordpress-deployment.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></li> <li><p>If you installed HPE Container Platform with tenant storage, then MapR will already be registered as the default Storage Class in this namespace.</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get StorageClass
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>NAME PROVISIONER AGE
default (default) com.mapr.csi-kdf 39h
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl describe StorageClass
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Name : default
IsDefaultClass : Yes
Annotations : storageclass.kubernetes.io/is-default-class=true
Provisioner : com.mapr.csi-kdf
Parameters :
cldbHosts=192.168.20.131:7222,cluster=epic.mapr.cluster,csi.storage.k8s.io/provisioner-secret-name=mapr-user-secret,csi.storage.k8s.io/provisioner-secret-namespace=mapr-csi,csiNodePublishSecretName=mapr-ticket-secret,csiNodePublishSecretNamespace=mapr-csi,mountPre
fix=/mapr-csi,namePrefix=k8s-1-,platinum=true,restServers=192.168.20.131:8443,securityType=secure
AllowVolumeExpansion : &lt;unset&gt;
MountOptions : &lt;none&gt;
ReclaimPolicy : Delete
VolumeBindingMode : Immediate
Events : &lt;none&gt;
</code></pre></div><p>In these two manifest files, both the WordPress service and MySQL are requesting a persistent volume (PV)</p> <p>Neither pod makes any explicit request for a specific storageClassName. Hence, they will use the default MapR StorageClass.</p> <ul><li>Edit the WordPress manifest yaml to use the NodePort service instead of LoadBalancer service. This needs to be done in order for HPE Container Platform to re-map the ports.</li></ul> <p>Continue by adding these two manifests to the kustomization.yaml file.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">&gt;&gt;</span>./kustomization.yaml
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> mysql<span class="token punctuation">-</span>deployment.yaml
<span class="token punctuation">-</span> wordpress<span class="token punctuation">-</span>deployment.yaml
EOF
</code></pre></div><ul><li>The kustomization.yaml contains all of the resources for deploying a WordPress site and a MySQL database. You can apply the directory, and then verify both the MapR volumes and the services, as follows:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl apply --kustomize ./
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>secret/mysql-pass-9tt65k5fgm created
service/wordpress-mysql created
service/wordpress created
deployment.apps/wordpress-mysql created
deployment.apps/wordpress created
persistentvolumeclaim/mysql-pv-claim created
persistentvolumeclaim/wp-pv-claim created
</code></pre></div><ul><li>Confirm that PVC is using the MapR StorageClass (see highlighted text below).</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get pvc
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
mysql-pv-claim Bound mapr-pv-16f97a33-b8dd-488a-b6db-1d94a84286e2 20Gi
RWO default 48s
wp-pv-claim Bound mapr-pv-896b3504-e9ba-4593-b9a0-88a9ece392b5 20Gi RWO
default 48s
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get <span class="token function">pv</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS
REASON AGE

mapr-pv-32850109-ef66-42db-9522-b563fbc01eae 10Gi RWO Delete Bound
bdwebterm/pvc-kd-977sb-0 default 41h

mapr-pv-a24b1733-39db-40d2-bdaf-0be7c22ed83b 10Gi RWO Delete Bound
bdwebterm/pvc-kd-nbwhn-0 default 31h

mapr-pv-dbf96aed-dafd-47b7-87d4-7d343f182d8b 20Gi RWO Delete Bound
default/mysql-pv-claim default 69s

mapr-pv-e3c1db71-2865-425c-971e-c01466e9d295 20Gi RWO Delete Bound
default/wp-pv-claim default 69s

mapr-pv-ed5f1be3-9be2-4470-83cf-67f9b31e9dbf 10Gi RWO Delete Bound
bdwebterm/pvc-kd-dl2
</code></pre></div><ul><li>Label the WordPress service so that the front-end NodePort service will be exposed via the HPE Container Platform Gateway host. This step is not necessary if the service was created in the namespace of a tenant that has the Map Services to Gateway option enabled.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get services
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
kubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 26h
wordpress NodePort 10.96.98.248 &lt;none&gt; 80:30996/TCP 24s
wordpress-mysql ClusterIP None &lt;none&gt; 3306/TCP 24s
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl label svc wordpress hpecp.hpe.com/hpecp-internal-gateway<span class="token operator">=</span>true
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>service/wordpress labeled
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl describe <span class="token function">service</span> wordpress
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Name: wordpress
Namespace: default
Labels: app=wordpress
hpecp.hpe.com/hpecp-internal-gateway=true
Annotations: hpecp-internal-gateway/80: mip.storage.enterprise.net:10006
Selector: app=wordpress,tier=frontend
Type: NodePort
IP: 10.96.98.248
Port: &lt;unset&gt; 80/TCP
TargetPort: 80/TCP
NodePort: &lt;unset&gt; 30996/TCP
Endpoints: 10.244.2.11:80
Session Affinity: None
External Traffic Policy: Cluster
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal Service 26s kubedirector Created HPECP K8S service
</code></pre></div><ul><li><p>Copy the IP address and port number (see highlighted text above) to your browser. You should see set-up page similar to the following screenshot:</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/SD-HA-24.954a0c78.png" alt=""></p> <p><strong>Figure 61:</strong> Wordpress Application</p></li> <li><p>Destroy the application deployments (e.g. pods) and restart the deployments, making sure to preserve the WordPress application information and still preserved.</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl delete deployment wordpress
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>deployment.extensions &quot;wordpress&quot; deleted
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl delete deployment wordpress-mysql
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>deployment.extensions &quot;wordpress-mysql&quot; deleted
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get pods
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>No resources found.
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get deployments
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>No resources found.
</code></pre></div><p>The service is gone, as expected.</p> <div class="language- extra-class"><pre><code>![](../media/SD-HA-25.png)

**Figure 62:** Wordpress application is removed
</code></pre></div><ul><li>Reapply the same deployment, and reconnect to persistent storage.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl apply -k ./
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>secret/mysql-pass-9tt65k5fgm unchanged
service/wordpress-mysql unchanged
service/wordpress unchanged
deployment.apps/wordpress-mysql created
deployment.apps/wordpress created
persistentvolumeclaim/mysql-pv-claim unchanged
persistentvolumeclaim/wp-pv-claim unchanged
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get pods
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>NAME READY STATUS RESTARTS AGE
wordpress-594759d7f6-jdnvp 1/1 Running 0 27s
wordpress-mysql-847b7b996d-dwf6s 1/1 Running 0 28s
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl describe <span class="token function">service</span> wordpress
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Name: wordpress
Namespace: default
Labels: app=wordpress
Hpecp.hpe.com/hpecp-internal-gateway=true
Annotations: hpecp-internal-gateway/80: mip.storage.enterprise.net:10006
Selector: app=wordpress,tier=frontend
Type: NodePort
IP: 10.96.35.129
Port: &lt;unset&gt; 80/TCP
TargetPort: 80/TCP
NodePort: &lt;unset&gt; 31589/TCP
Endpoints: 10.244.1.18:80
Session Affinity: None
External Traffic Policy: Cluster
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal Service 12m kubedirector Created HPECP K8S service
</code></pre></div><p>The WordPress service is restored.</p> <ul><li>Finally, you will need to delete the entire deployment in order to free up all of the resources, including the persistent storage.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl delete -k ./
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>secret &quot;mysql-pass-9tt65k5fgm&quot; deleted
service &quot;wordpress-mysql&quot; deleted
service &quot;wordpress&quot; deleted
deployment.apps &quot;wordpress-mysql&quot; deleted
deployment.apps &quot;wordpress&quot; deleted
persistentvolumeclaim &quot;mysql-pv-claim&quot; deleted
persistentvolumeclaim &quot;wp-pv-claim&quot; deleted
</code></pre></div><h2 id="appendix"><a href="#appendix" class="header-anchor">#</a> Appendix</h2> <h3 id="simulating-an-air-gap-environment"><a href="#simulating-an-air-gap-environment" class="header-anchor">#</a> Simulating an air gap environment</h3> <ol><li>Update a dummy gateway IP address in either of the following files</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">vi</span> /etc/sysconfig/network/ifcfg-eth0
<span class="token operator">&gt;</span> <span class="token function">vi</span> /etc/sysconfig/network/ifroute-eth0
</code></pre></div><ol start="2"><li>Restart the network</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> systemctl restart network
</code></pre></div><ol start="3"><li>Validate if the server is disconnected to internet or not</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">curl</span> api.ipify.org
</code></pre></div><p>This command provides the external facing IP address of the server in the event server is connected to the internet</p> <h3 id="suse-rmt-server"><a href="#suse-rmt-server" class="header-anchor">#</a> SUSE RMT server</h3> <p>This section provides a detailed list of SUSE RPMs required for bringing up the HPECP setup on SUSE Linux SP2 in an airgap environment.</p> <h4 id="suse-products-and-extensions-overview"><a href="#suse-products-and-extensions-overview" class="header-anchor">#</a> SUSE products and extensions overview</h4> <table><thead><tr><th>ID</th> <th>Product</th> <th>Mandatory</th> <th>Mirror ?</th></tr></thead> <tbody><tr><td>4450</td> <td>SLE-15-SP2-Desktop-NVIDIA-Driver for</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4001</td> <td>SLE-Module-Basesystem15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3999</td> <td>SLE-Module-Basesystem15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4098</td> <td>SLE-Module-Containers15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4096</td> <td>SLE-Module-Containers15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4118</td> <td>SLE-Module-Desktop-Applications15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4116</td> <td>SLE-Module-Desktop-Applications15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4138</td> <td>SLE-Module-DevTools15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4136</td> <td>SLE-Module-DevTools15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4173</td> <td>SLE-Module-HPC15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4171</td> <td>SLE-Module-HPC15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4193</td> <td>SLE-Module-Legacy15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4191</td> <td>SLE-Module-Legacy15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4033</td> <td>SLE-Module-Packagehub-Subpackages15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4030</td> <td>SLE-Module-Packagehub-Subpackages15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4223</td> <td>SLE-Module-Public-Cloud15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4221</td> <td>SLE-Module-Public-Cloud15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4243</td> <td>SLE-Module-Python2-15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4241</td> <td>SLE-Module-Python2-15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4058</td> <td>SLE-Module-Server-Applications15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4056</td> <td>SLE-Module-Server-Applications15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4163</td> <td>SLE-Module-Web-Scripting15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4161</td> <td>SLE-Module-Web-Scripting15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4078</td> <td>SLE-Product-HA15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4076</td> <td>SLE-Product-HA15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3934</td> <td>SLE-Product-HPC-15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3932</td> <td>SLE-Product-HPC-15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3939</td> <td>SLE-Product-SLED15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3937</td> <td>SLE-Product-SLED15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3963</td> <td>SLE-Product-SLES15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3960</td> <td>SLE-Product-SLES15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4278</td> <td>SLE-Product-WE15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4276</td> <td>SLE-Product-WE15-SP2-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3962</td> <td>SLE15-SP2-Installer-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4923</td> <td>SUSE-CAASP-4.5-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4921</td> <td>SUSE-CAASP-4.5-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4028</td> <td>SUSE-PackageHub-15-SP2-Backports-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4032</td> <td>SUSE-PackageHub-15-SP2-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-hpecp/5.3-DL/Solution-Deployment/Manually-Install-And-Configure-HPECP.html" class="prev">
        Manually Install and configure HPE Ezmeral Container Platform 5.3
      </a></span> <span class="next"><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Lite-Touch-Installation.html">
        Lite Touch Installation (LTI)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-hpecp/5.3-DL/assets/js/app.0bf5fbdc.js" defer></script><script src="/hpe-solutions-hpecp/5.3-DL/assets/js/2.e4aa28f4.js" defer></script><script src="/hpe-solutions-hpecp/5.3-DL/assets/js/4.939e74e1.js" defer></script>
  </body>
</html>
