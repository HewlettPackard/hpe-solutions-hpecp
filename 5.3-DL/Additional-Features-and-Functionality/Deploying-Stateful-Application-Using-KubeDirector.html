<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying a 3-Tier Application using KubeDirector | HPE EZMERAL CONTAINER PLATFORM 5.3 AND HPE EZMERAL DATA FABRIC ON DL SERVERS</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-hpecp/5.3-DL/assets/css/0.styles.0080ec46.css" as="style"><link rel="preload" href="/hpe-solutions-hpecp/5.3-DL/assets/js/app.0bf5fbdc.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.3-DL/assets/js/2.e4aa28f4.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.3-DL/assets/js/7.6c3a0600.js" as="script"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/10.3e35ae29.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/11.7a78ade3.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/12.29c9290c.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/13.3abab25a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/14.f3739c20.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/15.7b65d052.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/16.aa61a115.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/17.e177a705.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/18.bf4d6486.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/19.821c324b.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/20.34cb7e9e.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/21.6efa84b0.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/22.e25ab30f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/23.10836832.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/24.70fbad91.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/25.79eb1c09.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/26.d079eae0.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/27.1500b9ac.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/28.2ccc6020.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/29.7254040f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/3.63bbce65.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/30.3252e07b.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/31.30b07ba7.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/32.6771f8e8.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/33.963c2f5f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/4.939e74e1.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/5.2592712f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/6.0eecfd8c.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/8.42d5a489.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.3-DL/assets/js/9.80d6a3b4.js">
    <link rel="stylesheet" href="/hpe-solutions-hpecp/5.3-DL/assets/css/0.styles.0080ec46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-hpecp/5.3-DL/" class="home-link router-link-active"><!----> <span class="site-name">HPE EZMERAL CONTAINER PLATFORM 5.3 AND HPE EZMERAL DATA FABRIC ON DL SERVERS</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.3-DL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.3-DL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HPE EZMERAL CONTAINER PLATFORM 5.3 on HPE DL Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Lite-Touch-Installation.html" class="sidebar-link">Lite Touch Installation (LTI)</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Deploying-HPE-CSI-Driver-For-Nimble.html" class="sidebar-link">Deploying HPE CSI Driver for Nimble Storage on HPECP Container Platform 5.3</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Creating-Data-Fabric-Cluster-On-HPECP.html" class="sidebar-link">Creating Data Fabric Cluster on HPE Ezmeral Container Platform 5.3</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Deploying-Stateful-Application-Using-KubeDirector.html" aria-current="page" class="active sidebar-link">Deploying a 3-Tier Application using KubeDirector</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Deploying-Stateful-Application-Using-KubeDirector.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Deploying-Stateful-Application-Using-KubeDirector.html#basic-application-architecture" class="sidebar-link">Basic Application Architecture</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Deploying-Stateful-Application-Using-KubeDirector.html#high-level-process-flow" class="sidebar-link">High Level Process Flow</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Deploying-Stateful-Application-Using-KubeDirector.html#steps-to-deploy-the-methodize-productivity-application" class="sidebar-link">Steps to Deploy the Methodize-Productivity Application</a></li></ul></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Role-Based-Access-Control.html" class="sidebar-link">HPE Ezmeral Container Platform - Role Based Access Control</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Physical-Worker-Node-Labeling.html" class="sidebar-link">Physical Worker Node Labeling in HPE Ezmeral Container Platform</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Istio-With-Kiali-Dashboard.html" class="sidebar-link">Istio with Kiali dashboard deployment on HPECP</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Kasten-Deployment-On-HPECP.html" class="sidebar-link">Kasten deployment on HPECP</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Kibana-Setup-On-HPECP.html" class="sidebar-link">Kibana Setup on HPECP</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Importing-Plain-K8s-Cluster.html" class="sidebar-link">Importing plain K8s cluster into HPECP cluster</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Deploying-Falco-On-HPECP-Cluster.html" class="sidebar-link">Deploying Falco on HPECP cluster</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Expand-And-Shrink-Cluster.html" class="sidebar-link">Expanding and Shrinking of a Compute Cluster</a></li><li><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/External-Load-Balancing-Using-NGINX.html" class="sidebar-link">External Load Balancing using NGINX</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deploying-a-3-tier-application-using-kubedirector"><a href="#deploying-a-3-tier-application-using-kubedirector" class="header-anchor">#</a> Deploying a 3-Tier Application using KubeDirector</h1> <div class="custom-block danger"><p class="custom-block-title">NOTE</p> <p>Setting up the <strong>HPE Ezmeral Data Fabric</strong> is required for deploying the 3-Tier Application using KubeDirector.</p></div> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Legacy application modernization enables organizations to create new business value from existing and aging applications. This is achieved by updating them with modern features and capabilities. Different strategies such as refactoring, re-architecting, rebuilding, and so on are adopted to modernize an application. Hewlett Packard Enterprise recommends starting with a “lift and shift” approach where the application is first containerized with as minimal changes as possible. After the application is containerized, it is easier and faster to upgrade to better infrastructure, refactor to microservices, and dynamically scale deployment. This approach enables regression testing of application before further modifications are done.</p> <p>In a &quot;lift and shift&quot; scenario, the same versions of OS, libraries or components and applications are retained. Containers provide the application with an environment very similar to the existing environment. This paves the way to commence modernizing the application deployment while making minimal or no changes to the application itself. In this section, Hewlett Packard Enterprise describes the best practices for modernizing applications by containerizing the legacy application and deploying it on the HPE Ezmeral Container Platform using KubeDirector. In a &quot;lift and shift&quot; scenario, the same versions of OS, libraries or components and applications are retained. Containers provide the application with an environment very similar to the existing environment. This paves the way to commence modernizing the application deployment while making minimal or no changes to the application itself. In this section, Hewlett Packard Enterprise describes the best practices for modernizing applications by containerizing the legacy application and deploying it on the HPE Ezmeral Container Platform using KubeDirector.</p> <p>The application used in this deployment is a 3-tier web-application called Methodize-Productivity. It is a MERN stack application (MongoDB, ExpressJS, ReactJS, NodeJS).
This is a simple application for organising your thoughts and creating simple tasks. It has an elegant UI along with basic authentication features and as an addon it has a simple weather api for displaying the weather.</p> <h2 id="basic-application-architecture"><a href="#basic-application-architecture" class="header-anchor">#</a> Basic Application Architecture</h2> <p>The legacy application is broken down into 3 tiers: frontend, backend and the database as shown in Figure 69.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-1.f8174640.png" alt=""></p> <p><strong>Figure</strong> <strong>68:</strong> Basic Architecture</p> <h2 id="high-level-process-flow"><a href="#high-level-process-flow" class="header-anchor">#</a> High Level Process Flow</h2> <p>The steps to deploy the Methodize-Productivity application can be broken down into 5 main phases as shown in Figure 69.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-2.acb2542a.png" alt=""></p> <p><strong>Figure</strong> <strong>69:</strong> High Level Process Flow to Deploy application</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>In this example we observe the following existing service connections and details:</p> <ul><li><p>The frontend is running at http://localhost:3000</p></li> <li><p>The backend is running at http://localhost:8081</p></li> <li><p>The database is running at http://localhost:27017</p></li> <li><p>The frontend establishes connection with the backend via the &quot;proxy&quot; key in the &quot;package.json&quot; file.</p></li> <li><p>The backend establishes connection with the database via the &quot;MONGO_URL&quot; key in the config/dev.js file.</p></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>In the following steps the communication establishment between pods is done manually without the use of any script.</p></div> <p>The end goal is to &quot;lift and shift&quot; the Methodize-Productivity application that is running on the Virtual Machine environment on to the containerized environment as shown below in Figure 70.</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-3.bef048b8.png" alt=""></p> <p><strong>Figure</strong> <strong>70:</strong> Lift and Shift of Methodize-Productivity Application</p> <h2 id="steps-to-deploy-the-methodize-productivity-application"><a href="#steps-to-deploy-the-methodize-productivity-application" class="header-anchor">#</a> Steps to Deploy the Methodize-Productivity Application</h2> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <ul><li>The following instructions are executed inside the web-terminal of the tenant.</li> <li>If the commands need to be run on the master/controller node, append &quot;-n &lt;tenant_name&gt;&quot; to all the commands so that it references the required tenant.</li> <li>Eg. kubectl create -f methodize-productivity.yaml -n kubedirector (where kubedirector is the name of the tenant)</li></ul></div> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <ul><li>Steps 1-6 explains the process to create the Dockerfiles for the application and the uploading of the images to DockerHub. These steps explain how the user can create images for their application.</li> <li>Since the images are available in DockerHub, the user can skip to Step 7 to start deploying the Methodize-Productivity Application using KubeDirector.</li></ul></div> <ol><li><p>Create a Project Folder &quot;Methodize-Productivity&quot; and create 3 sub-directories <strong>Frontend</strong> , <strong>Backend</strong> and <strong>Data</strong> inside it.</p></li> <li><p>Backup the existing data by creating a dump file.</p> <ul><li>Execute the command &quot;mongodump --db methodize&quot; (where methodize is the name of the database in use).</li> <li>This creates a dump folder at the directory the command was executed. It has a database folder &quot;methodize&quot; inside it.</li> <li>Copy the methodize folder into the <strong>Data</strong> folder of the &quot;Methodize-Productivity&quot; project.</li></ul></li> <li><p>Copy the server related files (models, handlers, middleware, package.json etc) into the <strong>Backend</strong> folder of the &quot;Methodize-Productivity&quot; project.</p></li> <li><p>Copy the user interface client files (components, actions, package.json etc) into the <strong>Frontend</strong> folder of the &quot;Methodize-Productivity&quot; project.</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The above steps set up the project file structure for easy creation of Dockerfiles.</p></div> <ol start="5"><li><p>Create Dockerfiles for the 3 tiers (Frontend, Backend and Database)</p> <ul><li><p>Create the Frontend Dockerfile inside the <strong>Frontend</strong> folder: Start from node:10 base image. Copy the package.json file and install all the required modules and dependencies and then copy the remaining project files into the working directory and expose port 3000. Use the command “npm start” to start the frontend User Interface:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>FROM node:10
WORKDIR /usr/src/app

RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">vim</span> -y <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">curl</span> -y

COPY package.json ./

RUN <span class="token function">npm</span> <span class="token function">install</span>

COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>

EXPOSE <span class="token number">3000</span>

CMD <span class="token punctuation">[</span><span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span><span class="token punctuation">]</span>
</code></pre></div></li> <li><p>Create the Backend Dockerfile inside the <strong>Backend</strong> folder: Copy the package.json file and install all the required modules and dependencies and then copy the remaining project files into the working directory and expose port 8081. Use the command “nodemon index” to start the backend server:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>FROM node:10
WORKDIR /usr/src/app

RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">vim</span> -y <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">curl</span> -y

COPY package.json ./

RUN <span class="token function">npm</span> <span class="token function">install</span>

RUN <span class="token function">npm</span> <span class="token function">install</span> -g nodemon

COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>

EXPOSE <span class="token number">8081</span>

CMD <span class="token punctuation">[</span><span class="token string">&quot;nodemon&quot;</span>, <span class="token string">&quot;index&quot;</span><span class="token punctuation">]</span>
</code></pre></div></li> <li><p>Create the Database Dockerfile inside the <strong>Data</strong> folder. Copy the data dump file into the image.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>FROM mongo:4.0

COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">curl</span> –y
</code></pre></div></li></ul></li> <li><p>Build the dockerfiles using the &quot;docker build&quot; command and tag them appropriately and push them into DockerHub for future access from the HPE Ezmeral Container Platform. For this example 3 images have been created and pushed as shown in Figure 71.</p> <ul><li>pranavvutkur/frontend-methodize</li> <li>pranavvutkur/backend-methodize</li> <li>pranavvutkur/data-methodize</li></ul></li></ol> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-4.82ce8053.png" alt=""></p> <p><strong>Figure</strong> <strong>71:</strong> Application images in DockerHub</p> <ol start="7"><li><p>Login to the HPE Ezmeral Container Platform and the required tenant. Create the KubeDirectorApp yaml file as shown.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> methodize-productivity.yaml
</code></pre></div><p>Fill in the following details:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubedirector.hpe.com/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> KubeDirectorApp
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> methodize<span class="token punctuation">-</span>productivity
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">label</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Methodize<span class="token punctuation">-</span>Productivity
    <span class="token key atrule">description</span><span class="token punctuation">:</span> A productivity task manager application using the MERN Stack
  <span class="token key atrule">distroID</span><span class="token punctuation">:</span> hpecp/methodize
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'1.1'</span>
  <span class="token key atrule">configSchemaVersion</span><span class="token punctuation">:</span> <span class="token number">7</span>
  <span class="token key atrule">defaultConfigPackage</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> frontend
    <span class="token key atrule">label</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> Frontend Service
    <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3000</span>
      <span class="token key atrule">urlScheme</span><span class="token punctuation">:</span> http
      <span class="token key atrule">isDashboard</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> backend
    <span class="token key atrule">label</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> Backend Service
    <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
      <span class="token key atrule">isDashboard</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> mongodb
    <span class="token key atrule">label</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> MongoDB Service
    <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
      <span class="token key atrule">isDashboard</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">roles</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> frontend
    <span class="token key atrule">cardinality</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
    <span class="token key atrule">imageRepoTag</span><span class="token punctuation">:</span> docker.io/pranavvutkur/frontend<span class="token punctuation">-</span>methodize<span class="token punctuation">:</span>latest
    <span class="token key atrule">persistDirs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;/usr/src/app&quot;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> backend
    <span class="token key atrule">cardinality</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
    <span class="token key atrule">imageRepoTag</span><span class="token punctuation">:</span> docker.io/pranavvutkur/backend<span class="token punctuation">-</span>methodize<span class="token punctuation">:</span>latest
    <span class="token key atrule">persistDirs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;/usr/src/app&quot;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> mongodb
    <span class="token key atrule">cardinality</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
    <span class="token key atrule">imageRepoTag</span><span class="token punctuation">:</span> docker.io/pranavvutkur/data<span class="token punctuation">-</span>methodize<span class="token punctuation">:</span>latest
    <span class="token key atrule">persistDirs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;/data/db&quot;</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">selectedRoles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> frontend
    <span class="token punctuation">-</span> backend
    <span class="token punctuation">-</span> mongodb
    <span class="token key atrule">roleServices</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">roleID</span><span class="token punctuation">:</span> frontend
      <span class="token key atrule">serviceIDs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> frontend
    <span class="token punctuation">-</span> <span class="token key atrule">roleID</span><span class="token punctuation">:</span> backend
      <span class="token key atrule">serviceIDs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> backend
    <span class="token punctuation">-</span> <span class="token key atrule">roleID</span><span class="token punctuation">:</span> mongodb
      <span class="token key atrule">serviceIDs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mongodb
  <span class="token key atrule">systemdRequired</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  
</code></pre></div></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>This file specifies the name of the application as Methodize-Productivity (spec.label.name). Three services are created. First service is for the frontend exposing port 3000 and second service is for the backend exposing port 8081 and finally the last service is for the mongodb database exposing port 27017.</p> <p>The three roles created are:</p> <ul><li>frontend role which specifies the image used (docker.io/pranavvutkur/frontend-methodize:latest) and the persistDirs directory (/usr/src/app).</li> <li>backend role specifies the image used (docker.io/pranavvutkur/backend-methodize:latest) and the persistDirs directory (/usr/src/app)</li> <li>mongodb role specifies the image used (docker.io/pranavvutkur/data-methodize:latest) and the persistDirs directory (/data/db)</li></ul></div> <ol start="8"><li><p>Execute the following command to create the KubeDirectorApp. This creates an application tile in the Applications window of the tenant in the HPE Ezmeral Container Platform GUI as shown in Figure 72.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl create -f methodize-productivity.yaml
</code></pre></div></li></ol> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-5.427a26e3.png" alt=""></p> <p><strong>Figure</strong> <strong>72:</strong> Methodize-Productivity in the Applications Window of the Tenant</p> <ol start="9"><li>Click on <strong>Launch</strong> for the created application. This opens up a KubeDirectorCluster file as shown in Figure 73. Assign custom values for the storage, CPU, memory, and the number of replicas as required and include the environment variables if any for each of the roles and click <strong>Submit</strong>.</li></ol> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-6.23a1b3c2.png" alt=""></p> <p><strong>Figure</strong> <strong>73:</strong> KubeDirectorCluster file of the application</p> <ol start="10"><li>A KubeDirector application instance gets created for the Methodize-Productivity application along with the service endpoints as shown in Figure 74 and Figure 75 respectively.</li></ol> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-7.ff2c9b4d.png" alt=""></p> <p><strong>Figure</strong> <strong>74:</strong> Methodize-Productivity Instance</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-8.194b4926.png" alt=""></p> <p><strong>Figure</strong> <strong>75:</strong> Service Endpoints for the application</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The services related to the application in use are highlighted in Figure 76.
The frontend access point is also highlighted which is required to access the frontend.</p></div> <ol start="11"><li>Identify the pods for the three tiers and modify the service connections within them and restore the database:
<ul><li><p>Exec into the database pod (kdss-4mdwm-0)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">exec</span> -it kdss-4mdwm-0 -- /bin/bash
</code></pre></div><p>and restore the dump file using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mongorestore --db methodize --drop methodize    <span class="token comment"># methodize is the name of the data dump file</span>
</code></pre></div></li> <li><p>Exec into the backend pod (kdss-vr4zq-0)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">exec</span> -it kdss-vr4zq-0 -- /bin/bash
</code></pre></div><p>and navigate into the “config” folder and open the “dev.js” file</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> dev.js   <span class="token comment"># file which has the URL to connect to the database</span>
</code></pre></div><p>Inside the file replace the “MONGO_URL” with the new service endpoint gateway mapping of the mongoDB pod.</p></li> <li><p>Exec into the frontend pod (kdss-l5fkn-0)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">exec</span> -it kdss-l5fkn-0 -- /bin/bash
</code></pre></div><p>and open the “package.json” file</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> package.json   <span class="token comment"># file which has the server(backend) URL</span>
</code></pre></div><p>Inside the file replace the “proxy” key with the service end point gateway mapping of the backend pod.</p></li></ul></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The pods can be identified from the Service-Endpoint tab which shows all the services:</p> <ul><li>The service names start with the prefix &quot;s-kdss&quot;</li> <li>The pods are the same name without the &quot;s-&quot; prefix</li> <li>Eg. the service &quot;s-kdss-4mdwm-0&quot; belongs to the mongodb service, and the corresponding pod name would then be &quot;kdss-4mdwm-0&quot;</li></ul></div> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The mongo restore command restores the data dump file that we copied into the mongo image during the dockerfile creation.</p> <p>The &quot;MONGO_URL&quot; value &quot;mongodb://127.0.0.1:27017/methodize&quot; is replaced with &quot;mongodb://pgateway.pranav.twentynet.local:10011/methodize&quot; in this example.</p> <p>The &quot;proxy&quot; value &quot;http://localhost:8081&quot; is replaced with &quot;http://pgateway.pranav.twentynet.local:10010&quot; in this example.</p></div> <ol start="12"><li><p>Delete the Frontend pod so the new pod will spin up with the modified proxy changes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl delete pod kdss-l5fkn-0
</code></pre></div></li> <li><p>Now the application has been setup. The service endpoint gateway mapping of the frontend is used to access the Methodize-Productivity user interface. Click the frontend access point as shown in Figure 76 to open the Methodize-Productivity home screen as shown in Figure 77.</p></li></ol> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-9.8cf9adce.png" alt=""></p> <p><strong>Figure</strong> <strong>76:</strong> Access Point for the frontend UI</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-10.81425951.png" alt=""></p> <p><strong>Figure</strong> <strong>77:</strong> Methodize-Productivity home screen</p> <ol start="14"><li>Click on “sign-in” and use the same credentials that were in use when the application was running on the virtual machine environment ( email: test@gmail.com, password: test123 ). Figure 78 shows the sign up page filled in with the existing user credentials.</li></ol> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-11.c74f74d3.png" alt=""></p> <p><strong>Figure</strong> <strong>78:</strong> Methodize-Productivity sign-in page with existing user credentials</p> <ol start="15"><li>Once the user has signed in they can view the To-Do task manager with all the existing created tasks as shown in Figure 79. The user can go ahead and create new tasks and users if required and continue using the application as before. (The application has now been containerised)</li></ol> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-12.0cf8955f.png" alt=""></p> <p><strong>Figure</strong> <strong>79:</strong> Methodize-Productivity To-Do task manager page with existing tasks</p> <ol start="16"><li>Execute the following commands to see the pods, its Persistent Volume (PV) and Persistent Volume Claim (PVC) that are created. Figure 80 represents the pods, Figure 81 represents the PV, and Figure 82 represents the PVC of the Methodize-Productivity application.</li></ol> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-13.a7e2eae6.png" alt=""></p> <p><strong>Figure</strong> <strong>80:</strong> Pods for the Methodize-Productivity</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-14.de0924e5.png" alt=""></p> <p><strong>Figure</strong> <strong>81:</strong>  Persistent volume for Methodize-Productivty</p> <p><img src="/hpe-solutions-hpecp/5.3-DL/assets/img/AF-KD-15.fd666680.png" alt=""></p> <p><strong>Figure</strong> <strong>82:</strong> Persistent Volume Claim for Methodize-Productivity</p> <div class="custom-block warning"><p class="custom-block-title">Note</p> <ul><li>The above steps work in general for MERN stack applications.</li> <li>Based on the application in use ,style of development and file structure , the steps can vary slightly, but the general idea and high level steps behind containerising the application remain the same.</li></ul></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Creating-Data-Fabric-Cluster-On-HPECP.html" class="prev">
        Creating Data Fabric Cluster on HPE Ezmeral Container Platform 5.3
      </a></span> <span class="next"><a href="/hpe-solutions-hpecp/5.3-DL/Additional-Features-and-Functionality/Role-Based-Access-Control.html">
        HPE Ezmeral Container Platform - Role Based Access Control
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-hpecp/5.3-DL/assets/js/app.0bf5fbdc.js" defer></script><script src="/hpe-solutions-hpecp/5.3-DL/assets/js/2.e4aa28f4.js" defer></script><script src="/hpe-solutions-hpecp/5.3-DL/assets/js/7.6c3a0600.js" defer></script>
  </body>
</html>
