(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{372:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-1.f8174640.png"},373:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-2.acb2542a.png"},374:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-3.bef048b8.png"},375:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-4.82ce8053.png"},376:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-5.427a26e3.png"},377:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-6.23a1b3c2.png"},378:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-7.ff2c9b4d.png"},379:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-8.194b4926.png"},380:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-11.c74f74d3.png"},381:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-12.0cf8955f.png"},382:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-13.a7e2eae6.png"},383:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-14.de0924e5.png"},384:function(t,e,a){t.exports=a.p+"assets/img/AF-KD-15.fd666680.png"},533:function(t,e,a){"use strict";a.r(e);var s=a(42),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"deploying-stateful-application-using-kubedirector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploying-stateful-application-using-kubedirector"}},[t._v("#")]),t._v(" Deploying stateful Application using KubeDirector")]),t._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("Setting up the "),s("strong",[t._v("HPE Ezmeral Data Fabric")]),t._v(" is required for deploying the 3-Tier Application using KubeDirector.")])]),t._v(" "),s("h2",{attrs:{id:"introduction"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),s("p",[t._v("Legacy application modernization enables organizations to create new business value from existing and aging applications. This is achieved by updating them with modern features and capabilities. Different strategies such as refactoring, re-architecting, rebuilding, and so on are adopted to modernize an application. Hewlett Packard Enterprise recommends starting with a “lift and shift” approach where the application is first containerized with as minimal changes as possible. After the application is containerized, it is easier and faster to upgrade to better infrastructure, refactor to microservices, and dynamically scale deployment. This approach enables regression testing of application before further modifications are done.")]),t._v(" "),s("p",[t._v('In a "lift and shift" scenario, the same versions of OS, libraries or components and applications are retained. Containers provide the application with an environment very similar to the existing environment. This paves the way to commence modernizing the application deployment while making minimal or no changes to the application itself. In this section, Hewlett Packard Enterprise describes the best practices for modernizing applications by containerizing the legacy application and deploying it on the HPE Ezmeral Container Platform using KubeDirector. In a "lift and shift" scenario, the same versions of OS, libraries or components and applications are retained. Containers provide the application with an environment very similar to the existing environment. This paves the way to commence modernizing the application deployment while making minimal or no changes to the application itself. In this section, Hewlett Packard Enterprise describes the best practices for modernizing applications by containerizing the legacy application and deploying it on the HPE Ezmeral Container Platform using KubeDirector.')]),t._v(" "),s("p",[t._v("The application used in this deployment is a 3-tier web-application called Methodize-Productivity. It is a MERN stack application (MongoDB, ExpressJS, ReactJS, NodeJS).\nThis is a simple application for organising your thoughts and creating simple tasks. It has an elegant UI along with basic authentication features and as an addon it has a simple weather api for displaying the weather.")]),t._v(" "),s("h2",{attrs:{id:"basic-application-architecture"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#basic-application-architecture"}},[t._v("#")]),t._v(" Basic Application Architecture")]),t._v(" "),s("p",[t._v("The legacy application is broken down into 3 tiers: frontend, backend and the database as shown in below figure.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(372),alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Figure 65.")]),t._v(" Legacy Application")]),t._v(" "),s("h2",{attrs:{id:"high-level-process-flow"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#high-level-process-flow"}},[t._v("#")]),t._v(" High Level Process Flow")]),t._v(" "),s("p",[t._v("The steps to deploy the Methodize-Productivity application can be broken down into 5 main phases as shown in below figure.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(373),alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Figure 66.")]),t._v(" High Level steps to deploy the Methodize-Productivity application")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("In this example we observe the following existing service connections and details:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("The frontend is running at http://localhost:3000")])]),t._v(" "),s("li",[s("p",[t._v("The backend is running at http://localhost:8081")])]),t._v(" "),s("li",[s("p",[t._v("The database is running at http://localhost:27017")])]),t._v(" "),s("li",[s("p",[t._v('The frontend establishes connection with the backend via the "proxy" key in the "package.json" file.')])]),t._v(" "),s("li",[s("p",[t._v('The backend establishes connection with the database via the "MONGO_URL" key in the config/dev.js file.')])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("In the following steps the communication establishment between pods is done manually without the use of any script.")])]),t._v(" "),s("p",[t._v('The end goal is to "lift and shift" the Methodize-Productivity application that is running on the Virtual Machine environment on to the containerized environment as shown below in below figure.')]),t._v(" "),s("p",[s("img",{attrs:{src:a(374),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"steps-to-deploy-the-methodize-productivity-application"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#steps-to-deploy-the-methodize-productivity-application"}},[t._v("#")]),t._v(" Steps to Deploy the Methodize-Productivity Application")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("ul",[s("li",[t._v("The following instructions are executed inside the web-terminal of the tenant.")]),t._v(" "),s("li",[t._v('If the commands need to be run on the master/controller node, append "-n <tenant_name>" to all the commands so that it references the required tenant.')]),t._v(" "),s("li",[t._v("Eg. kubectl create -f methodize-productivity.yaml -n kubedirector (where kubedirector is the name of the tenant)")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("ul",[s("li",[t._v("Steps 1-6 explains the process to create the Dockerfiles for the application and the uploading of the images to DockerHub. These steps explain how the user can create images for their application.")]),t._v(" "),s("li",[t._v("Since the images are available in DockerHub, the user can skip to Step 7 to start deploying the Methodize-Productivity Application using KubeDirector.")])])]),t._v(" "),s("ol",[s("li",[s("p",[t._v('Create a Project Folder "Methodize-Productivity" and create 3 sub-directories '),s("strong",[t._v("Frontend")]),t._v(" , "),s("strong",[t._v("Backend")]),t._v(" and "),s("strong",[t._v("Data")]),t._v(" inside it.")])]),t._v(" "),s("li",[s("p",[t._v("Backup the existing data by creating a dump file.")]),t._v(" "),s("ul",[s("li",[t._v('Execute the command "mongodump --db methodize" (where methodize is the name of the database in use).')]),t._v(" "),s("li",[t._v('This creates a dump folder at the directory the command was executed. It has a database folder "methodize" inside it.')]),t._v(" "),s("li",[t._v("Copy the methodize folder into the "),s("strong",[t._v("Data")]),t._v(' folder of the "Methodize-Productivity" project.')])])]),t._v(" "),s("li",[s("p",[t._v("Copy the server related files (models, handlers, middleware, package.json etc) into the "),s("strong",[t._v("Backend")]),t._v(' folder of the "Methodize-Productivity" project.')])]),t._v(" "),s("li",[s("p",[t._v("Copy the user interface client files (components, actions, package.json etc) into the "),s("strong",[t._v("Frontend")]),t._v(' folder of the "Methodize-Productivity" project.')])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("The above steps set up the project file structure for easy creation of Dockerfiles.")])]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[s("p",[t._v("Create Dockerfiles for the 3 tiers (Frontend, Backend and Database)")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Create the Frontend Dockerfile inside the "),s("strong",[t._v("Frontend")]),t._v(" folder: Start from node:10 base image. Copy the package.json file and install all the required modules and dependencies and then copy the remaining project files into the working directory and expose port 3000. Use the command “npm start” to start the frontend User Interface:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("FROM node:10\nWORKDIR /usr/src/app\n\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" -y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -y\n\nCOPY package.json ./\n\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Create the Backend Dockerfile inside the "),s("strong",[t._v("Backend")]),t._v(" folder: Copy the package.json file and install all the required modules and dependencies and then copy the remaining project files into the working directory and expose port 8081. Use the command “nodemon index” to start the backend server:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("FROM node:10\nWORKDIR /usr/src/app\n\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" -y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -y\n\nCOPY package.json ./\n\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -g nodemon\n\nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("\n\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nodemon"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Create the Database Dockerfile inside the "),s("strong",[t._v("Data")]),t._v(" folder. Copy the data dump file into the image.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("FROM mongo:4.0\n\nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" –y\n")])])])])])]),t._v(" "),s("li",[s("p",[t._v('Build the dockerfiles using the "docker build" command and tag them appropriately and push them into DockerHub for future access from the HPE Ezmeral Container Platform. For this example 3 images have been created and pushed as shown in below figure.')]),t._v(" "),s("ul",[s("li",[t._v("pranavvutkur/frontend-methodize")]),t._v(" "),s("li",[t._v("pranavvutkur/backend-methodize")]),t._v(" "),s("li",[t._v("pranavvutkur/data-methodize")])])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(375),alt:""}})]),t._v(" "),s("ol",{attrs:{start:"7"}},[s("li",[s("p",[t._v("Login to the HPE Ezmeral Container Platform and the required tenant. Create the KubeDirectorApp yaml file as shown.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" methodize-productivity.yaml\n")])])]),s("p",[t._v("Fill in the following details:")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubedirector.hpe.com/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" KubeDirectorApp\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" methodize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("productivity\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("label")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Methodize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Productivity\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" A productivity task manager application using the MERN Stack\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("distroID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hpecp/methodize\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.1'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configSchemaVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultConfigPackage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" frontend\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("label")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Frontend Service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("urlScheme")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("isDashboard")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("label")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Backend Service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("isDashboard")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mongodb\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("label")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MongoDB Service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27017")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("isDashboard")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" frontend\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cardinality")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepoTag")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.io/pranavvutkur/frontend"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("methodize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistDirs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/src/app"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cardinality")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepoTag")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.io/pranavvutkur/backend"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("methodize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistDirs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/src/app"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mongodb\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cardinality")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepoTag")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.io/pranavvutkur/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("methodize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistDirs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/db"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selectedRoles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" frontend\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" backend\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mongodb\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleServices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" frontend\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceIDs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" frontend\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceIDs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" backend\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mongodb\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceIDs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mongodb\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("systemdRequired")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n")])])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("This file specifies the name of the application as Methodize-Productivity (spec.label.name). Three services are created. First service is for the frontend exposing port 3000 and second service is for the backend exposing port 8081 and finally the last service is for the mongodb database exposing port 27017.")]),t._v(" "),s("p",[t._v("The three roles created are:")]),t._v(" "),s("ul",[s("li",[t._v("frontend role which specifies the image used (docker.io/pranavvutkur/frontend-methodize:latest) and the persistDirs directory (/usr/src/app).")]),t._v(" "),s("li",[t._v("backend role specifies the image used (docker.io/pranavvutkur/backend-methodize:latest) and the persistDirs directory (/usr/src/app)")]),t._v(" "),s("li",[t._v("mongodb role specifies the image used (docker.io/pranavvutkur/data-methodize:latest) and the persistDirs directory (/data/db)")])])]),t._v(" "),s("ol",{attrs:{start:"8"}},[s("li",[s("p",[t._v("Execute the following command to create the KubeDirectorApp.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create -f methodize-productivity.yaml\n")])])]),s("p",[t._v("This creates an application tile in the Applications window of the tenant in the HPE Ezmeral Container Platform GUI as shown in below figure.")])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(376),alt:""}})]),t._v(" "),s("ol",{attrs:{start:"9"}},[s("li",[t._v("Click on "),s("strong",[t._v("Launch")]),t._v(" for the created application. This opens up a KubeDirectorCluster file as shown in below figure. Assign custom values for the storage, CPU, memory, and the number of replicas as required and include the environment variables if any for each of the roles and click "),s("strong",[t._v("Submit")]),t._v(".")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(377),alt:""}})]),t._v(" "),s("ol",{attrs:{start:"10"}},[s("li",[t._v("A KubeDirector application instance gets created for the Methodize-Productivity application along with the service endpoints as shown in below figure.")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(378),alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(379),alt:""}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("The frontend access point is also highlighted which is required to access the frontend.")])]),t._v(" "),s("ol",{attrs:{start:"11"}},[s("li",[t._v("Identify the pods for the three tiers and modify the service connections within them and restore the database:\n"),s("ul",[s("li",[s("p",[t._v("Exec into the database pod (kdss-4mdwm-0)")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it kdss-4mdwm-0 -- /bin/bash\n")])])]),s("p",[t._v("and restore the dump file using the following command.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("mongorestore --db methodize --drop methodize    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# methodize is the name of the data dump file")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Exec into the backend pod (kdss-vr4zq-0)")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it kdss-vr4zq-0 -- /bin/bash\n")])])]),s("p",[t._v("and navigate into the “config” folder and open the “dev.js” file")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" dev.js   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# file which has the URL to connect to the database")]),t._v("\n")])])]),s("p",[t._v("Inside the file replace the “MONGO_URL” with the new service endpoint gateway mapping of the mongoDB pod.")])]),t._v(" "),s("li",[s("p",[t._v("Exec into the frontend pod (kdss-l5fkn-0)")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it kdss-l5fkn-0 -- /bin/bash\n")])])]),s("p",[t._v("and open the “package.json” file")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" package.json   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# file which has the server(backend) URL")]),t._v("\n")])])]),s("p",[t._v("Inside the file replace the “proxy” key with the service end point gateway mapping of the backend pod.")])])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("The pods can be identified from the Service-Endpoint tab which shows all the services:")]),t._v(" "),s("ul",[s("li",[t._v('The service names start with the prefix "s-kdss"')]),t._v(" "),s("li",[t._v('The pods are the same name without the "s-" prefix')]),t._v(" "),s("li",[t._v('Eg. the service "s-kdss-4mdwm-0" belongs to the mongodb service, and the corresponding pod name would then be "kdss-4mdwm-0"')])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),s("p",[t._v("The mongo restore command restores the data dump file that we copied into the mongo image during the dockerfile creation.")]),t._v(" "),s("p",[t._v('The "MONGO_URL" value "mongodb://127.0.0.1:27017/methodize" is replaced with "mongodb://pgateway.pranav.twentynet.local:10011/methodize" in this example.')]),t._v(" "),s("p",[t._v('The "proxy" value "http://localhost:8081" is replaced with "http://pgateway.pranav.twentynet.local:10010" in this example.')])]),t._v(" "),s("ol",{attrs:{start:"12"}},[s("li",[s("p",[t._v("Delete the Frontend pod so the new pod will spin up with the modified proxy changes.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl delete pod kdss-l5fkn-0\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Now the application has been setup. The service endpoint gateway mapping of the frontend is used to access the Methodize-Productivity user interface. Click the frontend access point to open the Methodize-Productivity home screen.")])]),t._v(" "),s("li",[s("p",[t._v("Click on “sign-in” and use the same credentials that were in use when the application was running on the virtual machine environment ( email: test@gmail.com, password: test123 ). Below figure shows the sign up page filled in with the existing user credentials.")])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(380),alt:""}})]),t._v(" "),s("ol",{attrs:{start:"15"}},[s("li",[t._v("Once the user has signed in they can view the To-Do task manager with all the existing created tasks as shown in below figure. The user can go ahead and create new tasks and users if required and continue using the application as before. (The application has now been containerised)")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(381),alt:""}})]),t._v(" "),s("ol",{attrs:{start:"16"}},[s("li",[t._v("Execute the following commands to see the pods, its Persistent Volume (PV) and Persistent Volume Claim (PVC) that are created. Figure 67 represents the pods, Figure 68 represents the PV, and Figure 69 represents the PVC of the Methodize-Productivity application.")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(382),alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Figure")]),t._v(" "),s("strong",[t._v("67.")]),t._v(" Pods for the Methodize-Productivity")]),t._v(" "),s("p",[s("img",{attrs:{src:a(383),alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Figure")]),t._v(" "),s("strong",[t._v("68.")]),t._v("  Persistent volume for Methodize-Productivty")]),t._v(" "),s("p",[s("img",{attrs:{src:a(384),alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Figure")]),t._v(" "),s("strong",[t._v("69.")]),t._v(" Persistent Volume Claim for Methodize-Productivity")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("ul",[s("li",[t._v("The above steps work in general for MERN stack applications.")]),t._v(" "),s("li",[t._v("Based on the application in use ,style of development and file structure , the steps can vary slightly, but the general idea and high level steps behind containerising the application remain the same.")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);