<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Istio with Kiali dashboard deployment on HPERE | HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL USING REST API BASED DEPLOYMENT</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-hpecp/5.6/assets/css/0.styles.279e6b91.css" as="style"><link rel="preload" href="/hpe-solutions-hpecp/5.6/assets/js/app.5eb3f62d.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.6/assets/js/2.fca4e8e3.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.6/assets/js/6.7d9e5104.js" as="script"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/10.f72b1bc4.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/11.e7a729e8.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/12.8d8de7ec.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/13.1fa676d3.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/14.b727f089.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/15.68fff555.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/16.8e3946ff.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/17.1a766592.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/18.25785d36.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/19.a51d4ada.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/20.4bdc3691.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/21.b46c2990.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/22.aa02a81f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/23.380c9844.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/24.8e3f5155.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/25.cc3c1d5b.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/26.660ea81c.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/27.25440428.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/28.36e5fac4.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/29.07727917.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/3.5da8aeaf.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/4.23bc7f74.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/5.d1a782d6.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/7.ae9e8e36.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/8.031d06a3.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6/assets/js/9.09279ca2.js">
    <link rel="stylesheet" href="/hpe-solutions-hpecp/5.6/assets/css/0.styles.279e6b91.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-hpecp/5.6/" class="home-link router-link-active"><!----> <span class="site-name">HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL USING REST API BASED DEPLOYMENT</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.6/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.6/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL USING REST API BASED DEPLOYMENT</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Lite-Touch-Installation.html" class="sidebar-link">Lite Touch Installation (LTI)</a></li><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Create-Datafabric-Cluster-ERE.html" class="sidebar-link">Integrating External Ezmeral DataFabric with Ezmeral Runtime Enterprise 5.6.0</a></li><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Deploy-Stateful-application-Kubedirector.html" class="sidebar-link">Deploying stateful application using KubeDirector</a></li><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Role-Based-Access-Control.html" class="sidebar-link">HPE Ezmeral Runtime Enterprise – Role Based Access Control</a></li><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Physical-Worker-Node-labelling-ERE.html" class="sidebar-link">Physical Worker Node Labeling in HPE Ezmeral Runtime Enterprise</a></li><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Istio-Kiali-ERE.html" aria-current="page" class="active sidebar-link">Istio with Kiali dashboard deployment on HPERE</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="sidebar-link">Install and Configure Velero</a></li><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Expand-and-Shrink-Cluster.html" class="sidebar-link">Expand and Shrink Cluster</a></li><li><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/External-Load-Balancing-using-NGINX.html" class="sidebar-link">External Load Balancing using NGINX</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="istio-with-kiali-dashboard-deployment-on-hpere"><a href="#istio-with-kiali-dashboard-deployment-on-hpere" class="header-anchor">#</a> Istio with Kiali dashboard deployment on HPERE</h1> <h3 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h3> <p>Istio is a service mesh technology that helps in service-to-service communications. It provides an easy way to create a network of deployed services with load balancing, service-to-service authentication, monitoring and many more without requiring any changes in service code. Istio deploys a special sidecar proxy that intercepts all network communication between microservices, using Istio’s control plane functionality. Kiali works with Istio to visualize the service mesh topology. Kiali is a management console for Istio, and as such, Istio is a requirement. It provides and controls the service mesh</p> <div class="custom-block tip"><p class="custom-block-title">Pre-requisites</p> <ul><li>Access to HPERE WEBGUI</li></ul></div> <h3 id="flow-diagram"><a href="#flow-diagram" class="header-anchor">#</a> Flow Diagram</h3> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure100.5f99fc9c.png" alt=""></p> <p>Figure 100: Istio cluster creation flow diagarm</p> <h3 id="deployment-process"><a href="#deployment-process" class="header-anchor">#</a> Deployment Process</h3> <h4 id="create-hpere-istio-cluster"><a href="#create-hpere-istio-cluster" class="header-anchor">#</a> Create HPERE ISTIO cluster</h4> <p>Add kubernetes hosts by following below steps.</p> <ul><li><p>Login into HPERE platform by providing required username and password.</p></li> <li><p>Click on Kubernetes tab in the left panel and navigate to the Kubernetes Hosts Installation page.</p></li> <li><p>Add hosts by providing IP address, credentials and set istio-ingressgateway tag to true.</p></li></ul> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure101.27b7e871.png" alt=""></p> <p>::: NOTE
Refer to <a href="/hpe-solutions-hpecp/5.6/Solution-Deployment/Manual-ERE-Deployment.html#add-kubernetes-hosts">Add Kubernet Hosts</a> section to get more details on adding kubernetes hosts.
:::</p> <ul><li>Node status will become “Ready” once node installed successfully. Make sure that tag is set to istio-ingressgateway as shown in below snapshot.</li></ul> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure102.82cd4b55.png" alt=""></p> <h4 id="create-the-hpere-istio-cluster"><a href="#create-the-hpere-istio-cluster" class="header-anchor">#</a> Create the HPERE ISTIO cluster</h4> <p>Follow below steps to create ISTIO cluster.</p> <ul><li><p>Navigate to Cluster creation page under Kubernetes menu and click on Create Kubernetes Cluster.</p></li> <li><p>For host configuration, select the required master and worker nodes and click on Next.</p></li> <li><p>Cross verify cluster configuration details and Click on Next.</p></li> <li><p>Provide authentication details if required.</p></li> <li><p>Select Istio application under <strong>Application Configuration</strong>. And click on Next.</p></li></ul> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure103.e618674a.png" alt=""></p> <ul><li>Next page shows up the summary and click on submit create the cluster. Cluster status shows “ready” once the cluster created successfully.</li></ul> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Refer to <a href="/hpe-solutions-hpecp/5.6/Solution-Deployment/Manual-ERE-Deployment.html#create-a-kubernetes-cluster">Cluster Creation</a> section to get more information on cluster creation process.</p></div> <ul><li><p>Once the tenant is created, Necessary Istio ingress gateway and Kiali application access points will be created. Follow below steps to create tenant.</p></li> <li><p>Select tenant option under Kubernetes menu and click on create tenant.</p></li> <li><p>As show in the below snapshot, select Istio cluster in “K8s Cluster” drop down menu and check the option “Enable Istio Service Mesh”.</p></li></ul> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure104.e0447006.png" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Refer to Tenant creation section to get more information.</p></div> <ul><li>Once the tenant is created, click on the tenant and go to the application menu. We can notice ingress gateway address and Kiali dashboard under “Service Endpoints” as shown in the blow snapshot.</li></ul> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure105.b6354e77.png" alt=""></p> <h4 id="access-the-kubernetes-cluster"><a href="#access-the-kubernetes-cluster" class="header-anchor">#</a> Access the Kubernetes Cluster</h4> <ol><li>Navigate to Dashboard, download kubeconfig and upload to the installer machine. Export the downloaded config file to KUBECONFIG to access the cluster.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span><span class="token operator">&lt;</span>kubeconfig_file_path<span class="token operator">&gt;</span>
</code></pre></div><ol start="2"><li>Get node details by running below command.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get nodes
</code></pre></div><ol start="3"><li>Get namespace details by running below command.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubect get ns
</code></pre></div><p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure106.3c7f7293.png" alt=""></p> <h4 id="deploy-application"><a href="#deploy-application" class="header-anchor">#</a> Deploy Application</h4> <ol><li>Application will be deployed under Istio tenant namespace. Execute below command to deploy application. Here we are using sample application provided by Istio</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/istio/istio/release-1.8/samples/bookinfo/platform/kube/bookinfo.yaml
</code></pre></div><p>Output of the above command looks like below.
<img src="/hpe-solutions-hpecp/5.6/assets/img/figure107.66810525.png" alt=""></p> <ol start="2"><li><p>Verify if Pods and Services are running.
<img src="/hpe-solutions-hpecp/5.6/assets/img/figure108.0ea24d92.png" alt=""></p></li> <li><p>Verify the application status by running below command.</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> Kubectl <span class="token builtin class-name">exec</span> “<span class="token variable"><span class="token variable">$(</span>kubectl get pod <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>ratings <span class="token parameter variable">-o</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span>’<span class="token punctuation">{</span>.items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.metadata.name<span class="token punctuation">}</span>’<span class="token variable">)</span></span>” <span class="token parameter variable">-c</span> ratings – <span class="token function">curl</span> productpage:9080/productpage
</code></pre></div><ol start="4"><li>Deploy ingress gateway for application.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> Kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/istio/istio/release-1.8/samples/bookinfo/networking/bookinfo-gateway.yaml
</code></pre></div><ol start="5"><li>Verify gateway status by running below command.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get gateway
</code></pre></div><p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure109.d54de4c1.png" alt=""></p> <ol start="6"><li>Edit the gateway and provide a custom domain.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> Kubectl edit gateway bookinfo-gateway
</code></pre></div><ol start="7"><li><p>Modify the hosts section under spec with domain (Ex: mybook.example.com) as shown in screenshot.
<img src="/hpe-solutions-hpecp/5.6/assets/img/figure110.21f89dde.png" alt=""></p></li> <li><p>Note Istio ingress hostname and port under <strong>Service Endpoints</strong> in Kubernetes Application.
<img src="/hpe-solutions-hpecp/5.6/assets/img/figure111.9156aab4.png" alt=""></p></li> <li><p>Update hosts file as below so that when accessing application domain, domain points to ingress IP address
<img src="/hpe-solutions-hpecp/5.6/assets/img/figure112.e5f5d219.png" alt=""></p></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>In above example agw1.ajay.tennet.local resolves to 10.0.72.180</p></div> <ol start="10"><li>Access the application via browser using custom domain and ingress port as below. Different versions of website will be loaded each time when website is accessed.
<img src="/hpe-solutions-hpecp/5.6/assets/img/figure113.72976c24.png" alt=""></li></ol> <p><strong>Access Kiali</strong></p> <ol><li>Open HPERE WEBUI and under Istio tenant access the Kiali URL under application/service Endpoints</li></ol> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure114.c86e194b.png" alt=""></p> <ol start="2"><li><p>A popup window will be appearing with token key and to proceed to Kiali. Copy the token and when asked at login, provide this token</p></li> <li><p>Once Kiali dashboard is loaded, go to service section and click “review” service of the website.</p></li></ol> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure115.6b88dfa9.png" alt=""></p> <ol start="4"><li>Notice that service has 3 versions of microservices as shown in below graph. We can restrict the flow of traffic by using option “Update Weighted Routing” under Actions.</li></ol> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure116.be8bc14b.png" alt=""></p> <ol start="5"><li>Below is snippet of traffic allowed only to version 2 of “reviews” microservice application.</li></ol> <p><img src="/hpe-solutions-hpecp/5.6/assets/img/figure117.7f3777b4.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Physical-Worker-Node-labelling-ERE.html" class="prev">
        Physical Worker Node Labeling in HPE Ezmeral Runtime Enterprise
      </a></span> <span class="next"><a href="/hpe-solutions-hpecp/5.6/Additional-Features-and-Functionality/Install-and-Configure-Velero.html">
        Install and Configure Velero
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-hpecp/5.6/assets/js/app.5eb3f62d.js" defer></script><script src="/hpe-solutions-hpecp/5.6/assets/js/2.fca4e8e3.js" defer></script><script src="/hpe-solutions-hpecp/5.6/assets/js/6.7d9e5104.js" defer></script>
  </body>
</html>
