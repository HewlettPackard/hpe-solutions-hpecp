<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying stateful application using KubeDirector | HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL USING REST API BASED DEPLOYMENT</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-hpecp/5.6-DL/assets/css/0.styles.60daef37.css" as="style"><link rel="preload" href="/hpe-solutions-hpecp/5.6-DL/assets/js/app.a7ecef63.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.6-DL/assets/js/2.bd3d0753.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.6-DL/assets/js/9.54d536e7.js" as="script"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/10.f5af8278.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/11.9e67a3a6.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/12.d90a58c9.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/13.671b06ff.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/14.13cbbc87.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/15.9add186a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/16.88e6919a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/17.7131a539.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/18.b5f49501.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/19.10e61652.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/20.06e263b9.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/21.ecf127b6.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/22.d5e1e229.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/23.5465d20e.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/24.5a1a164a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/25.fcea4234.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/26.2e649161.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/27.8089427d.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/28.ea3faeaa.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/29.d575667a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/3.0385adeb.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/4.182f8814.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/5.6f43dfef.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/6.95f654bb.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/7.6b6fac5d.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/8.c1dac8a4.js">
    <link rel="stylesheet" href="/hpe-solutions-hpecp/5.6-DL/assets/css/0.styles.60daef37.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-hpecp/5.6-DL/" class="home-link router-link-active"><!----> <span class="site-name">HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL USING REST API BASED DEPLOYMENT</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.6-DL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.6-DL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL USING REST API BASED DEPLOYMENT</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Lite-Touch-Installation.html" class="sidebar-link">Lite Touch Installation (LTI)</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Create-Datafabric-Cluster-ERE.html" class="sidebar-link">Integrating External Ezmeral DataFabric with Ezmeral Runtime Enterprise 5.6.0</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Deploy-Stateful-application-Kubedirector.html" aria-current="page" class="active sidebar-link">Deploying stateful application using KubeDirector</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Role-Based-Access-Control.html" class="sidebar-link">HPE Ezmeral Runtime Enterprise – Role Based Access Control</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Physical-Worker-Node-labelling-ERE.html" class="sidebar-link">Physical Worker Node Labeling in HPE Ezmeral Runtime Enterprise</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Istio-Kiali-ERE.html" class="sidebar-link">Istio with Kiali dashboard deployment on HPERE</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="sidebar-link">Install and Configure Velero</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Expand-and-Shrink-Cluster.html" class="sidebar-link">Expand and Shrink Cluster</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/External-Load-Balancing-using-NGINX.html" class="sidebar-link">External Load Balancing using NGINX</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resources and additional links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deploying-stateful-application-using-kubedirector"><a href="#deploying-stateful-application-using-kubedirector" class="header-anchor">#</a> Deploying stateful application using KubeDirector</h1> <p>The steps to deploy the Methodize-Productivity application using KubeDirector are as follows:</p> <ol><li>Create Dockerfiles for the three tiers.</li></ol> <ul><li>Create the frontend dockerfile. Copy the package.json file and install all the required modules and dependencies and then copy the remaining project files into the working directory and expose port 3000. Use the command “npm start” to start the frontend User Interface:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>FROM node:10
WORKDIR /usr/src/app
RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">vim</span> <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">curl</span> <span class="token parameter variable">-y</span>
COPY package.json ./
RUN <span class="token function">npm</span> <span class="token function">install</span>
COPY <span class="token punctuation">..</span>
EXPOSE <span class="token number">3000</span>
CMD <span class="token punctuation">[</span>“npm”, “start”<span class="token punctuation">]</span>
</code></pre></div><ul><li>Create the backend dockerfile. Copy the package.json file and install all the required modules and dependencies and then copy the remaining project files into the working directory and expose port 8081. Use the command “nodemon index” to start the backend server:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>FROM node:10
WORKDIR /usr/src/app
RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">vim</span> <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">curl</span> <span class="token parameter variable">-y</span>
COPY package.json ./
RUN <span class="token function">npm</span> <span class="token function">install</span>
RUN <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> nodemon
COPY <span class="token punctuation">..</span>
EXPOSE <span class="token number">8081</span>
CMD <span class="token punctuation">[</span>“nodemon”, “index”<span class="token punctuation">]</span>
</code></pre></div><ul><li>Create a dump of the database and then create the database dockerfile and copy the data dump file into it:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>FROM mongo:4.0
COPY <span class="token punctuation">..</span>
RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">curl</span> –y
</code></pre></div><ol start="2"><li><p>Create the images and push them into DockerHub for future access from the HPE Ezmeral Runtime Enterprise.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure69.08a51866.png" alt=""></p> <p><strong>Figure 68.</strong> HPE Ezmeral Runtime Enterprise DockerHub for future access</p></li> <li><p>Login to the HPE Ezmeral Runtime Enterprise and the required tenant. Create the KubeDirectorApp yaml file as shown.</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">vi</span> methodize-productivity.yaml
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>apiVersion: kubedirector.hpe.com/v1beta1
kind: KubeDirectorApp
metadata:
  name: methodize-productivity
spec:
  label:
    name: Methodize-Productivity
    description: A productivity task manager application using the MERN Stack
  distroID: hpecp/methodize
  version: ‘1.1’
  configSchemaVersion: <span class="token number">7</span>
  defaultConfigPackage: null
  services:
  - id: frontend
    label:
      name: Frontend Service
    endpoint:
      port: <span class="token number">3000</span>
      urlScheme: http
      isDashboard: <span class="token boolean">true</span>
  - id: backend
    label:
      name: Backend Service
    endpoint:
      port: <span class="token number">8081</span>
      isDashboard: <span class="token boolean">false</span>
  - id: mongodb
    label:
      name: MongoDB Service
    endpoint:
      port: <span class="token number">27017</span>
      isDashboard: <span class="token boolean">false</span>
  roles:
  - id: frontend
    cardinality: ‘1’
    imageRepoTag: docker.io/pranavvutkur/frontend-methodize:latest
    persistDirs:
    - “/usr/src/app”
  - id: backend
    cardinality: ‘1’
    imageRepoTag: docker.io/pranavvutkur/backend-methodize:latest
    persistDirs:
    - “/usr/src/app”
  - id: mongodb
    cardinality: ‘1’
    imageRepoTag: docker.io/pranavvutkur/data-methodize:latest
    persistDirs:
    - “/data/db”
  config:
    selectedRoles:
    - frontend
    - backend
    - mongodb
    roleServices:
    - roleID: frontend
    serviceIDs:
    - frontend
    - roleID: backend
    serviceIDs:
    - backend
    - roleID: mongodb
    serviceIDs:
    - mongodb
  systemdRequired: <span class="token boolean">true</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Note</p> <p>This file specifies the name of the application as Methodize-Productivity (spec.label.name). Three services are created. First service is for the frontend exposing port 3000 and second service is for the backend exposing port 8081 and finally the last service is for the mongodb database exposing port 27017.</p> <p>The three roles created are:
a. frontend role which specifies the image used (docker.io/pranavvutkur/frontend-methodize:latest) and the persistDirs directory (/usr/src/app).</p> <p>b. backend role specifies the image used (docker.io/pranavvutkur/backend-methodize:latest) and the persistDirs directory (/usr/src/app)</p> <p>c. mongodb role specifies the image used (docker.io/pranavvutkur/data-methodize:latest) and the persistDirs directory (/data/db)</p></div> <ol start="4"><li>Execute the following command to create the KubeDirectorApp.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl create–f methodize-productivity.yaml
</code></pre></div><ol start="5"><li><p>Next step is to launch the created application from the HPE Ezmeral Runtime Enterprise GUI and assign custom values for the storage, CPU, memory, and the number of replicas as required and include the environment variables if required and Click Submit to represent the KubeDirector cluster data.</p></li> <li><p>A KubeDirector application instance gets created for the Methodize-Productivity application with service endpoints.</p></li> <li><p>Identify the pods for the three tiers:</p> <ul><li>Exec into the database pod</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>db pod<span class="token operator">&gt;</span> -- /bin/bash
</code></pre></div><p>and restore the dump file using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> mongorestore –db methodize –drop methodize <span class="token punctuation">(</span>methodize is the name of the data dump <span class="token function">file</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>Exec into the backend pod</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>backend pod<span class="token operator">&gt;</span> -- /bin/bash
</code></pre></div><p>and navigate into the “config” folder and open the “dev.js” file</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">vi</span> dev.js
Inside the <span class="token function">file</span> replace the “MONGO_URL” with the new <span class="token function">service</span> endpoint gateway mapping of the mongoDB pod.
</code></pre></div><ul><li>Exec into the frontend pod and open the “package.json” file</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">vi</span> package.json
Inside the <span class="token function">file</span> replace the “proxy” key with the <span class="token function">service</span> end point gateway mapping of the backend pod.
</code></pre></div></li> <li><p>Delete the Frontend pod so the new pod will spin up with the modified proxy changes.</p></li> <li><p>On the HPE Ezmeral Runtime Enterprise UI the service endpoint gateway mapping is used to access the Methodize-Productivity UI.Click Gateway Mappings as shown in Figure 69 to open the Methodize-Productivity home screen as shown in Figure 70.</p></li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure69.08a51866.png" alt=""></p> <p><strong>Figure 69.</strong> Service Endpoint of the Methodize-Productivity Frontend.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure70.cd7bf632.png" alt=""></p> <p><strong>Figure 70.</strong> Service Endpoint of the Methodize-Productivity URL.</p> <ol start="10"><li>Click on “sign-in” and use the same credentials that were in use when the application was running on the virtual machine environment. Figure 71 shows the sign-up page filled in with the existing user credentials.</li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure71.75b83dd2.png" alt=""></p> <p><strong>Figure 71.</strong> Methodize-Productivity sign-in page with existing user credentials.</p> <ol start="11"><li>Once the user has signed in they can view the To-Do task manager with all the existing created tasks as shown in Figure 72. The user can go ahead and create new tasks if required.</li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure72.76ed0c0c.png" alt=""></p> <p><strong>Figure 72.</strong> Methodize-Productivity To-Do task manager page with existing tasks.</p> <ol start="12"><li>Execute the following commands to see the pods, its Persistent Volume (PV) and Persistent Volume Claim (PVC) that are created. Figure 73 represents the pods, Figure 74 represents the PV, and Figure 75 represents the PVC of the Methodize-Productivity application.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get pods
<span class="token operator">&gt;</span> kubectl get <span class="token function">pv</span>
<span class="token operator">&gt;</span> kubectl get pvc
</code></pre></div><p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure73.b0c6cb1b.png" alt=""></p> <p><strong>Figure 73.</strong> Pods for the Methodize-Productivity</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure74.aa44d43f.png" alt=""></p> <p><strong>Figure 74.</strong> Persistent volume for Methodize-Productivity</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure75.16eb8aab.png" alt=""></p> <p><strong>Figure 75.</strong> Persistent Volume Claim for Methodize-Productivity</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Create-Datafabric-Cluster-ERE.html" class="prev">
        Integrating External Ezmeral DataFabric with Ezmeral Runtime Enterprise 5.6.0
      </a></span> <span class="next"><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Role-Based-Access-Control.html">
        HPE Ezmeral Runtime Enterprise – Role Based Access Control
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-hpecp/5.6-DL/assets/js/app.a7ecef63.js" defer></script><script src="/hpe-solutions-hpecp/5.6-DL/assets/js/2.bd3d0753.js" defer></script><script src="/hpe-solutions-hpecp/5.6-DL/assets/js/9.54d536e7.js" defer></script>
  </body>
</html>
