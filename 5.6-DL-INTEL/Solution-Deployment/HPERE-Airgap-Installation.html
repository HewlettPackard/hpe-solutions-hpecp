<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HPERE Airgap Installation | HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL INTEL USING REST API BASED DEPLOYMENT</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-hpecp/5.6-DL/assets/css/0.styles.411e0e73.css" as="style"><link rel="preload" href="/hpe-solutions-hpecp/5.6-DL/assets/js/app.368291b0.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.6-DL/assets/js/2.bd3d0753.js" as="script"><link rel="preload" href="/hpe-solutions-hpecp/5.6-DL/assets/js/3.1c7f07ee.js" as="script"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/10.a2ea12b0.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/11.51915c3e.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/12.d90a58c9.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/13.c06042b9.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/14.8f4a8ebc.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/15.0f1c4fc2.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/16.397dba7f.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/17.09f19494.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/18.516a3f85.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/19.00239e5c.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/20.6840390d.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/21.f4aa8039.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/22.8754022c.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/23.e75a5ac2.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/24.7943351b.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/25.fcea4234.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/26.2e649161.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/27.f955e33b.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/28.2be40c54.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/29.d575667a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/4.2206d0c4.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/5.6f43dfef.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/6.691b977a.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/7.d1db4fa3.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/8.957fa150.js"><link rel="prefetch" href="/hpe-solutions-hpecp/5.6-DL/assets/js/9.54d536e7.js">
    <link rel="stylesheet" href="/hpe-solutions-hpecp/5.6-DL/assets/css/0.styles.411e0e73.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-hpecp/5.6-DL/" class="home-link router-link-active"><!----> <span class="site-name">HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL INTEL USING REST API BASED DEPLOYMENT</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.6-DL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-hpecp/5.6-DL/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HPE EZMERAL RUNTIME ENTERPRISE 5.6 ON DL INTEL USING REST API BASED DEPLOYMENT</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Solution-deployment-flow.html" class="sidebar-link">Solution Deployment Flow</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Host-Configuration.html" class="sidebar-link">Preparing Installer Machine</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Automated-ERE-Deployment.html" class="sidebar-link">Automated HPE Ezmeral Runtime Enterprise deployment</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Manual-ERE-Deployment.html" class="sidebar-link">Manually Install and configure HPE Ezmeral Runtime Enterprise 5.6.1</a></li><li><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html" aria-current="page" class="active sidebar-link">HPERE Airgap Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#solution-components-overview" class="sidebar-link">Solution components overview</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#solution-architecture" class="sidebar-link">Solution architecture</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#rmt-server" class="sidebar-link">RMT server</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#enabling-slp-announcements" class="sidebar-link">Enabling SLP Announcements</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#mirror-suse-products-and-packages" class="sidebar-link">Mirror SUSE products and packages</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#download-the-packages" class="sidebar-link">Download the packages</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#disconnect-from-internet" class="sidebar-link">Disconnect from internet</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#docker-registry-and-k8s-rpms-repository-server" class="sidebar-link">Docker registry and K8s RPMs repository server</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#hpere-deployment" class="sidebar-link">HPERE Deployment</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#hpere-host-preparation" class="sidebar-link">HPERE Host preparation</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#preparing-legacy-gpu-hosts" class="sidebar-link">Preparing legacy GPU hosts</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#hpere-deployment-using-airgap" class="sidebar-link">HPERE Deployment Using Airgap</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/HPERE-Airgap-Installation.html#appendix" class="sidebar-link">Appendix</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resources and additional links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hpere-airgap-installation"><a href="#hpere-airgap-installation" class="header-anchor">#</a> HPERE Airgap Installation</h1> <h2 id="solution-components-overview"><a href="#solution-components-overview" class="header-anchor">#</a> Solution components overview</h2> <ol><li><p>RMT server</p></li> <li><p>Repo server</p> <p>a.  Docker registry</p></li> <li><p>Deploying HPE Ezmeral Runtime Enterprise</p></li></ol> <h2 id="solution-architecture"><a href="#solution-architecture" class="header-anchor">#</a> Solution architecture</h2> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure36.c85797fc.png" alt=""></p> <p><strong>Figure 36.</strong> HPERE Airgap Architecture</p> <h2 id="rmt-server"><a href="#rmt-server" class="header-anchor">#</a> RMT server</h2> <h3 id="server-hardware-configuration"><a href="#server-hardware-configuration" class="header-anchor">#</a> Server hardware configuration</h3> <ol><li><p>Network adapter – 1 interface on the production network.</p></li> <li><p>CPU - 12 vCPU</p></li> <li><p>Memory - 36 GB</p></li> <li><p>Hard disk - a minimum of 3 TB</p> <p>a.  / - 2 TB</p> <p>b.  /home - 1 TB</p> <p>c.  /swap - 70 GB</p></li> <li><p>OS - SUSE Enterprise Linux 15 SP3</p></li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure37.4ca56563.png" alt=""></p> <h3 id="partition-details"><a href="#partition-details" class="header-anchor">#</a> Partition details</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>
sles15rmt:~ <span class="token comment"># lsblk</span>

**NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT**

sda <span class="token number">8</span>:0 <span class="token number">0</span> 10T <span class="token number">0</span> disk

├─sda1 <span class="token number">8</span>:1 <span class="token number">0</span> 8M <span class="token number">0</span> part

└─sda2 <span class="token number">8</span>:2 <span class="token number">0</span> 10T <span class="token number">0</span> part

├─system-root <span class="token number">254</span>:0 <span class="token number">0</span> 2T <span class="token number">0</span> lvm /

├─system-swap <span class="token number">254</span>:1 <span class="token number">0</span> <span class="token number">70</span>.8G <span class="token number">0</span> lvm

└─system-home <span class="token number">254</span>:2 <span class="token number">0</span> <span class="token number">953</span>.2G <span class="token number">0</span> lvm /home

sr0 <span class="token number">11</span>:0 <span class="token number">1</span> 663M <span class="token number">0</span> rom

sr1 <span class="token number">11</span>:1 <span class="token number">1</span> <span class="token number">1</span>.1G <span class="token number">0</span> rom
</code></pre></div><h3 id="configuring-rmt-server"><a href="#configuring-rmt-server" class="header-anchor">#</a> Configuring RMT server</h3> <ol><li><p>While installing OS or once the OS is installed on the server to be used as SLES RMT server, provide the following details:</p> <ul><li><p>While installing OS</p> <ul><li>Select the registration method as “register system via scc.suse.com” and provide the &quot;registered email address&quot; and registration code for “SUSE Linux Enterprise Server for x86, AMD64, Intel64”</li></ul></li> <li><p>Once OS is installed, register the system and enable required modules by executing below commands.</p> <ul><li><p>SUSEConnect -r REGISTRATION_CODE -e EMAIL_ADDRESS</p></li> <li><p>SUSEConnect -p sle-ha/15.6.0/x86_64 -r ADDITIONAL REGCODE</p></li> <li><p>SUSEConnect -p sle-module-containers/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-desktop-applications/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-development-tools/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-cap-tools/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p PackageHub/15.6.0/x86_64</p></li> <li><p>SUSEConnect -d -p sle-module-server-applications/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-legacy/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-public-cloud/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-web-scripting/15.6.0/x86_64</p></li></ul></li></ul></li> <li><p>Once the server is registered to SUSE and the required modules are enabled, perform the following steps to install RMT service. Ensure the server is connected to the internet at this moment.</p> <ul><li>Install the prerequisite modules</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> <span class="token function">screen</span> <span class="token function">vim</span> iputils bind-utils
</code></pre></div><p>ii. Install RMT server module</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> rmt-server
</code></pre></div></li> <li><p>Configure RMT</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> yast2 rmt
</code></pre></div><p>This will open a wizard for configuring RMT service</p> <p>i.  Enter your organization credentials. To retrieve your credentials, login to &lt;scc.suse.com/proxies&gt; and look for the “Mirroring Credentials”</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure38.0464a926.png" alt=""> <strong>Figure 38.</strong> Retrieve Credentials</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure39.1394f50f.png" alt=""> <strong>Figure 39.</strong> RMT configuration step 1</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure40.3b344400.png" alt=""> <strong>Figure 40.</strong> RMT configuration step 1 successful</p> <p>ii.  Enter credentials for a new MariaDB user and database name. This user will then be created. Then select Next.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure41.6c27fa28.png" alt=""> <strong>Figure 41.</strong> RMT configuration step 2</p> <p>iii.  If a password for the MariaDB root user is already set, you are required to enter it. If no password is set for root, you are asked to enter a new one.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure42.ff1dd893.png" alt=""></p> <p><strong>Figure 42.</strong> RMT configuration set database root password</p> <p>iv.  Enter a common name for the SSL certificates. The common name should usually be the fully qualified domain name (FQDN) of the server. Enter all domain names and IP addresses with which you want to reach the RMT server as alternative common names.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure43.6f145913.png" alt=""></p> <p><strong>Figure 43.</strong> RMT configuration step 3</p> <p>v.  When all common names are entered, select Next.</p> <p>vi. Provide a password for the CA private certificate key and click OK.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure44.de1cb572.png" alt=""></p> <p><strong>Figure 44.</strong> RMT configuration setting CA private key</p> <p>vii.  If firewalld is enabled on this system, enable the checkbox to open the required ports.
<img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure45.d66d1945.png" alt=""></p> <p><strong>Figure 45.</strong> RMT configuration step 4</p> <p>viii.  Continue with Next.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure46.19ed36f6.png" alt=""></p> <p><strong>Figure 46.</strong> RMT configuration step 5</p> <p>ix.  To view the summary, click Next. Close YaST by clicking Finish. YaST then enables and starts all zypper services and timers.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure47.a56796e3.png" alt=""></p> <p><strong>Figure 47.</strong> RMT configuration Summary</p> <h2 id="enabling-slp-announcements"><a href="#enabling-slp-announcements" class="header-anchor">#</a> Enabling SLP Announcements</h2> <p>The SLP is service discovery protocol that allows computers and other devices to find services in a LAN without prior configuration. RMT
includes the SLP service description file /etc/slp.reg.d/rmt-server.reg.</p> <p>To enable SLP announcements of the RMT service, follow these steps:</p> <ol><li>If firewalld is running, open relevant ports and reload the firewalld configuration:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> firewall-cmd –permanent –add-port<span class="token operator">=</span><span class="token number">427</span>/tcp
<span class="token operator">&gt;</span> firewall-cmd –permanent –add-port<span class="token operator">=</span><span class="token number">427</span>/udp
<span class="token operator">&gt;</span> firewall-cmd –reload
</code></pre></div><ol start="2"><li>Verify that SLP server is installed and possibly install it:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token function">install</span> openslp-server
</code></pre></div><ol start="3"><li>Enable and start the SLP service:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> systemctl <span class="token builtin class-name">enable</span> slpd.service
<span class="token operator">&gt;</span> systemctl restart slpd.service
</code></pre></div><h2 id="mirror-suse-products-and-packages"><a href="#mirror-suse-products-and-packages" class="header-anchor">#</a> Mirror SUSE products and packages</h2> <ol><li>Synchronise all repositories and ID that you have access to.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> rmt-cli <span class="token function">sync</span>
</code></pre></div><ol start="2"><li>List and enable all the products</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> rmt-cli product list –all
<span class="token operator">&gt;</span> rmt-cli product <span class="token builtin class-name">enable</span> <span class="token operator">&lt;</span>ID<span class="token operator">&gt;</span>
</code></pre></div><ol start="3"><li>Start mirror of enabled products</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">screen</span> rmt-cli mirror
</code></pre></div><ol start="4"><li>Register clients to the RMT server using the following URL</li></ol> <ul><li>As a boot parameter</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token assign-left variable">regurl</span><span class="token operator">=</span>http://<span class="token operator">&lt;</span>rmt_server_fqdn<span class="token operator">&gt;</span>/
</code></pre></div><ol start="2"><li>As a local subscription server</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> SUSEConnect –url http://<span class="token operator">&lt;</span>rmt_server_fqdn<span class="token operator">&gt;</span>/
</code></pre></div><h2 id="download-the-packages"><a href="#download-the-packages" class="header-anchor">#</a> Download the packages</h2> <p>The complete set of air gap container image files can be downloaded with the air gap utility script and import them to a local filesystem or remote container registry which are necessary for installing Kubernetes cluster in HPERE in an airgap environment. Download them when the system is connected to internet. Once they are downloaded, disconnect the server from the internet. See <a href="https://docs.containerplatform.hpe.com/56/reference/deploying-the-platform/phase-4/using-the-air-gap-utility-script.html" target="_blank" rel="noopener noreferrer">Using the Air Gap Utility<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="using-the-air-gap-utility"><a href="#using-the-air-gap-utility" class="header-anchor">#</a> Using the Air Gap Utility:</h3> <p>HPE Ezmeral Runtime Enterprise provides a utility you can use to query,filter, and download all air gap container images necessary for your environment to a local filesystem or remote registry. Below steps shows how to use the air gap utility to download files in an air-gapped HPE Ezmeral Runtime Enterprise environment.</p> <p><strong>Installing the Air Gap Utility Package</strong></p> <p>Before downloading files for your air gap environment, you must first install the air gap script package. You can install the package on any non-platform host, even outside the platform installation. Python 2.7 or Python 3.6 and greater is required for install.</p> <p><strong>To install the air gap utility package:</strong></p> <ol><li><p>Download the air gap utility package from the following links:</p> <ul><li><p><a href="https://ezmeral-platform-releases.s3.amazonaws.com/5.6.1/hpeairgaputil-1.3-py2.py3-none-any.whl" target="_blank" rel="noopener noreferrer">HPE air gap utility (North America download site)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://ezmeral-platform-releases-seoul.s3.ap-northeast-2.amazonaws.com/5.6.1/hpeairgaputil-1.3-py2.py3-none-any.whl" target="_blank" rel="noopener noreferrer">HPE air gap utility (Asia Pacific download site)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></li> <li><p>Install Skopeo. In the CLI, enter the following:</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> skopeo
</code></pre></div><ol start="3"><li>Install the hpeairgaputil package</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> pip3 <span class="token function">install</span> hpeairgaputil-1.3-py2.py3-none-any.whl
</code></pre></div><p>Using Air Gap filters:</p> <ol><li>To display a list of options available in the hpe-airgap-util, use the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> hpe-airgap-util –help
</code></pre></div><ol start="2"><li>To copy all required and optional container images use below commands:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> hpe-airgap-util <span class="token parameter variable">--release</span> <span class="token number">5.6</span>.1 <span class="token parameter variable">--required</span> <span class="token parameter variable">--copy</span> <span class="token parameter variable">--dest_url</span> <span class="token operator">&lt;</span>docker-registry-server-ip<span class="token operator">&gt;</span>:5000
<span class="token operator">&gt;</span> hpe-airgap-util <span class="token parameter variable">--release</span> <span class="token number">5.6</span>.1 <span class="token parameter variable">--optional</span> <span class="token parameter variable">--copy</span> <span class="token parameter variable">--dest_url</span> <span class="token operator">&lt;</span>docker-registry-server-ip<span class="token operator">&gt;</span>:5000
</code></pre></div><h2 id="disconnect-from-internet"><a href="#disconnect-from-internet" class="header-anchor">#</a> Disconnect from internet</h2> <p>Once the server is connected to SUSE customer center, up to date with the repositories, packages, RPMs and files, and they are mirrored into the local repository, it is time to disconnect the server from the internet. Refer to appendix <a href="#simulating-an-air-gap-environment">Simulating an air gap environment</a> for the configuration steps utilized in this document.</p> <h3 id="registering-to-rmt-server"><a href="#registering-to-rmt-server" class="header-anchor">#</a> Registering to RMT server</h3> <p>Once OS is installed, please refer to the “Automated HPE Ezmeral Runtime Enterprise deployment” section and run prepare_hosts playbook
for registering client systems to RMT server.</p> <p>Make sure following modules are enabled and up to date by running</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> refresh
</code></pre></div><ul><li><p>SUSEConnect -p sle-ha/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-containers/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-desktop-applications/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-development-tools/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-cap-tools/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p PackageHub/15.6.0/x86_64</p></li> <li><p>SUSEConnect -d -p sle-module-server-applications/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-legacy/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-public-cloud/15.6.0/x86_64</p></li> <li><p>SUSEConnect -p sle-module-web-scripting/15.6.0/x86_64</p></li></ul> <h2 id="docker-registry-and-k8s-rpms-repository-server"><a href="#docker-registry-and-k8s-rpms-repository-server" class="header-anchor">#</a> Docker registry and K8s RPMs repository server</h2> <h3 id="server-hardware-configuration-2"><a href="#server-hardware-configuration-2" class="header-anchor">#</a> Server hardware configuration</h3> <ol><li><p>Network adapter – 1 interface on the production network.</p></li> <li><p>CPU - 2 vCPU</p></li> <li><p>Memory - 16 GB</p></li> <li><p>Hard disk - a minimum of 500 GB</p></li> <li><p>OS - SUSE Enterprise Linux 15 SP3</p></li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure48.d4a2a6ca.png" alt=""></p> <h3 id="partition-details-2"><a href="#partition-details-2" class="header-anchor">#</a> Partition details</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>NAME            MAJ:MIN     RM  SIZE    RO  TYPE    MOUNTPOINT

sda             <span class="token number">8</span>:0         <span class="token number">0</span>   500G <span class="token number">0</span> disk

├─sda1          <span class="token number">8</span>:1         <span class="token number">0</span>   500M <span class="token number">0</span> part /boot/efi

└─sda2          <span class="token number">8</span>:2         <span class="token number">0</span>   <span class="token number">499</span>.5G <span class="token number">0</span> part

├─system-swap   <span class="token number">254</span>:0       <span class="token number">0</span>   63G <span class="token number">0</span> lvm <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>

├─system-root   <span class="token number">254</span>:1       <span class="token number">0</span>   150G <span class="token number">0</span> lvm /

├─system-var    <span class="token number">254</span>:2       <span class="token number">0</span>   100G <span class="token number">0</span> lvm /var

├─system-srv    <span class="token number">254</span>:3       <span class="token number">0</span>   100G <span class="token number">0</span> lvm /srv

└─system-home   <span class="token number">254</span>:4       <span class="token number">0</span>   25G <span class="token number">0</span> lvm /home

sr0             <span class="token number">11</span>:0        <span class="token number">1</span>   1024M <span class="token number">0</span> rom

sr1             <span class="token number">11</span>:1        <span class="token number">1</span>   1024M <span class="token number">0</span> rom ```

</code></pre></div><h3 id="configuring-docker-registry"><a href="#configuring-docker-registry" class="header-anchor">#</a> Configuring docker registry</h3> <p>Login to the server which would be utilized as the docker register andperform the following steps:</p> <ol><li><p>Register to the RMT server. Refer to section <a href="#registering-to-rmt-server">Registering to RMT server</a> for more details.</p></li> <li><p>Install and start Docker on SLES</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token function">install</span> <span class="token function">docker</span>
<span class="token operator">&gt;</span> <span class="token function">docker</span> –version
<span class="token operator">&gt;</span> systemctl <span class="token builtin class-name">enable</span> docker.service
<span class="token operator">&gt;</span> systemctl start docker.service
</code></pre></div><ol start="3"><li>Create registry on SLES as a docker container with restart policy as always.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 –restart<span class="token operator">=</span>always –name registry registry:2
</code></pre></div><ol start="4"><li><p>Disconnect the server from the internet. Refer to section <a href="#simulating-an-air-gap-environment">Simulating an air gap environment</a> for more details.</p></li> <li><p>Pull, Tag &amp; Push an image to the local registry</p></li></ol> <ul><li><p>Copy the container images tar file from the repository server into this server.</p></li> <li><p>Navigate to the folder containing images required for deploying HPERE</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>path_to_the_images_tar_file<span class="token operator">&gt;</span>
</code></pre></div><ul><li>Load the tar file containing the images required to setup the kubernetes cluster from HPERE in an airgap environment. See Appendix for detailed list of images needed.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">docker</span> load <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>images_tar_file<span class="token operator">&gt;</span>
</code></pre></div><ul><li>Tag each of the image from the list using the following command</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">docker</span> tag <span class="token operator">&lt;</span>individual image name extracted from images_tar_file<span class="token operator">&gt;</span> localhost:5000/<span class="token operator">&lt;</span>individual image name extracted from images_tar_file<span class="token operator">&gt;</span>
</code></pre></div><ul><li>Push each of the tagged image using the following command</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">docker</span> push localhost:5000/<span class="token operator">&lt;</span>individual image name extracted from images_tar_file<span class="token operator">&gt;</span>
</code></pre></div><ul><li>Test the presence of images</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">docker</span> images
<span class="token operator">&gt;</span> <span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> <span class="token operator">&lt;</span>internal registry <span class="token function">ip</span> address<span class="token operator">&gt;</span>:5000
</code></pre></div><h3 id="validate-registry-from-local-environment"><a href="#validate-registry-from-local-environment" class="header-anchor">#</a> Validate registry from local environment</h3> <ol><li>Within the same server</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">docker</span> pull <span class="token operator">&lt;</span>image_not_present_in_registry<span class="token operator">&gt;</span>  - fail sinceinternet isn’t available
<span class="token operator">&gt;</span> <span class="token function">docker</span> pull <span class="token operator">&lt;</span>image_within_registry<span class="token operator">&gt;</span> - success
</code></pre></div><ol start="2"><li><p>Outside of this registry server, on the hosts that need access to the local docker registry</p> <ul><li>Create or update the /etc/docker/daemon.json on the docker hosts which needs access to the above created docker registry. Assuming there are no other settings in the file, it should have the following contents:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">{</span>
“insecure-registries” <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>“<span class="token operator">&lt;</span>registry_server_ip_address<span class="token operator">&gt;</span>:5000”<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Substitute the “&lt;registry_server_ip_address&gt;&quot; with the address of insecure registry.</p> <ul><li>Restart Docker for the changes to take effect.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> systemctl restart docker.service
</code></pre></div><p>iii.  Pull the images</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">docker</span> pull <span class="token operator">&lt;</span>image_not_present_in_registry<span class="token operator">&gt;</span> <span class="token comment">#### fail since internet isn’t available</span>
<span class="token operator">&gt;</span> <span class="token function">docker</span> pull <span class="token operator">&lt;</span>image_within_registry<span class="token operator">&gt;</span> <span class="token comment">### success</span>
</code></pre></div></li></ol> <h2 id="hpere-deployment"><a href="#hpere-deployment" class="header-anchor">#</a> HPERE Deployment</h2> <h3 id="operating-system-deployment-for-hpere-hosts"><a href="#operating-system-deployment-for-hpere-hosts" class="header-anchor">#</a> Operating System Deployment for HPERE hosts</h3> <p>The supported version of SLES for deploying HPE Runtime Enterprise is SUSE Enterprise Linux 15 SP3. This section outlines the manual steps involved in deploying OS for the servers used as HPERE controller, HPERE gateway, kubernetes master and kubernetes worker nodes.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>OS can be deployed by using the playbook located in <a href="https://github.com/HewlettPackard/hpe-solutions-hpecp/blob/master/LTI/Lite_Touch_Installation/playbooks/os_deployment.yml" target="_blank" rel="noopener noreferrer">https://github.com/HewlettPackard/hpe-solutions-hpecp/blob/master/LTI/Lite_Touch_Installation/playbooks/os_deployment.yml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <ol><li><p>Boot using the installation Media select language &amp; and the product “Sles 15 SP3”.</p></li> <li><p>Select you registration method as the RMT server set up previously in section RMT server and choose “yes” to receive updated repos.</p></li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure49.5546a75f.png" alt=""></p> <p><strong>Figure 49.</strong> Registration Method</p> <ol start="3"><li><p>Select the following Extension and Modules:</p> <ul><li><p>sle-ha/15.3/x86_64</p></li> <li><p>PackageHub/15.3/x86_64</p></li> <li><p>sle-module-legacy/15.3/x86_64</p></li> <li><p>sle-module-python2/15.3/x86_64</p></li> <li><p>sle-module-containers/15.3/x86_64</p></li> <li><p>sle-module-basesystem/15.3/x86_64</p></li> <li><p>sle-module-public-cloud/15.3/x86_64</p></li> <li><p>sle-module-desktop-applications/15.3/x86_64</p></li> <li><p>sle-module-server-applications/15.3/x86_64</p></li> <li><p>sle-module-development-tools/15.3/x86_64</p></li></ul></li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Alternatively, refer to the section <a href="#disconnect-from-internet">Registering to RMT server</a> for registering to RMT server once OS is installed.</p></div> <ol start="4"><li>Using guided Partitioning setup, the OS partition as shown below
<img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure50.bb186cda.png" alt=""></li></ol> <p><strong>Figure 50.</strong> OS Partitioning
5.  Choose “minimal” installation mode:
<img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure51.631f6480.png" alt=""></p> <p><strong>Figure 51.</strong> System Role</p> <ol start="6"><li>In the install summary ensure SSH access is enabled and then click Install.
<img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure52.01f39732.png" alt=""></li></ol> <p><strong>Figure 52.</strong> Enable SSH Access</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>DNS/Bind A record, PTR record is required for the HPERE installation.</p></div> <h2 id="hpere-host-preparation"><a href="#hpere-host-preparation" class="header-anchor">#</a> HPERE Host preparation</h2> <p>This section covers manual steps for preparing Hosts for Ezmeral Runtime Enterprise. Automated script is available for HPERE Host preparation at <a href="https://github.com/HewlettPackard/hpe-solutions-hpecp/blob/master/LTI/Lite_Touch_Installation/playbooks/prepare_hosts.yml" target="_blank" rel="noopener noreferrer">https://github.com/HewlettPackard/hpe-solutions-hpecp/blob/master/LTI/Lite_Touch_Installation/playbooks/prepare_hosts.yml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <ol><li>If using proxy or ignore, setup proxy as shown below in the configuration file - /etc/sysconfig/proxy</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token assign-left variable">NO_PROXY</span><span class="token operator">=</span>”localhost, <span class="token number">127.0</span>.0.1l”
<span class="token operator">&gt;</span> <span class="token assign-left variable">HTTP_PROXY</span><span class="token operator">=</span>”http://<span class="token operator">&lt;</span>proxy server<span class="token operator">&gt;</span>:port/”
<span class="token operator">&gt;</span> <span class="token assign-left variable">HTTPS_PROXY</span><span class="token operator">=</span>” http://<span class="token operator">&lt;</span>proxy server<span class="token operator">&gt;</span>:port/”
</code></pre></div><ol start="2"><li>Fix autofs configuration.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> autofs
<span class="token operator">&gt;</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">''</span> <span class="token parameter variable">-e</span> “s<span class="token operator">|</span><span class="token comment">#/net.*$|/net -hosts|g” /etc/auto.master</span>
</code></pre></div><ol start="3"><li>Install libcgroup V1</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> libcgroup1
</code></pre></div><ol start="4"><li>Reboot the server</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">reboot</span>
</code></pre></div><ol start="5"><li>Perform a system update if necessary</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> up –non-interactive
</code></pre></div><h2 id="preparing-legacy-gpu-hosts"><a href="#preparing-legacy-gpu-hosts" class="header-anchor">#</a> Preparing legacy GPU hosts</h2> <p>All the above repos for worker hosts are required. In addition, perform the following steps from <a href="https://docs.containerplatform.hpe.com/56/reference/deploying-the-platform/GPU_Driver_Installation.html" target="_blank" rel="noopener noreferrer">GPU_Driver_Installation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Except of course, you will be using zypper instead of yum.</p> <p>For the new kernel to load.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token function">install</span> kernel-default-devel gcc-c++ perl pciutils
</code></pre></div><p>In addition, you need to install the following package before running the NVIDIA installer on the host.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">zypper</span> <span class="token keyword">in</span> libglvnd-devel
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If the server is not rebooted platform install will fail. You may choose to not reboot now for GPU hosts.</p></div> <h2 id="hpere-deployment-using-airgap"><a href="#hpere-deployment-using-airgap" class="header-anchor">#</a> HPERE Deployment Using Airgap</h2> <p>User can follow 2 methods to Deploy ERE using airgap mode.</p> <p><strong>Method 1: ERE Platform Deployment Using Automation</strong></p> <p>Usage of Ansible playbooks to deploy the HPE Ezmeral Runtime Enterprise is automated and eliminates manual intervention. <strong>site.yml</strong> playbook contains the script to deploy HPE Ezmeral Runtime Enterprise starting from the OS_deployment until ERE deployment.</p> <p>Refer to section <a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Automated-ERE-Deployment.html#ere-deployment-through-air-gapped-environment">ERE deployment through air-gapped environment</a> for more details.</p> <p><strong>Method 2: ERE Platform Deployment Using Manual Process</strong></p> <p>In Manual process we need to bringup controller, add gateway, k8s hosts and k8s cluster using below process.</p> <h3 id="hpere-controller"><a href="#hpere-controller" class="header-anchor">#</a> HPERE controller</h3> <p>Once the OS is installed, login to the server to be configured as the HPERE controller and perform the steps as per <a href="#hpere-host-preparation">Host preparation</a> section.</p> <h3 id="installing-hpere-controller-for-sles"><a href="#installing-hpere-controller-for-sles" class="header-anchor">#</a> Installing HPERE Controller for SLES</h3> <p>On the same server, perform the following steps to install HPERE controller</p> <ol><li><p>Copy the hpe-cp-sles-release-5.6.1-xxxx.bin to /root folder from the repository server.</p> <p>You can download .bin file from <a href="https://ezmeral-platform-releases.s3.amazonaws.com/5.6.1/3088/hpe-cp-sles-release-5.6.1-3088.bin" target="_blank" rel="noopener noreferrer">https://ezmeral-platform-releases.s3.amazonaws.com/5.6.1/3088/hpe-cp-sles-release-5.6.1-3088.bin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>Copy the feed.json file from the repository server to the /srv/bluedata/catalog folder.</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">mkdir</span> –p /srv/bluedata/catalog
<span class="token operator">&gt;</span> <span class="token function">cp</span> <span class="token operator">&lt;</span>location_of_feed.json_in_controller<span class="token operator">&gt;</span> /srv/bluedata/catalog/
</code></pre></div><ol start="3"><li>Give execute permission using the following command</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">chmod</span> +x /root/hpe-cp-sles-release-5.6.1-3088.bin
<span class="token operator">&gt;</span> <span class="token function">chmod</span> +x /srv/bluedata/catalog/
<span class="token operator">&gt;</span> <span class="token function">chmod</span> +x /srv/bluedata/catalog/*
</code></pre></div><ol start="4"><li>Execute the HPERE bin file using the following command</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ./hpe-cp-sles-release-5.6.1-3088.bin –default-password admin123
</code></pre></div><ol start="5"><li><p>Once completed, Login to the controller via browser to land to the admin UI</p></li> <li><p>Once logged in to the HPERE Controller UI, configure the controller by providing the details as shown in the following figure and click submit.</p></li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure53.fb6bc4ad.png" alt=""></p> <ol start="7"><li>Controller installation is then instantiated, wait until it is complete.</li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure54.fcbf72d5.png" alt=""></p> <ol start="8"><li>Once the installation is complete, the HPERE login page would be accessible.</li></ol> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure55.1a66c9c9.png" alt=""></p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure56.17d98ddc.png" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Default credentials to HPERE login access is admin/admin123</p></div> <h3 id="hpere-gateway-server"><a href="#hpere-gateway-server" class="header-anchor">#</a> HPERE gateway server</h3> <p>Once the OS is installed, login to the server to be configured as the HPERE controller and perform the steps as per <a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Manual-ERE-Deployment.html#hpe-ezmeral-runtime-enterprise-gateway">gateway</a> section.</p> <h3 id="airgap-settings-in-hpere-controller"><a href="#airgap-settings-in-hpere-controller" class="header-anchor">#</a> Airgap settings in HPERE Controller</h3> <p>The Air Gap tab of the System Settings screen allows the Platform Administrator to specify “air gap” settings to be used when the Kubernetes hosts, clusters, and tenants within HP Ezmeral Runtime Enterprise do not have connectivity to the Internet.</p> <p>Enter the following settings:</p> <ul><li><p>Yum repository section of this tab:</p> <ul><li><p>Base URL: This is the URL to the YUM repository.</p></li> <li><p>Repo GPG URL: This is the URL to the YUM repository GNU Privacy Guard (optional).</p></li> <li><p>RPM GPG URL: This is the URL to the RPM repository GNU Privacy Guard (optional).</p></li></ul></li> <li><p>The Container Registry section of this tab:</p> <ul><li><p>Container URL: URL to the Docker registry that contains the images needed for air-gap Kubernetes installations within HPE Container Platform.</p></li> <li><p>Username: Username to access the Docker registry, if needed.</p></li> <li><p>Password: Password to access the Docker registry, if needed.</p></li> <li><p>Secured: Checking the Secured checkbox indicates that the Kubernetes air-gap Docker registry is secure.</p></li> <li><p>Docker Client Certificate: Location of the Docker registry certificate if you are using a secured connection. Clicking the Browse button opens a browser-standard Open dialog box that allows you to navigate to and locate the certificate to add.</p></li> <li><p>Clicking Submit saves your changes.</p></li></ul> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure57.82580b50.png" alt=""></p></li></ul> <h3 id="kubernetes-hosts"><a href="#kubernetes-hosts" class="header-anchor">#</a> Kubernetes hosts</h3> <h3 id="preparing-kubernetes-hosts"><a href="#preparing-kubernetes-hosts" class="header-anchor">#</a> Preparing Kubernetes hosts</h3> <p>Once the OS is installed, login to the server to be configured as the HPERE controller and perform the steps as per <a href="#hpere-host-preparation">Host preparation</a> section.</p> <p>After the hosts are prepared, login to the servers and perform the following:</p> <ul><li>Edit the /etc/sysctl.conf file and turn off reverse path filter (add the following line if necessary):</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">vi</span> /etc/sysctl.conf
<span class="token operator">&gt;</span> net.ipv4.conf.all.rp_filter <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div><ul><li>Reboot the server for changes to reflect</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">reboot</span>
</code></pre></div><ul><li>Turn off swap</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> swapoff –a
</code></pre></div><p>Once above-mentioned configurations are completed on the host, we can perform the ubernetes host installation and create the ubernetes cluster</p> <h3 id="kubernetes-host-installation"><a href="#kubernetes-host-installation" class="header-anchor">#</a> Kubernetes host installation</h3> <p>Please refer to the “<a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Manual-ERE-Deployment.html#add-kubernetes-hosts">Adding Kubernetes Hosts</a>” section in this document for installing Hosts.</p> <h3 id="creating-a-kubernetes-cluster"><a href="#creating-a-kubernetes-cluster" class="header-anchor">#</a> Creating a Kubernetes Cluster</h3> <p>Please refer to the “<a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Manual-ERE-Deployment.html#create-a-kubernetes-cluster">Creating Kubernetes Cluster</a>” section in this document for creating cluster.</p> <h3 id="launching-kubernetes-dashboard"><a href="#launching-kubernetes-dashboard" class="header-anchor">#</a> Launching Kubernetes Dashboard</h3> <p>Please refer to the “<a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Manual-ERE-Deployment.html#launch-the-kubernetes-dashboard">Launching Kubernetes Dashboard</a>” section to launch kubernetes dashboard</p> <h3 id="validating-the-deployment"><a href="#validating-the-deployment" class="header-anchor">#</a> Validating the deployment</h3> <p>The following example is based on the WordPress and MySQL with Persistent Volume described <a href="https://kubernetes.io/docs/tutorials-stateful-application/mysql-wordpress-persistent-volume/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>MySQL and WordPress each require a Persistent Volume to store data. Their Persistent Volume Claims will be created at the deployment step. HPE Ezmeral Runtime Enterprise uses MapR as the default persistent volume.</p> <p>Begin by adding a Secret generator in kustomization.yaml by executing the following command, being sure to replace YOUR_PASSWORD with the password you want to use.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">mkdir</span> wordpress
<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> wordpress
<span class="token operator">&gt;</span> <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">&gt;</span>./kustomization.yaml
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>secretGenerator:
- name: mysql-pass
literals:
- <span class="token assign-left variable">password</span><span class="token operator">=</span>YOUR_PASSWORD
EOF
</code></pre></div><p>Next, use either of the following methods, create manifests based on the following two yaml manifest files for the MySQL and WordPress services, respectively:</p> <ul><li><p><a href="https://kubernetes.io/examples/application/wordpress/mysql-deployment.yaml" target="_blank" rel="noopener noreferrer">https://kubernetes.io/examples/application/wordpress/mysql-deployment.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://kubernetes.io/examples/application/wordpress/wordpress-deployment.yaml" target="_blank" rel="noopener noreferrer">https://kubernetes.io/examples/application/wordpress/wordpress-deployment.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <p>If you installed HPE ERE with tenant storage, then MapR will already be registered as the default Storage Class in this namespace.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get StorageClass
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>NAME               PROVISIONER     AGE
default <span class="token punctuation">(</span>default<span class="token punctuation">)</span> com.mapr.csi-kdf 39h
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl describe StorageClass
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>Name <span class="token builtin class-name">:</span> default
IsDefaultClass <span class="token builtin class-name">:</span> Yes
Annotations <span class="token builtin class-name">:</span> storageclass.kubernetes.io/is-default-class<span class="token operator">=</span>true
Provisioner <span class="token builtin class-name">:</span> com.mapr.csi-kdf
Parameters <span class="token builtin class-name">:</span>
<span class="token assign-left variable">cldbHosts</span><span class="token operator">=</span><span class="token number">192.168</span>.20.131:7222,cluster<span class="token operator">=</span>epic.mapr.cluster,csi.storage.k8s.io/provisioner-secret-name<span class="token operator">=</span>mapr-user-secret,csi.storage.k8s.io/provisioner-secret-namespace<span class="token operator">=</span>mapr-csi,csiNodePublishSecretName<span class="token operator">=</span>mapr-ticket-secret,csiNodePublishSecretNamespace<span class="token operator">=</span>mapr-csi,mountPrefix<span class="token operator">=</span>/mapr-csi,namePrefix<span class="token operator">=</span>k8s-1-,platinum<span class="token operator">=</span>true,restServers<span class="token operator">=</span><span class="token number">192.168</span>.20.131:8443,securityType<span class="token operator">=</span>secure
AllowVolumeExpansion <span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>
MountOptions <span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
ReclaimPolicy <span class="token builtin class-name">:</span> Delete
VolumeBindingMode <span class="token builtin class-name">:</span> Immediate
Events <span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>In these two manifest files, both the WordPress service and MySQL are requesting a persistent volume (PV)</p> <p>Neither pod makes any explicit request for a specific storageClassName. Hence, they will use the default MapR StorageClass.</p> <ul><li>Edit the WordPress manifest yaml to use the NodePort service instead of LoadBalancer service. This needs to be done for HPE ERE to re-map the ports.</li></ul> <p>Continue by adding these two manifests to the kustomization.yaml file.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">&gt;&gt;</span>./kustomization.yaml
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>resources:
- mysql-deployment.yaml
- wordpress-deployment.yaml
EOF
</code></pre></div><ul><li>The kustomization.yaml contains all of the resources for deploying a WordPress site and a MySQL database. You can apply the directory, and then verify both the MapR volumes and the services, as follows:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl apply –kustomize ./
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>secret/mysql-pass-9tt65k5fgm created
service/wordpress-mysql created
service/wordpress created
deployment.apps/wordpress-mysql created
deployment.apps/wordpress created
persistentvolumeclaim/mysql-pv-claim created
persistentvolumeclaim/wp-pv-claim created
</code></pre></div><p>Confirm that PVC is using the MapR StorageClass (see highlighted text below).</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get pvc
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>NAME            STATUS                  VOLUME                       CAPACITY ACCESS MODES  STORAGECLASS AGE

mysql-pv-claim  Bound   mapr-pv-16f97a33-b8dd-488a-b6db-1d94a84286e2 20Gi       RWO         default     48s
wp-pv-claim     Bound   mapr-pv-896b3504-e9ba-4593-b9a0-88a9ece392b5 20Gi       RWO         default     48s
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get <span class="token function">pv</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE

mapr-pv-32850109-ef66-42db-9522-b563fbc01eae 10Gi RWO Delete Bound bdwebterm/pvc-kd-977sb-0 default 41h
mapr-pv-a24b1733-39db-40d2-bdaf-0be7c22ed83b 10Gi RWO Delete Bound bdwebterm/pvc-kd-nbwhn-0 default 31h
mapr-pv-dbf96aed-dafd-47b7-87d4-7d343f182d8b 20Gi RWO Delete Bound default/mysql-pv-claim default 69s
mapr-pv-e3c1db71-2865-425c-971e-c01466e9d295 20Gi RWO Delete Bound default/wp-pv-claim default 69s
mapr-pv-ed5f1be3-9be2-4470-83cf-67f9b31e9dbf 10Gi RWO Delete Bound bdwebterm/pvc-kd-dl2
</code></pre></div><ul><li>Label the WordPress service so that the front-end NodePort service will be exposed via the HPE Container Platform Gateway host. This step is not necessary if the service was created in the namespace of a tenant that has the Map Services to Gateway option enabled.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get services
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span> AGE
kubernetes ClusterIP <span class="token number">10.96</span>.0.1 <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span> <span class="token number">443</span>/TCP 26h
wordpress NodePort <span class="token number">10.96</span>.98.248 <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span> <span class="token number">80</span>:30996/TCP 24s
wordpress-mysql ClusterIP None <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span> <span class="token number">3306</span>/TCP 24s
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl label svc wordpress hpecp.hpe.com/hpecp-internal-gateway<span class="token operator">=</span>true
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>service/wordpress labeled
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl describe <span class="token function">service</span> wordpress
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>Name: wordpress
Namespace: default
Labels: <span class="token assign-left variable">app</span><span class="token operator">=</span>wordpress
hpecp.hpe.com/hpecp-internal-gateway<span class="token operator">=</span>true
Annotations: hpecp-internal-gateway/80: mip.storage.enterprise.net:10006
Selector: <span class="token assign-left variable">app</span><span class="token operator">=</span>wordpress,tier<span class="token operator">=</span>frontend
Type: NodePort
IP: <span class="token number">10.96</span>.98.248
Port: <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span> <span class="token number">80</span>/TCP
TargetPort: <span class="token number">80</span>/TCP
NodePort: <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span> <span class="token number">30996</span>/TCP
Endpoints: <span class="token number">10.244</span>.2.9:80
Session Affinity: None
External Traffic Policy: Cluster
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal Service 26s kubedirector Created HPECP K8S <span class="token function">service</span>
</code></pre></div><ul><li>Copy the IP address and port number (see highlighted text above) to your browser. You should see set-up page similar to the following screenshot:</li></ul> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure58.e51ba2ee.png" alt=""></p> <p><strong>Figure 58.</strong> Wordpress Application</p> <p>Destroy the application deployments (e.g. pods) and restart the deployments, making sure to preserve the WordPress application information and still preserved.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl delete deployment wordpress
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>deployment.extensions “wordpress” deleted
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl delete deployment wordpress-mysql
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>deployment.extensions “wordpress-mysql” deleted
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get pods
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>No resources found.
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get deployments
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>No resources found.
</code></pre></div><p>The service is gone, as expected.</p> <p><img src="/hpe-solutions-hpecp/5.6-DL/assets/img/figure59.7a3b5964.png" alt=""></p> <p>Reapply the same deployment, and reconnect to persistent storage.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl apply <span class="token parameter variable">-k</span> ./
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>secret/mysql-pass-9tt65k5fgm unchanged
service/wordpress-mysql unchanged
service/wordpress unchanged
deployment.apps/wordpress-mysql created
deployment.apps/wordpress created
persistentvolumeclaim/mysql-pv-claim unchanged
persistentvolumeclaim/wp-pv-claim unchanged
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl get pods
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>NAME READY STATUS RESTARTS AGE
wordpress-594759d7f6-jdnvp <span class="token number">1</span>/1 Running <span class="token number">0</span> 27s
wordpress-mysql-847b7b996d-dwf6s <span class="token number">1</span>/1 Running <span class="token number">0</span> 28s
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl describe <span class="token function">service</span> wordpress
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>Name: wordpress
Namespace: default
Labels: <span class="token assign-left variable">app</span><span class="token operator">=</span>wordpress
Hpecp.hpe.com/hpecp-internal-gateway<span class="token operator">=</span>true
Annotations: hpecp-internal-gateway/80: mip.storage.enterprise.net:10006
Selector: <span class="token assign-left variable">app</span><span class="token operator">=</span>wordpress,tier<span class="token operator">=</span>frontend
Type: NodePort
IP: <span class="token number">10.96</span>.35.129
Port: <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span> <span class="token number">80</span>/TCP
TargetPort: <span class="token number">80</span>/TCP
NodePort: <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span> <span class="token number">31589</span>/TCP
Endpoints: <span class="token number">10.244</span>.1.18:80
Session Affinity: None
External Traffic Policy: Cluster
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal Service 12m kubedirector Created HPECP K8S <span class="token function">service</span>
</code></pre></div><p>The WordPress service is restored.</p> <ul><li>Finally, you will need to delete the entire deployment in order to free up all of the resources, including the persistent storage.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl delete <span class="token parameter variable">-k</span> ./
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>secret “mysql-pass-9tt65k5fgm” deleted
<span class="token function">service</span> “wordpress-mysql” deleted
<span class="token function">service</span> “wordpress” deleted
deployment.apps “wordpress-mysql” deleted
deployment.apps “wordpress” deleted
persistentvolumeclaim “mysql-pv-claim” deleted
persistentvolumeclaim “wp-pv-claim” deleted
</code></pre></div><h2 id="appendix"><a href="#appendix" class="header-anchor">#</a> Appendix</h2> <h3 id="simulating-an-air-gap-environment"><a href="#simulating-an-air-gap-environment" class="header-anchor">#</a> Simulating an air gap environment</h3> <ol><li>Update a dummy gateway IP address in either of the following files</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">vi</span> /etc/sysconfig/network/ifcfg-eth0
<span class="token operator">&gt;</span> <span class="token function">vi</span> /etc/sysconfig/network/ifroute-eth0
</code></pre></div><ol start="2"><li>Restart the network</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> systemctl restart network
</code></pre></div><ol start="3"><li>Validate if the server is disconnected to internet or not</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">curl</span> api.ipify.org
</code></pre></div><p>This command provides the external facing IP address of the server in the event server is connected to the internet</p> <h3 id="suse-rmt-server"><a href="#suse-rmt-server" class="header-anchor">#</a> SUSE RMT server</h3> <p>This section provides a detailed list of SUSE RPMs required for bringing up the HPERE setup on SUSE Linux SP3 in an airgap environment.</p> <h3 id="suse-products-and-extensions-overview"><a href="#suse-products-and-extensions-overview" class="header-anchor">#</a> SUSE products and extensions overview</h3> <table><thead><tr><th>ID</th> <th>Product</th> <th>Mandatory</th> <th>Mirror ?</th></tr></thead> <tbody><tr><td>4450</td> <td>SLE-15-SP3-Desktop-NVIDIA-Driver for</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4001</td> <td>SLE-Module-Basesystem15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3999</td> <td>SLE-Module-Basesystem15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4098</td> <td>SLE-Module-Containers15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4096</td> <td>SLE-Module-Containers15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4118</td> <td>SLE-Module-Desktop-Applications15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4116</td> <td>SLE-Module-Desktop-Applications15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4138</td> <td>SLE-Module-DevTools15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4136</td> <td>SLE-Module-DevTools15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4173</td> <td>SLE-Module-HPC15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4171</td> <td>SLE-Module-HPC15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4193</td> <td>SLE-Module-Legacy15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4191</td> <td>SLE-Module-Legacy15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4033</td> <td>SLE-Module-Packagehub-Subpackages15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4030</td> <td>SLE-Module-Packagehub-Subpackages15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4223</td> <td>SLE-Module-Public-Cloud15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4221</td> <td>SLE-Module-Public-Cloud15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4243</td> <td>SLE-Module-Python2-15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4241</td> <td>SLE-Module-Python2-15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4058</td> <td>SLE-Module-Server-Applications15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4056</td> <td>SLE-Module-Server-Applications15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4163</td> <td>SLE-Module-Web-Scripting15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4161</td> <td>SLE-Module-Web-Scripting15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4078</td> <td>SLE-Product-HA15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4076</td> <td>SLE-Product-HA15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3934</td> <td>SLE-Product-HPC-15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3932</td> <td>SLE-Product-HPC-15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3939</td> <td>SLE-Product-SLED15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3937</td> <td>SLE-Product-SLED15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3963</td> <td>SLE-Product-SLES15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3960</td> <td>SLE-Product-SLES15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4278</td> <td>SLE-Product-WE15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4276</td> <td>SLE-Product-WE15-SP3-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>3962</td> <td>SLE15-SP3-Installer-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4923</td> <td>SUSE-CAASP-4.5-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4921</td> <td>SUSE-CAASP-4.5-Updates for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4028</td> <td>SUSE-PackageHub-15-SP3-Backports-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr> <tr><td>4032</td> <td>SUSE-PackageHub-15-SP3-Pool for sle-15-x86_64</td> <td>Mandatory</td> <td>Mirror</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-hpecp/5.6-DL/Solution-Deployment/Manual-ERE-Deployment.html" class="prev">
        Manually Install and configure HPE Ezmeral Runtime Enterprise 5.6.1
      </a></span> <span class="next"><a href="/hpe-solutions-hpecp/5.6-DL/Additional-Features-and-Functionality/Lite-Touch-Installation.html">
        Lite Touch Installation (LTI)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-hpecp/5.6-DL/assets/js/app.368291b0.js" defer></script><script src="/hpe-solutions-hpecp/5.6-DL/assets/js/2.bd3d0753.js" defer></script><script src="/hpe-solutions-hpecp/5.6-DL/assets/js/3.1c7f07ee.js" defer></script>
  </body>
</html>
