(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{311:function(t,e,s){t.exports=s.p+"assets/img/figure99.5f99fc9c.png"},312:function(t,e,s){t.exports=s.p+"assets/img/figure100.27b7e871.png"},313:function(t,e,s){t.exports=s.p+"assets/img/figure101.82cd4b55.png"},314:function(t,e,s){t.exports=s.p+"assets/img/figure102.e618674a.png"},315:function(t,e,s){t.exports=s.p+"assets/img/figure103.e0447006.png"},316:function(t,e,s){t.exports=s.p+"assets/img/figure104.b6354e77.png"},317:function(t,e,s){t.exports=s.p+"assets/img/figure105.3c7f7293.png"},318:function(t,e,s){t.exports=s.p+"assets/img/figure106.66810525.png"},319:function(t,e,s){t.exports=s.p+"assets/img/figure107.0ea24d92.png"},320:function(t,e,s){t.exports=s.p+"assets/img/figure108.d54de4c1.png"},321:function(t,e,s){t.exports=s.p+"assets/img/figure109.21f89dde.png"},322:function(t,e,s){t.exports=s.p+"assets/img/figure110.9156aab4.png"},323:function(t,e,s){t.exports=s.p+"assets/img/figure111.e5f5d219.png"},324:function(t,e,s){t.exports=s.p+"assets/img/figure112.72976c24.png"},325:function(t,e,s){t.exports=s.p+"assets/img/figure113.c86e194b.png"},326:function(t,e,s){t.exports=s.p+"assets/img/figure114.6b88dfa9.png"},327:function(t,e,s){t.exports=s.p+"assets/img/figure115.be8bc14b.png"},328:function(t,e,s){t.exports=s.p+"assets/img/figure116.7f3777b4.png"},410:function(t,e,s){"use strict";s.r(e);var a=s(14),r=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"istio-with-kiali-dashboard-deployment-on-hpere"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#istio-with-kiali-dashboard-deployment-on-hpere"}},[t._v("#")]),t._v(" Istio with Kiali dashboard deployment on HPERE")]),t._v(" "),e("h3",{attrs:{id:"introduction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),e("p",[t._v("Istio is a service mesh technology that helps in service-to-service communications. It provides an easy way to create a network of deployed services with load balancing, service-to-service authentication, monitoring and many more without requiring any changes in service code. Istio deploys a special sidecar proxy that intercepts all network communication between microservices, using Istio’s control plane functionality. Kiali works with Istio to visualize the service mesh topology. Kiali is a management console for Istio, and as such, Istio is a requirement. It provides and controls the service mesh")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Pre-requisites")]),t._v(" "),e("ul",[e("li",[t._v("Access to HPERE WEBGUI")])])]),t._v(" "),e("h3",{attrs:{id:"flow-diagram"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flow-diagram"}},[t._v("#")]),t._v(" Flow Diagram")]),t._v(" "),e("p",[e("img",{attrs:{src:s(311),alt:""}})]),t._v(" "),e("p",[e("strong",[t._v("Figure 99.")]),t._v(" Istio cluster creation flow diagarm")]),t._v(" "),e("h3",{attrs:{id:"deployment-process"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deployment-process"}},[t._v("#")]),t._v(" Deployment Process")]),t._v(" "),e("h4",{attrs:{id:"create-hpere-istio-cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-hpere-istio-cluster"}},[t._v("#")]),t._v(" Create HPERE ISTIO cluster")]),t._v(" "),e("p",[t._v("Add kubernetes hosts by following below steps.")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Login into HPERE platform by providing required username and password.")])]),t._v(" "),e("li",[e("p",[t._v("Click on Kubernetes tab in the left panel and navigate to the Kubernetes Hosts Installation page.")])]),t._v(" "),e("li",[e("p",[t._v("Add hosts by providing IP address, credentials and set istio-ingressgateway tag to true.")])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(312),alt:""}})]),t._v(" "),e("p",[t._v("::: NOTE\nRefer to "),e("RouterLink",{attrs:{to:"/Solution-Deployment/Manual-ERE-Deployment.html#add-kubernetes-hosts"}},[t._v("Add Kubernet Hosts")]),t._v(" section to get more details on adding kubernetes hosts.\n:::")],1),t._v(" "),e("ul",[e("li",[t._v("Node status will become “Ready” once node installed successfully. Make sure that tag is set to istio-ingressgateway as shown in below snapshot.")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(313),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"create-the-hpere-istio-cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-the-hpere-istio-cluster"}},[t._v("#")]),t._v(" Create the HPERE ISTIO cluster")]),t._v(" "),e("p",[t._v("Follow below steps to create ISTIO cluster.")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Navigate to Cluster creation page under Kubernetes menu and click on Create Kubernetes Cluster.")])]),t._v(" "),e("li",[e("p",[t._v("For host configuration, select the required master and worker nodes and click on Next.")])]),t._v(" "),e("li",[e("p",[t._v("Cross verify cluster configuration details and Click on Next.")])]),t._v(" "),e("li",[e("p",[t._v("Provide authentication details if required.")])]),t._v(" "),e("li",[e("p",[t._v("Select Istio application under "),e("strong",[t._v("Application Configuration")]),t._v(". And click on Next.")])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(314),alt:""}})]),t._v(" "),e("ul",[e("li",[t._v("Next page shows up the summary and click on submit create the cluster. Cluster status shows “ready” once the cluster created successfully.")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),e("p",[t._v("Refer to "),e("RouterLink",{attrs:{to:"/Solution-Deployment/Manual-ERE-Deployment.html#create-a-kubernetes-cluster"}},[t._v("Cluster Creation")]),t._v(" section to get more information on cluster creation process.")],1)]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Once the tenant is created, Necessary Istio ingress gateway and Kiali application access points will be created. Follow below steps to create tenant.")])]),t._v(" "),e("li",[e("p",[t._v("Select tenant option under Kubernetes menu and click on create tenant.")])]),t._v(" "),e("li",[e("p",[t._v("As show in the below snapshot, select Istio cluster in “K8s Cluster” drop down menu and check the option “Enable Istio Service Mesh”.")])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(315),alt:""}})]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),e("p",[t._v("Refer to Tenant creation section to get more information.")])]),t._v(" "),e("ul",[e("li",[t._v("Once the tenant is created, click on the tenant and go to the application menu. We can notice ingress gateway address and Kiali dashboard under “Service Endpoints” as shown in the blow snapshot.")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(316),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"access-the-kubernetes-cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#access-the-kubernetes-cluster"}},[t._v("#")]),t._v(" Access the Kubernetes Cluster")]),t._v(" "),e("ol",[e("li",[t._v("Navigate to Dashboard, download kubeconfig and upload to the installer machine. Export the downloaded config file to KUBECONFIG to access the cluster.")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("KUBECONFIG")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("kubeconfig_file_path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("Get node details by running below command.")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kubectl get nodes\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("Get namespace details by running below command.")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kubect get ns\n")])])]),e("p",[e("img",{attrs:{src:s(317),alt:""}})]),t._v(" "),e("h4",{attrs:{id:"deploy-application"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deploy-application"}},[t._v("#")]),t._v(" Deploy Application")]),t._v(" "),e("ol",[e("li",[t._v("Application will be deployed under Istio tenant namespace. Execute below command to deploy application. Here we are using sample application provided by Istio")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" https://raw.githubusercontent.com/istio/istio/release-1.8/samples/bookinfo/platform/kube/bookinfo.yaml\n")])])]),e("p",[t._v("Output of the above command looks like below.\n"),e("img",{attrs:{src:s(318),alt:""}})]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[t._v("Verify if Pods and Services are running.\n"),e("img",{attrs:{src:s(319),alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("Verify the application status by running below command.")])])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" “"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pod "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ratings "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("’"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(".items"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".metadata.name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("’"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("” "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" ratings – "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" productpage:9080/productpage\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[t._v("Deploy ingress gateway for application.")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Kubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" https://raw.githubusercontent.com/istio/istio/release-1.8/samples/bookinfo/networking/bookinfo-gateway.yaml\n")])])]),e("ol",{attrs:{start:"5"}},[e("li",[t._v("Verify gateway status by running below command.")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kubectl get gateway\n")])])]),e("p",[e("img",{attrs:{src:s(320),alt:""}})]),t._v(" "),e("ol",{attrs:{start:"6"}},[e("li",[t._v("Edit the gateway and provide a custom domain.")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Kubectl edit gateway bookinfo-gateway\n")])])]),e("ol",{attrs:{start:"7"}},[e("li",[e("p",[t._v("Modify the hosts section under spec with domain (Ex: mybook.example.com) as shown in screenshot.\n"),e("img",{attrs:{src:s(321),alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("Note Istio ingress hostname and port under "),e("strong",[t._v("Service Endpoints")]),t._v(" in Kubernetes Application.\n"),e("img",{attrs:{src:s(322),alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("Update hosts file as below so that when accessing application domain, domain points to ingress IP address\n"),e("img",{attrs:{src:s(323),alt:""}})])])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),e("p",[t._v("In above example agw1.ajay.tennet.local resolves to 10.0.72.180")])]),t._v(" "),e("ol",{attrs:{start:"10"}},[e("li",[t._v("Access the application via browser using custom domain and ingress port as below. Different versions of website will be loaded each time when website is accessed.\n"),e("img",{attrs:{src:s(324),alt:""}})])]),t._v(" "),e("p",[e("strong",[t._v("Access Kiali")])]),t._v(" "),e("ol",[e("li",[t._v("Open HPERE WEBUI and under Istio tenant access the Kiali URL under application/service Endpoints")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(325),alt:""}})]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[t._v("A popup window will be appearing with token key and to proceed to Kiali. Copy the token and when asked at login, provide this token")])]),t._v(" "),e("li",[e("p",[t._v("Once Kiali dashboard is loaded, go to service section and click “review” service of the website.")])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(326),alt:""}})]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[t._v("Notice that service has 3 versions of microservices as shown in below graph. We can restrict the flow of traffic by using option “Update Weighted Routing” under Actions.")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(327),alt:""}})]),t._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[t._v("Below is snippet of traffic allowed only to version 2 of “reviews” microservice application.")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(328),alt:""}})])])}),[],!1,null,null,null);e.default=r.exports}}]);